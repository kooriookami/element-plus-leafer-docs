const b={toURL(i,t){let e=encodeURIComponent(i);return t==="text"?e="data:text/plain;charset=utf-8,"+e:t==="svg"&&(e="data:image/svg+xml,"+e),e},image:{hitCanvasSize:100,maxCacheSize:4096e3,maxPatternSize:8847360,crossOrigin:"anonymous",getRealURL(i){const{prefix:t,suffix:e}=b.image;return e&&!i.startsWith("data:")&&!i.startsWith("blob:")&&(i+=(i.includes("?")?"&":"?")+e),t&&i[0]==="/"&&(i=t+i),i}}},nt={},_e={RUNTIME:"runtime",LEAF:"leaf",TASK:"task",CNAVAS:"canvas",IMAGE:"image",types:{},create(i){const{types:t}=el;return t[i]?t[i]++:(t[i]=1,0)}},el=_e,{round:il,pow:sl,PI:mr}=Math,At={within(i,t,e){return typeof t=="object"&&(e=t.max,t=t.min),t!==void 0&&i<t&&(i=t),e!==void 0&&i>e&&(i=e),i},fourNumber(i,t){let e;if(i instanceof Array)switch(i.length){case 4:e=t===void 0?i:[...i];break;case 2:e=[i[0],i[1],i[0],i[1]];break;case 3:e=[i[0],i[1],i[2],i[1]];break;case 1:i=i[0];break;default:i=0}if(e||(e=[i,i,i,i]),t)for(let s=0;s<4;s++)e[s]>t&&(e[s]=t);return e},formatRotation(i,t){return i%=360,t?i<0&&(i+=360):(i>180&&(i-=360),i<-180&&(i+=360)),At.float(i)},getGapRotation(i,t,e=0){let s=i+e;if(t>1){const n=Math.abs(s%t);(n<1||n>t-1)&&(s=Math.round(s/t)*t)}return s-e},float(i,t){const e=t?sl(10,t):1e12;return i=il(i*e)/e,i===-0?0:i}},$=mr/180,Lt=mr*2,ri=mr/2;function Ua(){return{x:0,y:0}}function Ya(){return{x:0,y:0,width:0,height:0}}function Es(){return{a:1,b:0,c:0,d:1,e:0,f:0}}const{sin:qs,cos:Zs,acos:es,sqrt:Qs}=Math,{float:Qe}=At,Je={};function Fr(){return Object.assign(Object.assign(Object.assign({},Es()),Ya()),{scaleX:1,scaleY:1,rotation:0,skewX:0,skewY:0})}const P={defaultMatrix:Es(),defaultWorld:Fr(),tempMatrix:{},set(i,t=1,e=0,s=0,n=1,r=0,o=0){i.a=t,i.b=e,i.c=s,i.d=n,i.e=r,i.f=o},get:Es,getWorld:Fr,copy(i,t){i.a=t.a,i.b=t.b,i.c=t.c,i.d=t.d,i.e=t.e,i.f=t.f},translate(i,t,e){i.e+=t,i.f+=e},translateInner(i,t,e,s){i.e+=i.a*t+i.c*e,i.f+=i.b*t+i.d*e,s&&(i.e-=t,i.f-=e)},scale(i,t,e=t){i.a*=t,i.b*=t,i.c*=e,i.d*=e},scaleOfOuter(i,t,e,s){Y.toInnerPoint(i,t,Je),Y.scaleOfInner(i,Je,e,s)},scaleOfInner(i,t,e,s=e){Y.translateInner(i,t.x,t.y),Y.scale(i,e,s),Y.translateInner(i,-t.x,-t.y)},rotate(i,t){const{a:e,b:s,c:n,d:r}=i;t*=$;const o=Zs(t),a=qs(t);i.a=e*o-s*a,i.b=e*a+s*o,i.c=n*o-r*a,i.d=n*a+r*o},rotateOfOuter(i,t,e){Y.toInnerPoint(i,t,Je),Y.rotateOfInner(i,Je,e)},rotateOfInner(i,t,e){Y.translateInner(i,t.x,t.y),Y.rotate(i,e),Y.translateInner(i,-t.x,-t.y)},skew(i,t,e){const{a:s,b:n,c:r,d:o}=i;e&&(e*=$,i.a=s+r*e,i.b=n+o*e),t&&(t*=$,i.c=r+s*t,i.d=o+n*t)},skewOfOuter(i,t,e,s){Y.toInnerPoint(i,t,Je),Y.skewOfInner(i,Je,e,s)},skewOfInner(i,t,e,s=0){Y.translateInner(i,t.x,t.y),Y.skew(i,e,s),Y.translateInner(i,-t.x,-t.y)},multiply(i,t){const{a:e,b:s,c:n,d:r,e:o,f:a}=i;i.a=t.a*e+t.b*n,i.b=t.a*s+t.b*r,i.c=t.c*e+t.d*n,i.d=t.c*s+t.d*r,i.e=t.e*e+t.f*n+o,i.f=t.e*s+t.f*r+a},multiplyParent(i,t,e,s,n,r){let{e:o,f:a}=i;if(r&&(o+=r.scrollX,a+=r.scrollY),e||(e=i),s===void 0&&(s=i.a!==1||i.b||i.c||i.d!==1),s){const{a:h,b:l,c,d:p}=i;e.a=h*t.a+l*t.c,e.b=h*t.b+l*t.d,e.c=c*t.a+p*t.c,e.d=c*t.b+p*t.d,n&&(e.scaleX=t.scaleX*n.scaleX,e.scaleY=t.scaleY*n.scaleY)}else e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,n&&(e.scaleX=t.scaleX,e.scaleY=t.scaleY);e.e=o*t.a+a*t.c+t.e,e.f=o*t.b+a*t.d+t.f},divide(i,t){Y.multiply(i,Y.tempInvert(t))},divideParent(i,t){Y.multiplyParent(i,Y.tempInvert(t))},tempInvert(i){const{tempMatrix:t}=Y;return Y.copy(t,i),Y.invert(t),t},invert(i){const{a:t,b:e,c:s,d:n,e:r,f:o}=i;if(!e&&!s)if(t===1&&n===1)i.e=-r,i.f=-o;else{const a=1/(t*n);i.a=n*a,i.d=t*a,i.e=-r*n*a,i.f=-o*t*a}else{const a=1/(t*n-e*s);i.a=n*a,i.b=-e*a,i.c=-s*a,i.d=t*a,i.e=-(r*n-o*s)*a,i.f=-(o*t-r*e)*a}},toOuterPoint(i,t,e,s){const{x:n,y:r}=t;e||(e=t),e.x=n*i.a+r*i.c,e.y=n*i.b+r*i.d,s||(e.x+=i.e,e.y+=i.f)},toInnerPoint(i,t,e,s){const{a:n,b:r,c:o,d:a}=i,h=1/(n*a-r*o),{x:l,y:c}=t;if(e||(e=t),e.x=(l*a-c*o)*h,e.y=(c*n-l*r)*h,!s){const{e:p,f:_}=i;e.x-=(p*a-_*o)*h,e.y-=(_*n-p*r)*h}},setLayout(i,t,e,s,n){const{x:r,y:o,scaleX:a,scaleY:h}=t;if(n===void 0&&(n=t.rotation||t.skewX||t.skewY),n){const{rotation:l,skewX:c,skewY:p}=t,_=l*$,u=Zs(_),f=qs(_);if(c||p){const g=c*$,x=p*$;i.a=(u+x*-f)*a,i.b=(f+x*u)*a,i.c=(-f+g*u)*h,i.d=(u+g*f)*h}else i.a=u*a,i.b=f*a,i.c=-f*h,i.d=u*h}else i.a=a,i.b=0,i.c=0,i.d=h;i.e=r,i.f=o,(e=e||s)&&Y.translateInner(i,-e.x,-e.y,!s)},getLayout(i,t,e,s){const{a:n,b:r,c:o,d:a,e:h,f:l}=i;let c=h,p=l,_,u,f,g,x;if(r||o){const w=n*a-r*o;if(o&&!s){_=Qs(n*n+r*r),u=w/_;const R=n/_;f=r>0?es(R):-es(R)}else{u=Qs(o*o+a*a),_=w/u;const R=o/u;f=ri-(a>0?es(-R):-es(R))}const m=Qe(Zs(f)),v=qs(f);_=Qe(_),u=Qe(u),g=m?Qe((o/u+v)/m/$,9):0,x=m?Qe((r/_-v)/m/$,9):0,f=Qe(f/$)}else _=n,u=a,f=g=x=0;return(t=e||t)&&(c+=t.x*n+t.y*o,p+=t.x*r+t.y*a,e||(c-=t.x,p-=t.y)),{x:c,y:p,scaleX:_,scaleY:u,rotation:f,skewX:g,skewY:x}},withScale(i,t,e=t){const s=i;if(!t||!e){const{a:n,b:r,c:o,d:a}=i;r||o?(t=Qs(n*n+r*r),e=(n*a-r*o)/t):(t=n,e=a)}return s.scaleX=t,s.scaleY=e,s},reset(i){Y.set(i)}},Y=P,{toInnerPoint:Js,toOuterPoint:zr}=P,{sin:Hr,cos:Nr,abs:jr,sqrt:nl,atan2:tn,min:rl,PI:ol}=Math,E={defaultPoint:Ua(),tempPoint:{},tempRadiusPoint:{},set(i,t=0,e=0){i.x=t,i.y=e},setRadius(i,t,e){i.radiusX=t,i.radiusY=e===void 0?t:e},copy(i,t){i.x=t.x,i.y=t.y},copyFrom(i,t,e){i.x=t,i.y=e},move(i,t,e){i.x+=t,i.y+=e},scale(i,t,e=t){i.x&&(i.x*=t),i.y&&(i.y*=e)},scaleOf(i,t,e,s=e){i.x+=(i.x-t.x)*(e-1),i.y+=(i.y-t.y)*(s-1)},rotate(i,t,e){e||(e=ze.defaultPoint),t*=$;const s=Nr(t),n=Hr(t),r=i.x-e.x,o=i.y-e.y;i.x=e.x+r*s-o*n,i.y=e.y+r*n+o*s},tempToInnerOf(i,t){const{tempPoint:e}=ze;return sn(e,i),Js(t,e,e),e},tempToOuterOf(i,t){const{tempPoint:e}=ze;return sn(e,i),zr(t,e,e),e},tempToInnerRadiusPointOf(i,t){const{tempRadiusPoint:e}=ze;return sn(e,i),ze.toInnerRadiusPointOf(i,t,e),e},toInnerRadiusPointOf(i,t,e){e||(e=i),Js(t,i,e),e.radiusX=Math.abs(i.radiusX/t.scaleX),e.radiusY=Math.abs(i.radiusY/t.scaleY)},toInnerOf(i,t,e){Js(t,i,e)},toOuterOf(i,t,e){zr(t,i,e)},getCenter(i,t){return{x:i.x+(t.x-i.x)/2,y:i.y+(t.y-i.y)/2}},getCenterX(i,t){return i+(t-i)/2},getCenterY(i,t){return i+(t-i)/2},getDistance(i,t){return en(i.x,i.y,t.x,t.y)},getDistanceFrom(i,t,e,s){const n=jr(e-i),r=jr(s-t);return nl(n*n+r*r)},getMinDistanceFrom(i,t,e,s,n,r){return rl(en(i,t,e,s),en(e,s,n,r))},getAngle(i,t){return Gr(i,t)/$},getRotation(i,t,e,s){return s||(s=t),ze.getRadianFrom(i.x,i.y,t.x,t.y,e.x,e.y,s.x,s.y)/$},getRadianFrom(i,t,e,s,n,r,o,a){o===void 0&&(o=e,a=s);let h=tn(t-s,i-e);const c=tn(r-a,n-o)-h;return c<-ol?c+Lt:c},getAtan2(i,t){return tn(t.y-i.y,t.x-i.x)},getDistancePoint(i,t,e,s){const n=Gr(i,t);return t=s?t:{},t.x=i.x+Nr(n)*e,t.y=i.y+Hr(n)*e,t},reset(i){}},ze=E,{getDistanceFrom:en,copy:sn,getAtan2:Gr}=ze;class Di{constructor(t,e){this.set(t,e)}set(t,e){return typeof t=="object"?E.copy(this,t):E.set(this,t,e),this}get(){const{x:t,y:e}=this;return{x:t,y:e}}clone(){return new Di(this)}move(t,e){return E.move(this,t,e),this}scale(t,e){return E.scale(this,t,e),this}scaleOf(t,e,s){return E.scaleOf(this,t,e,s),this}rotate(t,e){return E.rotate(this,t,e),this}rotateOf(t,e){return E.rotate(this,e,t),this}getRotation(t,e,s){return E.getRotation(this,t,e,s)}toInnerOf(t,e){return E.toInnerOf(this,t,e),this}toOuterOf(t,e){return E.toOuterOf(this,t,e),this}getCenter(t){return new Di(E.getCenter(this,t))}getDistance(t){return E.getDistance(this,t)}getDistancePoint(t,e,s){return new Di(E.getDistancePoint(this,t,e,s))}getAngle(t){return E.getAngle(this,t)}getAtan2(t){return E.getAtan2(this,t)}reset(){return this}}new Di;class Ce{constructor(t,e,s,n,r,o){this.set(t,e,s,n,r,o)}set(t,e,s,n,r,o){return typeof t=="object"?P.copy(this,t):P.set(this,t,e,s,n,r,o),this}setWith(t){return P.copy(this,t),this.scaleX=t.scaleX,this.scaleY=t.scaleY,this}get(){const{a:t,b:e,c:s,d:n,e:r,f:o}=this;return{a:t,b:e,c:s,d:n,e:r,f:o}}clone(){return new Ce(this)}translate(t,e){return P.translate(this,t,e),this}translateInner(t,e){return P.translateInner(this,t,e),this}scale(t,e){return P.scale(this,t,e),this}scaleWith(t,e){return P.scale(this,t,e),this.scaleX*=t,this.scaleY*=e||t,this}scaleOfOuter(t,e,s){return P.scaleOfOuter(this,t,e,s),this}scaleOfInner(t,e,s){return P.scaleOfInner(this,t,e,s),this}rotate(t){return P.rotate(this,t),this}rotateOfOuter(t,e){return P.rotateOfOuter(this,t,e),this}rotateOfInner(t,e){return P.rotateOfInner(this,t,e),this}skew(t,e){return P.skew(this,t,e),this}skewOfOuter(t,e,s){return P.skewOfOuter(this,t,e,s),this}skewOfInner(t,e,s){return P.skewOfInner(this,t,e,s),this}multiply(t){return P.multiply(this,t),this}multiplyParent(t){return P.multiplyParent(this,t),this}divide(t){return P.divide(this,t),this}divideParent(t){return P.divideParent(this,t),this}invert(){return P.invert(this),this}invertWith(){return P.invert(this),this.scaleX=1/this.scaleX,this.scaleY=1/this.scaleY,this}toOuterPoint(t,e,s){P.toOuterPoint(this,t,e,s)}toInnerPoint(t,e,s){P.toInnerPoint(this,t,e,s)}setLayout(t,e,s){return P.setLayout(this,t,e,s),this}getLayout(t,e,s){return P.getLayout(this,t,e,s)}withScale(t,e){return P.withScale(this,t,e)}reset(){P.reset(this)}}new Ce;const Vi={tempPointBounds:{},setPoint(i,t,e){i.minX=i.maxX=t,i.minY=i.maxY=e},addPoint(i,t,e){i.minX=t<i.minX?t:i.minX,i.minY=e<i.minY?e:i.minY,i.maxX=t>i.maxX?t:i.maxX,i.maxY=e>i.maxY?e:i.maxY},addBounds(i,t,e,s,n){Ur(i,t,e),Ur(i,t+s,e+n)},copy(i,t){i.minX=t.minX,i.minY=t.minY,i.maxX=t.maxX,i.maxY=t.maxY},addPointBounds(i,t){i.minX=t.minX<i.minX?t.minX:i.minX,i.minY=t.minY<i.minY?t.minY:i.minY,i.maxX=t.maxX>i.maxX?t.maxX:i.maxX,i.maxY=t.maxY>i.maxY?t.maxY:i.maxY},toBounds(i,t){t.x=i.minX,t.y=i.minY,t.width=i.maxX-i.minX,t.height=i.maxY-i.minY}},{addPoint:Ur}=Vi,{tempPointBounds:we,setPoint:Yr,addPoint:is,toBounds:Vr}=Vi,{toOuterPoint:ss}=P,{float:ns,fourNumber:al}=At,{floor:Xr,ceil:rs}=Math;let Ut,Yt,Me,Ae;const re={},St={},S={tempBounds:{},set(i,t=0,e=0,s=0,n=0){i.x=t,i.y=e,i.width=s,i.height=n},copy(i,t){i.x=t.x,i.y=t.y,i.width=t.width,i.height=t.height},copyAndSpread(i,t,e,s){if(e instanceof Array){const n=al(e);s?D.set(i,t.x+n[3],t.y+n[0],t.width-n[1]-n[3],t.height-n[2]-n[0]):D.set(i,t.x-n[3],t.y-n[0],t.width+n[1]+n[3],t.height+n[2]+n[0])}else s&&(e=-e),D.set(i,t.x-e,t.y-e,t.width+e*2,t.height+e*2)},minX(i){return i.width>0?i.x:i.x+i.width},minY(i){return i.height>0?i.y:i.y+i.height},maxX(i){return i.width>0?i.x+i.width:i.x},maxY(i){return i.height>0?i.y+i.height:i.y},move(i,t,e){i.x+=t,i.y+=e},getByMove(i,t,e){return i=Object.assign({},i),D.move(i,t,e),i},toOffsetOutBounds(i,t,e){t?qr(t,i):t=i,e?(t.offsetX=-(D.maxX(e)-i.x),t.offsetY=-(D.maxY(e)-i.y)):(t.offsetX=i.x+i.width,t.offsetY=i.y+i.height),D.move(t,-t.offsetX,-t.offsetY)},scale(i,t,e=t){E.scale(i,t,e),i.width*=t,i.height*=e},scaleOf(i,t,e,s=e){E.scaleOf(i,t,e,s),i.width*=e,i.height*=s},tempToOuterOf(i,t){return D.copy(D.tempBounds,i),D.toOuterOf(D.tempBounds,t),D.tempBounds},getOuterOf(i,t){return i=Object.assign({},i),D.toOuterOf(i,t),i},toOuterOf(i,t,e){if(e||(e=i),t.b===0&&t.c===0){const{a:s,d:n}=t;s>0?(e.width=i.width*s,e.x=t.e+i.x*s):(e.width=i.width*-s,e.x=t.e+i.x*s-e.width),n>0?(e.height=i.height*n,e.y=t.f+i.y*n):(e.height=i.height*-n,e.y=t.f+i.y*n-e.height)}else re.x=i.x,re.y=i.y,ss(t,re,St),Yr(we,St.x,St.y),re.x=i.x+i.width,ss(t,re,St),is(we,St.x,St.y),re.y=i.y+i.height,ss(t,re,St),is(we,St.x,St.y),re.x=i.x,ss(t,re,St),is(we,St.x,St.y),Vr(we,e)},toInnerOf(i,t,e){e||(e=i),D.move(e,-t.e,-t.f),D.scale(e,1/t.a,1/t.d)},getFitMatrix(i,t,e=1){const s=Math.min(e,Math.min(i.width/t.width,i.height/t.height));return new Ce(s,0,0,s,-t.x*s,-t.y*s)},getSpread(i,t){const e={};return D.copyAndSpread(e,i,t),e},spread(i,t){D.copyAndSpread(i,i,t)},shrink(i,t){D.copyAndSpread(i,i,t,!0)},ceil(i){const{x:t,y:e}=i;i.x=Xr(i.x),i.y=Xr(i.y),i.width=t>i.x?rs(i.width+t-i.x):rs(i.width),i.height=e>i.y?rs(i.height+e-i.y):rs(i.height)},unsign(i){i.width<0&&(i.x+=i.width,i.width=-i.width),i.height<0&&(i.y+=i.height,i.height=-i.height)},float(i,t){i.x=ns(i.x,t),i.y=ns(i.y,t),i.width=ns(i.width,t),i.height=ns(i.height,t)},add(i,t,e){Ut=i.x+i.width,Yt=i.y+i.height,Me=t.x,Ae=t.y,e||(Me+=t.width,Ae+=t.height),Ut=Ut>Me?Ut:Me,Yt=Yt>Ae?Yt:Ae,i.x=i.x<t.x?i.x:t.x,i.y=i.y<t.y?i.y:t.y,i.width=Ut-i.x,i.height=Yt-i.y},addList(i,t){D.setListWithFn(i,t,void 0,!0)},setList(i,t,e=!1){D.setListWithFn(i,t,void 0,e)},addListWithFn(i,t,e){D.setListWithFn(i,t,e,!0)},setListWithFn(i,t,e,s=!1){let n,r=!0;for(let o=0,a=t.length;o<a;o++)n=e?e(t[o]):t[o],n&&(n.width||n.height)&&(r?(r=!1,s||qr(i,n)):Kr(i,n));r&&D.reset(i)},setPoints(i,t){t.forEach((e,s)=>s===0?Yr(we,e.x,e.y):is(we,e.x,e.y)),Vr(we,i)},setPoint(i,t){D.set(i,t.x,t.y)},addPoint(i,t){Kr(i,t,!0)},getPoints(i){const{x:t,y:e,width:s,height:n}=i;return[{x:t,y:e},{x:t+s,y:e},{x:t+s,y:e+n},{x:t,y:e+n}]},hitRadiusPoint(i,t,e){return e&&(t=E.tempToInnerRadiusPointOf(t,e)),t.x>=i.x-t.radiusX&&t.x<=i.x+i.width+t.radiusX&&t.y>=i.y-t.radiusY&&t.y<=i.y+i.height+t.radiusY},hitPoint(i,t,e){return e&&(t=E.tempToInnerOf(t,e)),t.x>=i.x&&t.x<=i.x+i.width&&t.y>=i.y&&t.y<=i.y+i.height},hit(i,t,e){return e&&(t=D.tempToOuterOf(t,e)),!(i.y+i.height<t.y||t.y+t.height<i.y||i.x+i.width<t.x||t.x+t.width<i.x)},includes(i,t,e){return e&&(t=D.tempToOuterOf(t,e)),i.x<=t.x&&i.y<=t.y&&i.x+i.width>=t.x+t.width&&i.y+i.height>=t.y+t.height},getIntersectData(i,t,e){if(e&&(t=D.tempToOuterOf(t,e)),!D.hit(i,t))return Ya();let{x:s,y:n,width:r,height:o}=t;return Ut=s+r,Yt=n+o,Me=i.x+i.width,Ae=i.y+i.height,s=s>i.x?s:i.x,n=n>i.y?n:i.y,Ut=Ut<Me?Ut:Me,Yt=Yt<Ae?Yt:Ae,r=Ut-s,o=Yt-n,{x:s,y:n,width:r,height:o}},intersect(i,t,e){D.copy(i,D.getIntersectData(i,t,e))},isSame(i,t){return i.x===t.x&&i.y===t.y&&i.width===t.width&&i.height===t.height},isEmpty(i){return i.x===0&&i.y===0&&i.width===0&&i.height===0},reset(i){D.set(i)}},D=S,{add:Kr,copy:qr}=D;class Z{get minX(){return S.minX(this)}get minY(){return S.minY(this)}get maxX(){return S.maxX(this)}get maxY(){return S.maxY(this)}constructor(t,e,s,n){this.set(t,e,s,n)}set(t,e,s,n){return typeof t=="object"?S.copy(this,t):S.set(this,t,e,s,n),this}get(){const{x:t,y:e,width:s,height:n}=this;return{x:t,y:e,width:s,height:n}}clone(){return new Z(this)}move(t,e){return S.move(this,t,e),this}scale(t,e){return S.scale(this,t,e),this}scaleOf(t,e,s){return S.scaleOf(this,t,e,s),this}toOuterOf(t,e){return S.toOuterOf(this,t,e),this}toInnerOf(t,e){return S.toInnerOf(this,t,e),this}getFitMatrix(t,e){return S.getFitMatrix(this,t,e)}spread(t){return S.spread(this,t),this}shrink(t){return S.shrink(this,t),this}ceil(){return S.ceil(this),this}unsign(){return S.unsign(this),this}float(t){return S.float(this,t),this}add(t){return S.add(this,t),this}addList(t){return S.setList(this,t,!0),this}setList(t){return S.setList(this,t),this}addListWithFn(t,e){return S.setListWithFn(this,t,e,!0),this}setListWithFn(t,e){return S.setListWithFn(this,t,e),this}setPoint(t){return S.setPoint(this,t),this}setPoints(t){return S.setPoints(this,t),this}addPoint(t){return S.addPoint(this,t),this}getPoints(){return S.getPoints(this)}hitPoint(t,e){return S.hitPoint(this,t,e)}hitRadiusPoint(t,e){return S.hitRadiusPoint(this,t,e)}hit(t,e){return S.hit(this,t,e)}includes(t,e){return S.includes(this,t,e)}intersect(t,e){return S.intersect(this,t,e),this}getIntersect(t,e){return new Z(S.getIntersectData(this,t,e))}isSame(t){return S.isSame(this,t)}isEmpty(){return S.isEmpty(this)}reset(){S.reset(this)}}const I=new Z;class hl{constructor(t,e,s,n,r,o){typeof t=="object"?this.copy(t):this.set(t,e,s,n,r,o)}set(t=0,e=0,s=0,n=0,r=0,o=0){this.top=t,this.right=e,this.bottom=s,this.left=n,this.width=r,this.height=o}copy(t){const{top:e,right:s,bottom:n,left:r,width:o,height:a}=t;this.set(e,s,n,r,o,a)}getBoundsFrom(t){const{top:e,right:s,bottom:n,left:r,width:o,height:a}=this;return new Z(r,e,o||t.width-r-s,a||t.height-e-n)}}var Jn;(function(i){i[i.top=0]="top",i[i.right=1]="right",i[i.bottom=2]="bottom",i[i.left=3]="left"})(Jn||(Jn={}));var tr;(function(i){i[i.topLeft=0]="topLeft",i[i.top=1]="top",i[i.topRight=2]="topRight",i[i.right=3]="right",i[i.bottomRight=4]="bottomRight",i[i.bottom=5]="bottom",i[i.bottomLeft=6]="bottomLeft",i[i.left=7]="left",i[i.center=8]="center",i[i["top-left"]=0]="top-left",i[i["top-right"]=2]="top-right",i[i["bottom-right"]=4]="bottom-right",i[i["bottom-left"]=6]="bottom-left"})(tr||(tr={}));const wr=[{x:0,y:0},{x:.5,y:0},{x:1,y:0},{x:1,y:.5},{x:1,y:1},{x:.5,y:1},{x:0,y:1},{x:0,y:.5},{x:.5,y:.5}];wr.forEach(i=>i.type="percent");const yi={directionData:wr,tempPoint:{},get:Zr,toPoint(i,t,e,s,n){e||(e={});const r=Zr(i);e.x=r.x,e.y=r.y,r.type==="percent"&&(e.x*=t.width,e.y*=t.height,n&&(e.x-=n.x,e.y-=n.y,r.x&&(e.x-=r.x===1?n.width:r.x===.5?r.x*n.width:0),r.y&&(e.y-=r.y===1?n.height:r.y===.5?r.y*n.height:0))),s||(e.x+=t.x,e.y+=t.y)}};function Zr(i){return typeof i=="string"?wr[tr[i]]:i}const{toPoint:ll}=yi,Va={toPoint(i,t,e,s,n){ll(i,e,s,n,t)}},cl={0:1,1:1,2:1,3:1,4:1,5:1,6:1,7:1,8:1,9:1,".":1,e:1,E:1};class F{constructor(t){this.repeatMap={},this.name=t}static get(t){return new F(t)}static set filter(t){this.filterList=Qr(t)}static set exclude(t){this.excludeList=Qr(t)}log(...t){if(De.enable){if(De.filterList.length&&De.filterList.every(e=>e!==this.name)||De.excludeList.length&&De.excludeList.some(e=>e===this.name))return;console.log("%c"+this.name,"color:#21ae62",...t)}}tip(...t){De.enable&&this.warn(...t)}warn(...t){De.showWarn&&console.warn(this.name,...t)}repeat(t,...e){this.repeatMap[t]||(this.warn("repeat:"+t,...e),this.repeatMap[t]=!0)}error(...t){try{throw new Error}catch(e){console.error(this.name,...t,e)}}}F.filterList=[];F.excludeList=[];F.showWarn=!0;function Qr(i){return i?typeof i=="string"&&(i=[i]):i=[],i}const De=F,ul=F.get("RunTime"),Ft={currentId:0,currentName:"",idMap:{},nameMap:{},nameToIdMap:{},start(i,t){const e=_e.create(_e.RUNTIME);return Ct.currentId=Ct.idMap[e]=t?performance.now():Date.now(),Ct.currentName=Ct.nameMap[e]=i,Ct.nameToIdMap[i]=e,e},end(i,t){const e=Ct.idMap[i],s=Ct.nameMap[i],n=t?(performance.now()-e)/1e3:Date.now()-e;Ct.idMap[i]=Ct.nameMap[i]=Ct.nameToIdMap[s]=void 0,ul.log(s,n,"ms")},endOfName(i,t){const e=Ct.nameToIdMap[i];e!==void 0&&Ct.end(e,t)}},Ct=Ft,dl=F.get("UICreator"),Is={list:{},register(i){const{__tag:t}=i.prototype;nn[t]?dl.repeat(t):nn[t]=i},get(i,t,e,s,n,r){const o=new nn[i](t);return e!==void 0&&(o.x=e,s&&(o.y=s),n&&(o.width=n),r&&(o.height=r)),o}},{list:nn}=Is,fl=F.get("EventCreator"),fi={nameList:{},register(i){let t;Object.keys(i).forEach(e=>{t=i[e],typeof t=="string"&&(bi[t]?fl.repeat(t):bi[t]=i)})},changeName(i,t){const e=bi[i];if(e){const s=Object.keys(e).find(n=>e[n]===i);s&&(e[s]=t,bi[t]=e)}},has(i){return!!this.nameList[i]},get(i,...t){return new bi[i](...t)}},{nameList:bi}=fi;class Xa{constructor(){this.list=[]}add(t){t.manager=this,this.list.push(t)}get(t){let e;const{list:s}=this;for(let r=0,o=s.length;r<o;r++)if(e=s[r],e.recycled&&e.isSameSize(t))return e.recycled=!1,e.manager||(e.manager=this),e;const n=nt.canvas(t);return this.add(n),n}recycle(t){t.recycled=!0}clearRecycled(){let t;const e=[];for(let s=0,n=this.list.length;s<n;s++)t=this.list[s],t.recycled?t.destroy():e.push(t);this.list=e}clear(){this.list.forEach(t=>{t.destroy()}),this.list.length=0}destroy(){this.clear()}}const at={default(i,t){return rn(t,i),rn(i,t),i},assign(i,t){let e;Object.keys(t).forEach(s=>{var n;e=t[s],(e==null?void 0:e.constructor)===Object&&((n=i[s])===null||n===void 0?void 0:n.constructor)===Object?rn(i[s],t[s]):i[s]=t[s]})},copyAttrs(i,t,e){return e.forEach(s=>{t[s]!==void 0&&(i[s]=t[s])}),i},clone(i){return JSON.parse(JSON.stringify(i))},toMap(i){const t={};for(let e=0,s=i.length;e<s;e++)t[i[e]]=!0;return t}},{assign:rn}=at;class Ka{get __useNaturalRatio(){return!0}get __isLinePath(){return this.path&&this.path.length===6}get __blendMode(){if(this.eraser&&this.eraser!=="path")return"destination-out";const{blendMode:t}=this;return t==="pass-through"?null:t}constructor(t){this.__leaf=t}__get(t){if(this.__input){const e=this.__input[t];if(e!==void 0)return e}return this[t]}__getData(){const t={tag:this.__leaf.tag},{__input:e}=this;let s;for(let n in this)n[0]!=="_"&&(s=e?e[n]:void 0,t[n]=s===void 0?this[n]:s);return t}__setInput(t,e){this.__input||(this.__input={}),this.__input[t]=e}__getInput(t){if(this.__input){const e=this.__input[t];if(e!==void 0)return e}if(!(t==="path"&&!this.__pathInputed))return this["_"+t]}__removeInput(t){this.__input&&this.__input[t]!==void 0&&(this.__input[t]=void 0)}__getInputData(t,e){const s={};if(t)if(t instanceof Array)for(let n of t)s[n]=this.__getInput(n);else for(let n in t)s[n]=this.__getInput(n);else{let n,r,{__input:o}=this;s.tag=this.__leaf.tag;for(let a in this)if(a[0]!=="_"&&(n=this["_"+a],n!==void 0)){if(a==="path"&&!this.__pathInputed)continue;r=o?o[a]:void 0,s[a]=r===void 0?n:r}}if(e&&e.matrix){const{a:n,b:r,c:o,d:a,e:h,f:l}=this.__leaf.__localMatrix;s.matrix={a:n,b:r,c:o,d:a,e:h,f:l}}return s}__setMiddle(t,e){this.__middle||(this.__middle={}),this.__middle[t]=e}__getMiddle(t){return this.__middle&&this.__middle[t]}__checkSingle(){const t=this;if(t.blendMode==="pass-through"){const e=this.__leaf;t.opacity<1&&e.isBranch||e.__hasEraser||t.eraser?t.__single=!0:t.__single&&(t.__single=!1)}else t.__single=!0}__removeNaturalSize(){this.__naturalWidth=this.__naturalHeight=void 0}destroy(){this.__input=this.__middle=null}}var er;(function(i){i[i.No=0]="No",i[i.Yes=1]="Yes",i[i.NoAndSkip=2]="NoAndSkip",i[i.YesAndSkip=3]="YesAndSkip"})(er||(er={}));function k(i,t,e,s){var n=arguments.length,r=n<3?t:s===null?s=Object.getOwnPropertyDescriptor(t,e):s,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(i,t,e,s);else for(var a=i.length-1;a>=0;a--)(o=i[a])&&(r=(n<3?o(r):n>3?o(t,e,r):o(t,e))||r);return n>3&&r&&Object.defineProperty(t,e,r),r}function qa(i,t,e,s){function n(r){return r instanceof e?r:new e(function(o){o(r)})}return new(e||(e=Promise))(function(r,o){function a(c){try{l(s.next(c))}catch(p){o(p)}}function h(c){try{l(s.throw(c))}catch(p){o(p)}}function l(c){c.done?r(c.value):n(c.value).then(a,h)}l((s=s.apply(i,[])).next())})}function U(i){return(t,e)=>{i||(i=e),Object.defineProperty(t,e,{get(){return this.context[i]},set(s){this.context[i]=s}})}}const Za=[];function A(){return(i,t)=>{Za.push(t)}}const _l=[];let B=class{set blendMode(t){t==="normal"&&(t="source-over"),this.context.globalCompositeOperation=t}get blendMode(){return this.context.globalCompositeOperation}set dashPattern(t){this.context.setLineDash(t||_l)}get dashPattern(){return this.context.getLineDash()}__bindContext(){let t;Za.forEach(e=>{t=this.context[e],t&&(this[e]=t.bind(this.context))}),this.textBaseline="alphabetic"}setTransform(t,e,s,n,r,o){}resetTransform(){}getTransform(){}save(){}restore(){}transform(t,e,s,n,r,o){typeof t=="object"?this.context.transform(t.a,t.b,t.c,t.d,t.e,t.f):this.context.transform(t,e,s,n,r,o)}translate(t,e){}scale(t,e){}rotate(t){}fill(t,e){}stroke(t){}clip(t,e){}fillRect(t,e,s,n){}strokeRect(t,e,s,n){}clearRect(t,e,s,n){}drawImage(t,e,s,n,r,o,a,h,l){switch(arguments.length){case 9:if(e<0){const c=-e/n*h;n+=e,e=0,o+=c,h-=c}if(s<0){const c=-s/r*l;r+=s,s=0,a+=c,l-=c}this.context.drawImage(t,e,s,n,r,o,a,h,l);break;case 5:this.context.drawImage(t,e,s,n,r);break;case 3:this.context.drawImage(t,e,s)}}beginPath(){}moveTo(t,e){}lineTo(t,e){}bezierCurveTo(t,e,s,n,r,o){}quadraticCurveTo(t,e,s,n){}closePath(){}arc(t,e,s,n,r,o){}arcTo(t,e,s,n,r){}ellipse(t,e,s,n,r,o,a,h){}rect(t,e,s,n){}roundRect(t,e,s,n,r){}createConicGradient(t,e,s){}createLinearGradient(t,e,s,n){}createPattern(t,e){}createRadialGradient(t,e,s,n,r,o){}fillText(t,e,s,n){}measureText(t){}strokeText(t,e,s,n){}destroy(){this.context=null}};k([U("imageSmoothingEnabled")],B.prototype,"smooth",void 0);k([U("imageSmoothingQuality")],B.prototype,"smoothLevel",void 0);k([U("globalAlpha")],B.prototype,"opacity",void 0);k([U()],B.prototype,"fillStyle",void 0);k([U()],B.prototype,"strokeStyle",void 0);k([U("lineWidth")],B.prototype,"strokeWidth",void 0);k([U("lineCap")],B.prototype,"strokeCap",void 0);k([U("lineJoin")],B.prototype,"strokeJoin",void 0);k([U("lineDashOffset")],B.prototype,"dashOffset",void 0);k([U()],B.prototype,"miterLimit",void 0);k([U()],B.prototype,"shadowBlur",void 0);k([U()],B.prototype,"shadowColor",void 0);k([U()],B.prototype,"shadowOffsetX",void 0);k([U()],B.prototype,"shadowOffsetY",void 0);k([U()],B.prototype,"filter",void 0);k([U()],B.prototype,"font",void 0);k([U()],B.prototype,"fontKerning",void 0);k([U()],B.prototype,"fontStretch",void 0);k([U()],B.prototype,"fontVariantCaps",void 0);k([U()],B.prototype,"textAlign",void 0);k([U()],B.prototype,"textBaseline",void 0);k([U()],B.prototype,"textRendering",void 0);k([U()],B.prototype,"wordSpacing",void 0);k([U()],B.prototype,"letterSpacing",void 0);k([U()],B.prototype,"direction",void 0);k([A()],B.prototype,"setTransform",null);k([A()],B.prototype,"resetTransform",null);k([A()],B.prototype,"getTransform",null);k([A()],B.prototype,"save",null);k([A()],B.prototype,"restore",null);k([A()],B.prototype,"translate",null);k([A()],B.prototype,"scale",null);k([A()],B.prototype,"rotate",null);k([A()],B.prototype,"fill",null);k([A()],B.prototype,"stroke",null);k([A()],B.prototype,"clip",null);k([A()],B.prototype,"fillRect",null);k([A()],B.prototype,"strokeRect",null);k([A()],B.prototype,"clearRect",null);k([A()],B.prototype,"beginPath",null);k([A()],B.prototype,"moveTo",null);k([A()],B.prototype,"lineTo",null);k([A()],B.prototype,"bezierCurveTo",null);k([A()],B.prototype,"quadraticCurveTo",null);k([A()],B.prototype,"closePath",null);k([A()],B.prototype,"arc",null);k([A()],B.prototype,"arcTo",null);k([A()],B.prototype,"ellipse",null);k([A()],B.prototype,"rect",null);k([A()],B.prototype,"roundRect",null);k([A()],B.prototype,"createConicGradient",null);k([A()],B.prototype,"createLinearGradient",null);k([A()],B.prototype,"createPattern",null);k([A()],B.prototype,"createRadialGradient",null);k([A()],B.prototype,"fillText",null);k([A()],B.prototype,"measureText",null);k([A()],B.prototype,"strokeText",null);const{copy:pl}=P,gl={width:1,height:1,pixelRatio:1},ue=["width","height","pixelRatio"];class xr extends B{get width(){return this.size.width}get height(){return this.size.height}get pixelRatio(){return this.size.pixelRatio}get pixelWidth(){return this.width*this.pixelRatio}get pixelHeight(){return this.height*this.pixelRatio}get allowBackgroundColor(){return this.view&&this.parentView}constructor(t,e){super(),this.size={},this.worldTransform={},t||(t=gl),t.pixelRatio||(t.pixelRatio=b.devicePixelRatio),this.manager=e,this.innerId=_e.create(_e.CNAVAS);const{width:s,height:n,pixelRatio:r}=t;this.autoLayout=!s||!n,this.size.pixelRatio=r,this.config=t,this.init()}init(){}__createContext(){const{view:t}=this,{contextSettings:e}=this.config;this.context=e?t.getContext("2d",e):t.getContext("2d"),this.__bindContext()}export(t,e){}toBlob(t,e){}toDataURL(t,e){}saveAs(t,e){}resize(t){if(this.isSameSize(t))return;let e;this.context&&!this.unreal&&this.width&&(e=this.getSameCanvas(),e.copyWorld(this)),at.copyAttrs(this.size,t,ue),this.size.pixelRatio||(this.size.pixelRatio=1),this.bounds=new Z(0,0,this.width,this.height),this.context&&!this.unreal&&(this.updateViewSize(),this.smooth=this.config.smooth),this.updateClientBounds(),this.context&&!this.unreal&&e&&(this.clearWorld(e.bounds),this.copyWorld(e),e.recycle())}updateViewSize(){}updateClientBounds(){}getClientBounds(t){return t&&this.updateClientBounds(),this.clientBounds||this.bounds}startAutoLayout(t,e){}stopAutoLayout(){}setCursor(t){}setWorld(t,e){const{pixelRatio:s}=this,n=this.worldTransform;if(e){const{a:r,b:o,c:a,d:h,e:l,f:c}=e;this.setTransform(n.a=(t.a*r+t.b*a)*s,n.b=(t.a*o+t.b*h)*s,n.c=(t.c*r+t.d*a)*s,n.d=(t.c*o+t.d*h)*s,n.e=(t.e*r+t.f*a+l)*s,n.f=(t.e*o+t.f*h+c)*s)}else this.setTransform(n.a=t.a*s,n.b=t.b*s,n.c=t.c*s,n.d=t.d*s,n.e=t.e*s,n.f=t.f*s)}useWorldTransform(t){t&&(this.worldTransform=t);const e=this.worldTransform;e&&this.setTransform(e.a,e.b,e.c,e.d,e.e,e.f)}setStroke(t,e,s){e&&(this.strokeWidth=e),t&&(this.strokeStyle=t),s&&this.setStrokeOptions(s)}setStrokeOptions(t){this.strokeCap=t.strokeCap==="none"?"butt":t.strokeCap,this.strokeJoin=t.strokeJoin,this.dashPattern=t.dashPattern,this.dashOffset=t.dashOffset,this.miterLimit=t.miterLimit}saveBlendMode(t){this.savedBlendMode=this.blendMode,this.blendMode=t}restoreBlendMode(){this.blendMode=this.savedBlendMode}hitFill(t,e){return!0}hitStroke(t,e){return!0}hitPixel(t,e,s=1){return!0}setWorldShadow(t,e,s,n){const{pixelRatio:r}=this;this.shadowOffsetX=t*r,this.shadowOffsetY=e*r,this.shadowBlur=s*r,this.shadowColor=n||"black"}setWorldBlur(t){const{pixelRatio:e}=this;this.filter=`blur(${t*e}px)`}copyWorld(t,e,s,n){if(n&&(this.blendMode=n),e){const{pixelRatio:r}=this;s||(s=e),this.drawImage(t.view,e.x*r,e.y*r,e.width*r,e.height*r,s.x*r,s.y*r,s.width*r,s.height*r)}else this.drawImage(t.view,0,0);n&&(this.blendMode="source-over")}copyWorldToInner(t,e,s,n){if(n&&(this.blendMode=n),e.b||e.c)this.save(),this.resetTransform(),this.copyWorld(t,e,S.tempToOuterOf(s,e)),this.restore();else{const{pixelRatio:r}=this;this.drawImage(t.view,e.x*r,e.y*r,e.width*r,e.height*r,s.x,s.y,s.width,s.height)}n&&(this.blendMode="source-over")}copyWorldByReset(t,e,s,n,r){this.resetTransform(),this.copyWorld(t,e,s,n),r||this.useWorldTransform()}useMask(t,e,s){this.copyWorld(t,e,s,"destination-in")}useEraser(t,e,s){this.copyWorld(t,e,s,"destination-out")}fillWorld(t,e,s){s&&(this.blendMode=s),this.fillStyle=e,I.set(t).scale(this.pixelRatio),this.fillRect(I.x,I.y,I.width,I.height),s&&(this.blendMode="source-over")}strokeWorld(t,e,s){s&&(this.blendMode=s),this.strokeStyle=e,I.set(t).scale(this.pixelRatio),this.strokeRect(I.x,I.y,I.width,I.height),s&&(this.blendMode="source-over")}clearWorld(t,e){I.set(t).scale(this.pixelRatio),e&&I.ceil(),this.clearRect(I.x,I.y,I.width,I.height)}clipWorld(t,e){this.beginPath(),I.set(t).scale(this.pixelRatio),e&&I.ceil(),this.rect(I.x,I.y,I.width,I.height),this.clip()}clear(){const{pixelRatio:t}=this;this.clearRect(0,0,this.width*t+2,this.height*t+2)}isSameSize(t){return this.width===t.width&&this.height===t.height&&this.pixelRatio===t.pixelRatio}getSameCanvas(t,e){const s=this.manager?this.manager.get(this.size):nt.canvas(Object.assign({},this.size));return s.save(),t&&(pl(s.worldTransform,this.worldTransform),s.useWorldTransform()),e&&(s.smooth=this.smooth),s}recycle(t){this.recycled||(this.restore(),t?this.clearWorld(t,!0):this.clear(),this.manager?this.manager.recycle(this):this.destroy())}updateRender(t){}unrealCanvas(){}destroy(){this.manager=this.view=this.parentView=null}}const Kt={creator:{},parse(i,t){},convertToCanvasData(i,t){}},Qa={N:21,D:22,X:23,G:24,F:25,O:26,P:27,U:28},Mt=Object.assign({M:1,m:10,L:2,l:20,H:3,h:30,V:4,v:40,C:5,c:50,S:6,s:60,Q:7,q:70,T:8,t:80,A:9,a:90,Z:11,z:11,R:12},Qa),Ja={M:3,m:3,L:3,l:3,H:2,h:2,V:2,v:2,C:7,c:7,S:5,s:5,Q:5,q:5,T:3,t:3,A:8,a:8,Z:1,z:1,N:5,D:9,X:6,G:9,F:5,O:7,P:4,U:6},th={m:10,l:20,H:3,h:30,V:4,v:40,c:50,S:6,s:60,q:70,T:8,t:80,A:9,a:90},yl=Object.assign(Object.assign({},th),Qa),Ts=Mt,eh={};for(let i in Ts)eh[Ts[i]]=i;const ih={};for(let i in Ts)ih[Ts[i]]=Ja[i];const sh={drawRoundRect(i,t,e,s,n,r){const o=At.fourNumber(r,Math.min(s/2,n/2)),a=t+s,h=e+n;o[0]?i.moveTo(t+o[0],e):i.moveTo(t,e),o[1]?i.arcTo(a,e,a,h,o[1]):i.lineTo(a,e),o[2]?i.arcTo(a,h,t,h,o[2]):i.lineTo(a,h),o[3]?i.arcTo(t,h,t,e,o[3]):i.lineTo(t,h),o[0]?i.arcTo(t,e,a,e,o[0]):i.lineTo(t,e)}},{sin:ti,cos:Ri,atan2:Jr,ceil:ml,abs:on,PI:to,sqrt:eo,pow:os}=Math,{setPoint:an,addPoint:as}=Vi,{set:hs}=E,{M:wl,L:hn,C:ln,Q:io,Z:xl}=Mt,cn={},je={points(i,t,e,s){if(i.push(wl,t[0],t[1]),e&&t.length>5){let n,r,o,a,h,l,c,p,_,u,f,g,x,w=t.length;const m=e===!0?.5:e;s&&(t=[t[w-2],t[w-1],...t,t[0],t[1],t[2],t[3]],w=t.length);for(let v=2;v<w-2;v+=2)n=t[v-2],r=t[v-1],o=t[v],a=t[v+1],h=t[v+2],l=t[v+3],f=eo(os(o-n,2)+os(a-r,2)),g=eo(os(h-o,2)+os(l-a,2)),x=f+g,f=m*f/x,g=m*g/x,h-=n,l-=r,c=o-f*h,p=a-f*l,v===2?s||i.push(io,c,p,o,a):i.push(ln,_,u,c,p,o,a),_=o+g*h,u=a+g*l;s||i.push(io,_,u,t[w-2],t[w-1])}else for(let n=2,r=t.length;n<r;n+=2)i.push(hn,t[n],t[n+1]);s&&i.push(xl)},rect(i,t,e,s,n){Kt.creator.path=i,Kt.creator.moveTo(t,e).lineTo(t+s,e).lineTo(t+s,e+n).lineTo(t,e+n).lineTo(t,e)},roundRect(i,t,e,s,n,r){Kt.creator.path=[],sh.drawRoundRect(Kt.creator,t,e,s,n,r),i.push(...Kt.convertToCanvasData(Kt.creator.path,!0))},arcTo(i,t,e,s,n,r,o,a,h,l,c){const p=s-t,_=n-e,u=r-s,f=o-n;let g=Jr(_,p),x=Jr(f,u),w=x-g;if(w<0&&(w+=Lt),w===to||on(p+_)<1e-12||on(u+f)<1e-12){i&&i.push(hn,s,n),h&&(an(h,t,e),as(h,s,n)),c&&hs(c,t,e),l&&hs(l,s,n);return}const m=p*f-u*_<0,v=m?-1:1,R=a/Ri(w/2),T=s+R*Ri(g+w/2+ri*v),M=n+R*ti(g+w/2+ri*v);return g-=ri*v,x-=ri*v,ro(i,T,M,a,a,0,g/$,x/$,m,h,l,c)},arc(i,t,e,s,n,r,o,a,h,l){return ro(i,t,e,s,s,0,n,r,o,a,h,l)},ellipse(i,t,e,s,n,r,o,a,h,l,c,p){const _=r*$,u=ti(_),f=Ri(_);let g=o*$,x=a*$;g>to&&(g-=Lt),x<0&&(x+=Lt);let w=x-g;w<0?w+=Lt:w>Lt&&(w-=Lt),h&&(w-=Lt);const m=ml(on(w/ri)),v=w/m,R=ti(v/4),T=8/3*R*R/ti(v/2);x=g+v;let M=Ri(g),O=ti(g),z,et,st,K,Dt,ie,se,ne,q=st=f*s*M-u*n*O,Le=K=u*s*M+f*n*O,me=t+st,vi=e+K;i&&i.push(hn,me,vi),l&&an(l,me,vi),p&&hs(p,me,vi);for(let Bt=0;Bt<m;Bt++)z=Ri(x),et=ti(x),st=f*s*z-u*n*et,K=u*s*z+f*n*et,Dt=t+q-T*(f*s*O+u*n*M),ie=e+Le-T*(u*s*O-f*n*M),se=t+st+T*(f*s*et+u*n*z),ne=e+K+T*(u*s*et-f*n*z),i&&i.push(ln,Dt,ie,se,ne,t+st,e+K),l&&no(t+q,e+Le,Dt,ie,se,ne,t+st,e+K,l,!0),q=st,Le=K,M=z,O=et,g=x,x+=v;c&&hs(c,t+st,e+K)},quadraticCurveTo(i,t,e,s,n,r,o){i.push(ln,(t+2*s)/3,(e+2*n)/3,(r+2*s)/3,(o+2*n)/3,r,o)},toTwoPointBoundsByQuadraticCurve(i,t,e,s,n,r,o,a){no(i,t,(i+2*e)/3,(t+2*s)/3,(n+2*e)/3,(r+2*s)/3,n,r,o,a)},toTwoPointBounds(i,t,e,s,n,r,o,a,h,l){const c=[];let p,_,u,f,g,x,w,m,v=i,R=e,T=n,M=o;for(let O=0;O<2;++O){if(O==1&&(v=t,R=s,T=r,M=a),p=-3*v+9*R-9*T+3*M,_=6*v-12*R+6*T,u=3*R-3*v,Math.abs(p)<1e-12){if(Math.abs(_)<1e-12)continue;f=-u/_,0<f&&f<1&&c.push(f);continue}w=_*_-4*u*p,m=Math.sqrt(w),!(w<0)&&(g=(-_+m)/(2*p),0<g&&g<1&&c.push(g),x=(-_-m)/(2*p),0<x&&x<1&&c.push(x))}l?as(h,i,t):an(h,i,t),as(h,o,a);for(let O=0,z=c.length;O<z;O++)so(c[O],i,t,e,s,n,r,o,a,cn),as(h,cn.x,cn.y)},getPointAndSet(i,t,e,s,n,r,o,a,h,l){const c=1-i,p=c*c*c,_=3*c*c*i,u=3*c*i*i,f=i*i*i;l.x=p*t+_*s+u*r+f*a,l.y=p*e+_*n+u*o+f*h},getPoint(i,t,e,s,n,r,o,a,h){const l={};return so(i,t,e,s,n,r,o,a,h,l),l}},{getPointAndSet:so,toTwoPointBounds:no,ellipse:ro}=je,{sin:vl,cos:bl,sqrt:oo,atan2:ao}=Math,{ellipse:Rl}=je,kl={ellipticalArc(i,t,e,s,n,r,o,a,h,l,c){const p=(h-t)/2,_=(l-e)/2,u=r*$,f=vl(u),g=bl(u),x=-g*p-f*_,w=-g*_+f*p,m=s*s,v=n*n,R=w*w,T=x*x,M=m*v-m*R-v*T;let O=0;if(M<0){const q=oo(1-M/(m*v));s*=q,n*=q}else O=(o===a?-1:1)*oo(M/(m*R+v*T));const z=O*s*w/n,et=-O*n*x/s,st=ao((w-et)/n,(x-z)/s),K=ao((-w-et)/n,(-x-z)/s);let Dt=K-st;a===0&&Dt>0?Dt-=Lt:a===1&&Dt<0&&(Dt+=Lt);const ie=t+p+g*z-f*et,se=e+_+f*z+g*et,ne=Dt<0?1:0;c||b.ellipseToCurve?Rl(i,ie,se,s,n,r,st/$,K/$,ne):s===n&&!r?i.push(Mt.O,ie,se,s,st/$,K/$,ne):i.push(Mt.G,ie,se,s,n,r,st/$,K/$,ne)}},{M:ho,m:Bl,L:ls,l:Sl,H:Cl,h:El,V:Tl,v:Pl,C:ki,c:Ol,S:un,s:Ll,Q:Bi,q:Ml,T:dn,t:Al,A:Dl,a:Il,Z:lo,z:Wl,N:$l,D:Fl,X:zl,G:Hl,F:Nl,O:jl,P:Gl,U:Ul}=Mt,{rect:Yl,roundRect:co,arcTo:Vl,arc:uo,ellipse:fo,quadraticCurveTo:_o}=je,{ellipticalArc:Xl}=kl,Kl=F.get("PathConvert"),oe={},Ge={current:{dot:0},stringify(i,t){let e=0,s=i.length,n,r="",o,a;for(;e<s;){o=i[e],n=ih[o],o===a?r+=" ":r+=eh[o];for(let h=1;h<n;h++)r+=At.float(i[e+h],t),h===n-1||(r+=" ");a=o,e+=n}return r},parse(i,t){let e,s,n,r="";const o=[],a=t?yl:th;for(let h=0,l=i.length;h<l;h++)s=i[h],cl[s]?(s==="."&&(Et.dot&&(Ie(o,r),r=""),Et.dot++),r==="0"&&s!=="."&&(Ie(o,r),r=""),r+=s):Mt[s]?(r&&(Ie(o,r),r=""),Et.name=Mt[s],Et.length=Ja[s],Et.index=0,Ie(o,Et.name),!e&&a[s]&&(e=!0)):s==="-"||s==="+"?n==="e"||n==="E"?r+=s:(r&&Ie(o,r),r=s):r&&(Ie(o,r),r=""),n=s;return r&&Ie(o,r),e?Ge.toCanvasData(o,t):o},toCanvasData(i,t){let e=0,s=0,n=0,r=0,o=0,a=i.length,h,l,c,p,_;const u=[];for(;o<a;){switch(c=i[o],c){case Bl:i[o+1]+=e,i[o+2]+=s;case ho:e=i[o+1],s=i[o+2],u.push(ho,e,s),o+=3;break;case El:i[o+1]+=e;case Cl:e=i[o+1],u.push(ls,e,s),o+=2;break;case Pl:i[o+1]+=s;case Tl:s=i[o+1],u.push(ls,e,s),o+=2;break;case Sl:i[o+1]+=e,i[o+2]+=s;case ls:e=i[o+1],s=i[o+2],u.push(ls,e,s),o+=3;break;case Ll:i[o+1]+=e,i[o+2]+=s,i[o+3]+=e,i[o+4]+=s,c=un;case un:_=p===ki||p===un,n=_?e*2-h:i[o+1],r=_?s*2-l:i[o+2],h=i[o+1],l=i[o+2],e=i[o+3],s=i[o+4],u.push(ki,n,r,h,l,e,s),o+=5;break;case Ol:i[o+1]+=e,i[o+2]+=s,i[o+3]+=e,i[o+4]+=s,i[o+5]+=e,i[o+6]+=s,c=ki;case ki:h=i[o+3],l=i[o+4],e=i[o+5],s=i[o+6],u.push(ki,i[o+1],i[o+2],h,l,e,s),o+=7;break;case Al:i[o+1]+=e,i[o+2]+=s,c=dn;case dn:_=p===Bi||p===dn,h=_?e*2-h:i[o+1],l=_?s*2-l:i[o+2],t?_o(u,e,s,h,l,i[o+1],i[o+2]):u.push(Bi,h,l,i[o+1],i[o+2]),e=i[o+1],s=i[o+2],o+=3;break;case Ml:i[o+1]+=e,i[o+2]+=s,i[o+3]+=e,i[o+4]+=s,c=Bi;case Bi:h=i[o+1],l=i[o+2],t?_o(u,e,s,h,l,i[o+3],i[o+4]):u.push(Bi,h,l,i[o+3],i[o+4]),e=i[o+3],s=i[o+4],o+=5;break;case Il:i[o+6]+=e,i[o+7]+=s;case Dl:Xl(u,e,s,i[o+1],i[o+2],i[o+3],i[o+4],i[o+5],i[o+6],i[o+7],t),e=i[o+6],s=i[o+7],o+=8;break;case Wl:case lo:u.push(lo),o++;break;case $l:e=i[o+1],s=i[o+2],t?Yl(u,e,s,i[o+3],i[o+4]):xe(u,i,o,5),o+=5;break;case Fl:e=i[o+1],s=i[o+2],t?co(u,e,s,i[o+3],i[o+4],[i[o+5],i[o+6],i[o+7],i[o+8]]):xe(u,i,o,9),o+=9;break;case zl:e=i[o+1],s=i[o+2],t?co(u,e,s,i[o+3],i[o+4],i[o+5]):xe(u,i,o,6),o+=6;break;case Hl:fo(t?u:xe(u,i,o,9),i[o+1],i[o+2],i[o+3],i[o+4],i[o+5],i[o+6],i[o+7],i[o+8],null,oe),e=oe.x,s=oe.y,o+=9;break;case Nl:t?fo(u,i[o+1],i[o+2],i[o+3],i[o+4],0,0,360,!1):xe(u,i,o,5),e=i[o+1]+i[o+3],s=i[o+2],o+=5;break;case jl:uo(t?u:xe(u,i,o,7),i[o+1],i[o+2],i[o+3],i[o+4],i[o+5],i[o+6],null,oe),e=oe.x,s=oe.y,o+=7;break;case Gl:t?uo(u,i[o+1],i[o+2],i[o+3],0,360,!1):xe(u,i,o,4),e=i[o+1]+i[o+3],s=i[o+2],o+=4;break;case Ul:Vl(t?u:xe(u,i,o,6),e,s,i[o+1],i[o+2],i[o+3],i[o+4],i[o+5],null,oe),e=oe.x,s=oe.y,o+=6;break;default:return Kl.error(`command: ${c} [index:${o}]`,i),u}p=c}return u},copyData(i,t,e,s){for(let n=e,r=e+s;n<r;n++)i.push(t[n])},pushData(i,t){Et.index===Et.length&&(Et.index=1,i.push(Et.name)),i.push(Number(t)),Et.index++,Et.dot=0}},{current:Et,pushData:Ie,copyData:xe}=Ge,{M:fn,L:ql,C:Zl,Q:Ql,Z:Jl,N:po,D:tc,X:ec,G:ic,F:sc,O:nc,P:rc,U:go}=Mt,{getMinDistanceFrom:oc,getRadianFrom:ac}=E,{tan:hc,min:lc,abs:cc}=Math,ei={},Xe={beginPath(i){i.length=0},moveTo(i,t,e){i.push(fn,t,e)},lineTo(i,t,e){i.push(ql,t,e)},bezierCurveTo(i,t,e,s,n,r,o){i.push(Zl,t,e,s,n,r,o)},quadraticCurveTo(i,t,e,s,n){i.push(Ql,t,e,s,n)},closePath(i){i.push(Jl)},rect(i,t,e,s,n){i.push(po,t,e,s,n)},roundRect(i,t,e,s,n,r){if(typeof r=="number")i.push(ec,t,e,s,n,r);else{const o=At.fourNumber(r);o?i.push(tc,t,e,s,n,...o):i.push(po,t,e,s,n)}},ellipse(i,t,e,s,n,r,o,a,h){r===void 0?i.push(sc,t,e,s,n):(o===void 0&&(o=0),a===void 0&&(a=360),i.push(ic,t,e,s,n,r,o,a,h?1:0))},arc(i,t,e,s,n,r,o){n===void 0?i.push(rc,t,e,s):(r===void 0&&(r=360),i.push(nc,t,e,s,n,r,o?1:0))},arcTo(i,t,e,s,n,r,o,a){if(o!==void 0){const h=hc(ac(o,a,t,e,s,n)/2)*(oc(o,a,t,e,s,n)/2);i.push(go,t,e,s,n,lc(r,cc(h)))}else i.push(go,t,e,s,n,r)},drawEllipse(i,t,e,s,n,r,o,a,h){je.ellipse(null,t,e,s,n,r===void 0?0:r,o===void 0?0:o,a===void 0?360:a,h,null,null,ei),i.push(fn,ei.x,ei.y),uc(i,t,e,s,n,r,o,a,h)},drawArc(i,t,e,s,n,r,o){je.arc(null,t,e,s,n===void 0?0:n,r===void 0?360:r,o,null,null,ei),i.push(fn,ei.x,ei.y),dc(i,t,e,s,n,r,o)},drawPoints(i,t,e,s){je.points(i,t,e,s)}},{ellipse:uc,arc:dc}=Xe,{moveTo:fc,lineTo:_c,quadraticCurveTo:pc,bezierCurveTo:gc,closePath:yc,beginPath:mc,rect:wc,roundRect:xc,ellipse:vc,arc:bc,arcTo:Rc,drawEllipse:kc,drawArc:Bc,drawPoints:Sc}=Xe;class vr{set path(t){this.__path=t}get path(){return this.__path}constructor(t){this.clearPath=this.beginPath,this.set(t)}set(t){return t?this.__path=typeof t=="string"?Kt.parse(t):t:this.__path=[],this}beginPath(){return mc(this.__path),this}moveTo(t,e){return fc(this.__path,t,e),this}lineTo(t,e){return _c(this.__path,t,e),this}bezierCurveTo(t,e,s,n,r,o){return gc(this.__path,t,e,s,n,r,o),this}quadraticCurveTo(t,e,s,n){return pc(this.__path,t,e,s,n),this}closePath(){return yc(this.__path),this}rect(t,e,s,n){return wc(this.__path,t,e,s,n),this}roundRect(t,e,s,n,r){return xc(this.__path,t,e,s,n,r),this}ellipse(t,e,s,n,r,o,a,h){return vc(this.__path,t,e,s,n,r,o,a,h),this}arc(t,e,s,n,r,o){return bc(this.__path,t,e,s,n,r,o),this}arcTo(t,e,s,n,r){return Rc(this.__path,t,e,s,n,r),this}drawEllipse(t,e,s,n,r,o,a,h){return kc(this.__path,t,e,s,n,r,o,a,h),this}drawArc(t,e,s,n,r,o){return Bc(this.__path,t,e,s,n,r,o),this}drawPoints(t,e,s){return Sc(this.__path,t,e,s),this}}const{M:Cc,L:Ec,C:Tc,Q:Pc,Z:Oc,N:Lc,D:Mc,X:Ac,G:Dc,F:Ic,O:Wc,P:$c,U:Fc}=Mt,zc=F.get("PathDrawer"),Hc={drawPathByData(i,t){if(!t)return;let e,s=0,n=t.length;for(;s<n;)switch(e=t[s],e){case Cc:i.moveTo(t[s+1],t[s+2]),s+=3;break;case Ec:i.lineTo(t[s+1],t[s+2]),s+=3;break;case Tc:i.bezierCurveTo(t[s+1],t[s+2],t[s+3],t[s+4],t[s+5],t[s+6]),s+=7;break;case Pc:i.quadraticCurveTo(t[s+1],t[s+2],t[s+3],t[s+4]),s+=5;break;case Oc:i.closePath(),s+=1;break;case Lc:i.rect(t[s+1],t[s+2],t[s+3],t[s+4]),s+=5;break;case Mc:i.roundRect(t[s+1],t[s+2],t[s+3],t[s+4],[t[s+5],t[s+6],t[s+7],t[s+8]]),s+=9;break;case Ac:i.roundRect(t[s+1],t[s+2],t[s+3],t[s+4],t[s+5]),s+=6;break;case Dc:i.ellipse(t[s+1],t[s+2],t[s+3],t[s+4],t[s+5]*$,t[s+6]*$,t[s+7]*$,t[s+8]),s+=9;break;case Ic:i.ellipse(t[s+1],t[s+2],t[s+3],t[s+4],0,0,Lt,!1),s+=5;break;case Wc:i.arc(t[s+1],t[s+2],t[s+3],t[s+4]*$,t[s+5]*$,t[s+6]),s+=7;break;case $c:i.arc(t[s+1],t[s+2],t[s+3],0,Lt,!1),s+=4;break;case Fc:i.arcTo(t[s+1],t[s+2],t[s+3],t[s+4],t[s+5]),s+=6;break;default:zc.error(`command: ${e} [index:${s}]`,t);return}}},{M:Nc,L:jc,C:yo,Q:mo,Z:wo,N:Gc,D:xo,X:Uc,G:Yc,F:Vc,O:Xc,P:Kc,U:qc}=Mt,{toTwoPointBounds:Zc,toTwoPointBoundsByQuadraticCurve:Qc,arcTo:Jc,arc:tu,ellipse:eu}=je,{addPointBounds:Si,copy:_n,addPoint:iu,setPoint:pn,addBounds:cs,toBounds:su}=Vi,nu=F.get("PathBounds");let ii,us,gn;const vt={},vo={},ae={},br={toBounds(i,t){br.toTwoPointBounds(i,vo),su(vo,t)},toTwoPointBounds(i,t){if(!i||!i.length)return pn(t,0,0);let e,s=0,n=0,r=0,o,a,h,l;const c=i.length;for(;s<c;)switch(e=i[s],s===0&&(e===wo||e===yo||e===mo?pn(t,n,r):pn(t,i[s+1],i[s+2])),e){case Nc:case jc:n=i[s+1],r=i[s+2],iu(t,n,r),s+=3;break;case yo:h=i[s+5],l=i[s+6],Zc(n,r,i[s+1],i[s+2],i[s+3],i[s+4],h,l,vt),Si(t,vt),n=h,r=l,s+=7;break;case mo:o=i[s+1],a=i[s+2],h=i[s+3],l=i[s+4],Qc(n,r,o,a,h,l,vt),Si(t,vt),n=h,r=l,s+=5;break;case wo:s+=1;break;case Gc:n=i[s+1],r=i[s+2],cs(t,n,r,i[s+3],i[s+4]),s+=5;break;case xo:case Uc:n=i[s+1],r=i[s+2],cs(t,n,r,i[s+3],i[s+4]),s+=e===xo?9:6;break;case Yc:eu(null,i[s+1],i[s+2],i[s+3],i[s+4],i[s+5],i[s+6],i[s+7],i[s+8],vt,ae),s===0?_n(t,vt):Si(t,vt),n=ae.x,r=ae.y,s+=9;break;case Vc:n=i[s+1],r=i[s+2],us=i[s+3],gn=i[s+4],cs(t,n-us,r-gn,us*2,gn*2),n+=us,s+=5;break;case Xc:tu(null,i[s+1],i[s+2],i[s+3],i[s+4],i[s+5],i[s+6],vt,ae),s===0?_n(t,vt):Si(t,vt),n=ae.x,r=ae.y,s+=7;break;case Kc:n=i[s+1],r=i[s+2],ii=i[s+3],cs(t,n-ii,r-ii,ii*2,ii*2),n+=ii,s+=4;break;case qc:Jc(null,n,r,i[s+1],i[s+2],i[s+3],i[s+4],i[s+5],vt,ae),s===0?_n(t,vt):Si(t,vt),n=ae.x,r=ae.y,s+=6;break;default:nu.error(`command: ${e} [index:${s}]`,i);return}}},{M:yn,L:ds,C:bo,Z:fs}=Mt,{getCenterX:ru,getCenterY:ou}=E,{arcTo:mn}=Xe,au={smooth(i,t,e){let s,n=0,r=0,o=0,a=0,h=0,l=0,c=0,p=0,_=0;const u=i.length,f=[];for(;n<u;)switch(s=i[n],s){case yn:a=p=i[n+1],h=_=i[n+2],n+=3,i[n]===ds?(l=i[n+1],c=i[n+2],f.push(yn,ru(a,l),ou(h,c))):f.push(yn,a,h);break;case ds:switch(r=i[n+1],o=i[n+2],n+=3,i[n]){case ds:mn(f,r,o,i[n+1],i[n+2],t,p,_);break;case fs:mn(f,r,o,a,h,t,p,_);break;default:f.push(ds,r,o)}p=r,_=o;break;case bo:f.push(bo,i[n+1],i[n+2],i[n+3],i[n+4],i[n+5],i[n+6]),n+=7;break;case fs:mn(f,a,h,l,c,t,p,_),f.push(fs),n+=1;break}return s!==fs&&(f[1]=a,f[2]=h),f}};Kt.creator=new vr;Kt.parse=Ge.parse;Kt.convertToCanvasData=Ge.toCanvasData;const Ci=new vr,{drawRoundRect:hu}=sh;function lu(i){i&&!i.roundRect&&(i.roundRect=function(t,e,s,n,r){hu(this,t,e,s,n,r)})}function nh(i){lu(i)}const fe={opacityTypes:["png","webp","svg"],upperCaseTypeMap:{},mineType(i){return!i||i.startsWith("image")?i:(i==="jpg"&&(i="jpeg"),"image/"+i)},fileType(i){const t=i.split(".");return t[t.length-1]},isOpaqueImage(i){const t=ir.fileType(i);return["jpg","jpeg"].some(e=>e===t)},getExportOptions(i){switch(typeof i){case"object":return i;case"number":return{quality:i};case"boolean":return{blob:i};default:return{}}}},ir=fe;ir.opacityTypes.forEach(i=>ir.upperCaseTypeMap[i]=i.toUpperCase());const cu=F.get("TaskProcessor");class uu{constructor(t){this.parallel=!0,this.time=1,this.id=_e.create(_e.TASK),this.task=t}run(){return qa(this,void 0,void 0,function*(){try{this.task&&!this.isComplete&&this.parent.running&&(yield this.task())}catch(t){cu.error(t)}})}complete(){this.isComplete=!0,this.parent=null,this.task=null}cancel(){this.isCancel=!0,this.complete()}}class sr{get total(){return this.list.length+this.delayNumber}get finishedIndex(){return this.isComplete?0:this.index+this.parallelSuccessNumber}get remain(){return this.isComplete?this.total:this.total-this.finishedIndex}get percent(){const{total:t}=this;let e=0,s=0;for(let n=0;n<t;n++)n<=this.finishedIndex?(s+=this.list[n].time,n===this.finishedIndex&&(e=s)):e+=this.list[n].time;return this.isComplete?1:s/e}constructor(t){this.config={parallel:6},this.list=[],this.running=!1,this.isComplete=!0,this.index=0,this.delayNumber=0,t&&at.assign(this.config,t),this.empty()}add(t,e){let s,n,r,o;const a=new uu(t);return a.parent=this,typeof e=="number"?o=e:e&&(n=e.parallel,s=e.start,r=e.time,o=e.delay),r&&(a.time=r),n===!1&&(a.parallel=!1),o===void 0?this.push(a,s):(this.delayNumber++,setTimeout(()=>{this.delayNumber&&(this.delayNumber--,this.push(a,s))},o)),this.isComplete=!1,a}push(t,e){this.list.push(t),e!==!1&&!this.timer&&(this.timer=setTimeout(()=>this.start()))}empty(){this.index=0,this.parallelSuccessNumber=0,this.list=[],this.parallelList=[],this.delayNumber=0}start(){this.running||(this.running=!0,this.isComplete=!1,this.run())}pause(){clearTimeout(this.timer),this.timer=null,this.running=!1}resume(){this.start()}skip(){this.index++,this.resume()}stop(){this.isComplete=!0,this.list.forEach(t=>{t.isComplete||t.cancel()}),this.pause(),this.empty()}run(){this.running&&(this.setParallelList(),this.parallelList.length>1?this.runParallelTasks():this.remain?this.runTask():this.onComplete())}runTask(){const t=this.list[this.index];if(!t){this.nextTask();return}t.run().then(()=>{this.onTask(t),this.index++,this.nextTask()}).catch(e=>{this.onError(e)})}runParallelTasks(){this.parallelList.forEach(t=>this.runParallelTask(t))}runParallelTask(t){t.run().then(()=>{this.onTask(t),this.fillParallelTask()}).catch(e=>{this.onParallelError(e)})}nextTask(){this.total===this.finishedIndex?this.onComplete():this.timer=setTimeout(()=>this.run())}setParallelList(){let t;this.parallelList=[],this.parallelSuccessNumber=0;let e=this.index+this.config.parallel;e>this.list.length&&(e=this.list.length);for(let s=this.index;s<e&&(t=this.list[s],t.parallel);s++)this.parallelList.push(t)}fillParallelTask(){let t;const e=this.parallelList;this.parallelSuccessNumber++,e.pop();const s=e.length,n=this.finishedIndex+s;if(e.length){if(!this.running)return;n<this.total&&(t=this.list[n],t&&t.parallel&&(e.push(t),this.runParallelTask(t)))}else this.index+=this.parallelSuccessNumber,this.parallelSuccessNumber=0,this.nextTask()}onComplete(){this.stop(),this.config.onComplete&&this.config.onComplete()}onTask(t){t.complete(),this.config.onTask&&this.config.onTask()}onParallelError(t){this.parallelList.forEach(e=>{e.parallel=!1}),this.parallelList.length=0,this.parallelSuccessNumber=0,this.onError(t)}onError(t){this.pause(),this.config.onError&&this.config.onError(t)}destroy(){this.stop()}}const xt={map:{},recycledList:[],tasker:new sr,patternTasker:new sr,get isComplete(){return he.tasker.isComplete},get(i){let t=he.map[i.url];return t||(t=nt.image(i),he.map[i.url]=t),t.use++,t},recycle(i){i.use--,setTimeout(()=>{i.use||he.recycledList.push(i)})},clearRecycled(){const i=he.recycledList;i.length>100&&(i.forEach(t=>{!t.use&&t.url&&(delete he.map[t.url],t.destroy())}),i.length=0)},hasOpacityPixel(i){return fe.opacityTypes.some(t=>he.isFormat(t,i))},isFormat(i,t){if(t.format===i)return!0;const{url:e}=t;if(e.startsWith("data:")){if(e.startsWith("data:"+fe.mineType(i)))return!0}else if(e.includes("."+i)||e.includes("."+fe.upperCaseTypeMap[i]))return!0;return!1},destroy(){he.map={},he.recycledList=[]}},he=xt,{IMAGE:du,create:fu}=_e;class _u{get url(){return this.config.url}get completed(){return this.ready||!!this.error}constructor(t){this.use=0,this.waitComplete=[],this.innerId=fu(du),this.config=t||{url:""},this.isSVG=xt.isFormat("svg",t),this.hasOpacityPixel=xt.hasOpacityPixel(t)}load(t,e){return this.loading||(this.loading=!0,xt.tasker.add(()=>qa(this,void 0,void 0,function*(){return yield b.origin.loadImage(this.url).then(s=>{this.ready=!0,this.width=s.naturalWidth||s.width,this.height=s.naturalHeight||s.height,this.view=s,this.onComplete(!0)}).catch(s=>{this.error=s,this.onComplete(!1)})}))),this.waitComplete.push(t,e),this.waitComplete.length-2}unload(t,e){const s=this.waitComplete;if(e){const n=s[t+1];n&&n({type:"stop"})}s[t]=s[t+1]=void 0}onComplete(t){let e;this.waitComplete.forEach((s,n)=>{e=n%2,s&&(t?e||s(this):e&&s(this.error))}),this.waitComplete.length=0,this.loading=!1}getCanvas(t,e,s,n){if(t||(t=this.width),e||(e=this.height),this.cache){let{params:a,data:h}=this.cache;for(let l in a)if(a[l]!==arguments[l]){h=null;break}if(h)return h}const r=b.origin.createCanvas(t,e),o=r.getContext("2d");return s&&(o.globalAlpha=s),o.drawImage(this.view,0,0,t,e),this.cache=this.use>1?{data:r,params:arguments}:null,r}getPattern(t,e,s,n){const r=b.canvas.createPattern(t,e);try{s&&r.setTransform&&(r.setTransform(s),s=null)}catch{}return n&&(n.transform=s),r}destroy(){this.config={url:""},this.cache=null,this.waitComplete.length=0}}function mi(i,t,e,s){e.configurable=e.enumerable=!0,Object.defineProperty(i,t,e)}function rh(i,t){return Object.getOwnPropertyDescriptor(i,t)}function pu(i){return Object.getOwnPropertyNames(i)}function Q(i,t){return(e,s)=>gu(e,s,i,t&&t(s))}function gu(i,t,e,s){mi(i,t,Object.assign({get(){return this.__getAttr(t)},set(r){this.__setAttr(t,r)}},s||{})),lh(i,t,e)}function dt(i){return Q(i)}function wi(i,t){return Q(i,e=>({set(s){this.__setAttr(e,s,t)&&(this.__layout.matrixChanged||this.__layout.matrixChange())}}))}function Ws(i){return Q(i,t=>({set(e){this.__setAttr(t,e)&&(this.__layout.matrixChanged||this.__layout.matrixChange(),this.__hasAutoLayout=!!e,this.__local||this.__layout.createLocal())}}))}function oh(i,t){return Q(i,e=>({set(s){this.__setAttr(e,s,t)&&(this.__layout.scaleChanged||this.__layout.scaleChange())}}))}function Rr(i,t){return Q(i,e=>({set(s){this.__setAttr(e,s,t)&&(this.__layout.rotationChanged||this.__layout.rotationChange())}}))}function L(i,t){return Q(i,e=>({set(s){this.__setAttr(e,s,t)&&xi(this)}}))}function yu(i){return Q(i,t=>({set(e){this.__setAttr(t,e)&&(xi(this),this.__.__removeNaturalSize())}}))}function xi(i){i.__layout.boxChanged||i.__layout.boxChange(),i.__hasAutoLayout&&(i.__layout.matrixChanged||i.__layout.matrixChange())}function mu(i){return Q(i,t=>({set(e){const s=this.__;s.__pathInputed!==2&&(s.__pathInputed=e?1:0),e||(s.__pathForRender=void 0),this.__setAttr(t,e),xi(this)}}))}const gt=L;function $s(i){return Q(i,t=>({set(e){this.__setAttr(t,e)&&ah(this)}}))}function ah(i){i.__layout.strokeChanged||i.__layout.strokeChange(),i.__.__useArrow&&xi(i)}const Jt=$s;function hh(i){return Q(i,t=>({set(e){this.__setAttr(t,e),this.__layout.renderChanged||this.__layout.renderChange()}}))}function Xi(i){return Q(i,t=>({set(e){this.__setAttr(t,e)&&(this.__layout.surfaceChanged||this.__layout.surfaceChange())}}))}function wu(i){return Q(i,t=>({set(e){this.__setAttr(t,e)&&(this.__layout.opacityChanged||this.__layout.opacityChange())}}))}function xu(i){return Q(i,t=>({set(e){const s=this.visible;this.__setAttr(t,e)&&(this.__layout.opacityChanged||this.__layout.opacityChange(),(s===0||e===0)&&xi(this))}}))}function vu(i){return Q(i,t=>({set(e){this.__setAttr(t,e)&&(this.__layout.surfaceChanged||this.__layout.surfaceChange(),this.waitParent(()=>{this.parent.__layout.childrenSortChange()}))}}))}function bu(i){return Q(i,t=>({set(e){this.__setAttr(t,e)&&(this.__layout.boxChanged||this.__layout.boxChange(),this.waitParent(()=>{this.parent.__updateMask(e)}))}}))}function Ru(i){return Q(i,t=>({set(e){this.__setAttr(t,e)&&this.waitParent(()=>{this.parent.__updateEraser(e)})}}))}function Ke(i){return Q(i,t=>({set(e){this.__setAttr(t,e)&&(this.__layout.hitCanvasChanged=!0,F.showHitView&&(this.__layout.surfaceChanged||this.__layout.surfaceChange()),this.leafer&&this.leafer.updateCursor())}}))}function ku(i){return Q(i,t=>({set(e){this.__setAttr(t,e),this.leafer&&this.leafer.updateCursor()}}))}function lt(i){return(t,e)=>{mi(t,"__DataProcessor",{get(){return i}})}}function Bu(i){return"set"+i.charAt(0).toUpperCase()+i.slice(1)}function lh(i,t,e){const s=i.__DataProcessor.prototype,n="_"+t,r=Bu(t),o={get(){const l=this[n];return l===void 0?e:l},set(l){this[n]=l}};e===void 0?o.get=function(){return this[n]}:t==="width"?o.get=function(){const l=this[n];if(l===void 0){const c=this;return c._height&&c.__naturalWidth&&c.__useNaturalRatio?c._height*c.__naturalWidth/c.__naturalHeight:c.__naturalWidth||e}else return l}:t==="height"&&(o.get=function(){const l=this[n];if(l===void 0){const c=this;return c._width&&c.__naturalHeight&&c.__useNaturalRatio?c._width*c.__naturalHeight/c.__naturalWidth:c.__naturalHeight||e}else return l});let a,h=s;for(;!a&&h;)a=rh(h,t),h=h.__proto__;a&&a.set&&(o.set=a.set),s[r]&&(o.set=s[r],delete s[r]),mi(s,t,o)}const Su=new F("rewrite"),Bs=[],Cu=["destroy","constructor"];function jt(i){return(t,e)=>{Bs.push({name:t.constructor.name+"."+e,run:()=>{t[e]=i}})}}function Fs(){return i=>{ch()}}function ch(i){Bs.length&&(Bs.forEach(t=>{i&&Su.error(t.name,"Class@rewriteAble()"),t.run()}),Bs.length=0)}setTimeout(()=>ch(!0));function $t(i,t){return e=>{(i.prototype?pu(i.prototype):Object.keys(i)).forEach(n=>{!Cu.includes(n)&&(!t||!t.includes(n))&&(i.prototype?rh(i.prototype,n).writable&&(e.prototype[n]=i.prototype[n]):e.prototype[n]=i[n])})}}function ct(){return i=>{Is.register(i)}}function Pe(){return i=>{fi.register(i)}}const{copy:si,toInnerPoint:Eu,scaleOfOuter:Ro,rotateOfOuter:Tu,skewOfOuter:Pu,multiplyParent:ko,divideParent:Bo,getLayout:Ou}=P,J={},te={updateAllMatrix(i,t,e){if(t&&i.__hasAutoLayout&&i.__layout.matrixChanged&&(e=!0),Mu(i,t,e),i.isBranch){const{children:s}=i;for(let n=0,r=s.length;n<r;n++)Lu(s[n],t,e)}},updateMatrix(i,t,e){const s=i.__layout;t?e&&(s.waitAutoLayout=!0,i.__hasAutoLayout&&(s.matrixChanged=!1)):s.waitAutoLayout&&(s.waitAutoLayout=!1),s.matrixChanged&&i.__updateLocalMatrix(),s.waitAutoLayout||i.__updateWorldMatrix()},updateBounds(i){const t=i.__layout;t.boundsChanged&&i.__updateLocalBounds(),t.waitAutoLayout||i.__updateWorldBounds()},updateAllWorldOpacity(i){if(i.__updateWorldOpacity(),i.isBranch){const{children:t}=i;for(let e=0,s=t.length;e<s;e++)So(t[e])}},updateAllChange(i){if(So(i),i.__updateChange(),i.isBranch){const{children:t}=i;for(let e=0,s=t.length;e<s;e++)Au(t[e])}},worldHittable(i){for(;i;){if(!i.__.hittable)return!1;i=i.parent}return!0},moveWorld(i,t,e=0){const s=typeof t=="object"?Object.assign({},t):{x:t,y:e};i.parent&&Eu(i.parent.worldTransform,s,s,!0),ft.moveLocal(i,s.x,s.y)},moveLocal(i,t,e=0){typeof t=="object"?(i.x+=t.x,i.y+=t.y):(i.x+=t,i.y+=e)},zoomOfWorld(i,t,e,s,n){ft.zoomOfLocal(i,wn(i,t),e,s,n)},zoomOfLocal(i,t,e,s=e,n){si(J,i.__localMatrix),Ro(J,t,e,s),i.origin||i.around?ft.setTransform(i,J,n):(Co(i,J),i.scaleResize(e,s,n!==!0))},rotateOfWorld(i,t,e){ft.rotateOfLocal(i,wn(i,t),e)},rotateOfLocal(i,t,e){si(J,i.__localMatrix),Tu(J,t,e),i.origin||i.around?ft.setTransform(i,J):(Co(i,J),i.rotation=At.formatRotation(i.rotation+e))},skewOfWorld(i,t,e,s,n){ft.skewOfLocal(i,wn(i,t),e,s,n)},skewOfLocal(i,t,e,s=0,n){si(J,i.__localMatrix),Pu(J,t,e,s),ft.setTransform(i,J,n)},transformWorld(i,t,e){si(J,i.worldTransform),ko(J,t),i.parent&&Bo(J,i.parent.worldTransform),ft.setTransform(i,J,e)},transform(i,t,e){si(J,i.localTransform),ko(J,t),ft.setTransform(i,J,e)},setTransform(i,t,e){const s=Ou(t,i.origin&&ft.getInnerOrigin(i,i.origin),i.around&&ft.getInnerOrigin(i,i.around));if(e){const n=s.scaleX/i.scaleX,r=s.scaleY/i.scaleY;delete s.scaleX,delete s.scaleY,i.set(s),i.scaleResize(n,r,e!==!0)}else i.set(s)},getFlipTransform(i,t){const e=Es(),s=t==="x"?1:-1;return Ro(e,ft.getLocalOrigin(i,"center"),-1*s,1*s),e},getLocalOrigin(i,t){return E.tempToOuterOf(ft.getInnerOrigin(i,t),i.localTransform)},getInnerOrigin(i,t){const e={};return yi.toPoint(t,i.boxBounds,e),e},getRelativeWorld(i,t,e){return si(J,i.worldTransform),Bo(J,t.worldTransform),e?J:Object.assign({},J)},drop(i,t,e,s){i.setTransform(ft.getRelativeWorld(i,t,!0),s),t.add(i,e)},hasParent(i,t){if(!t)return!1;for(;i;){if(t===i)return!0;i=i.parent}}},ft=te,{updateAllMatrix:Lu,updateMatrix:Mu,updateAllWorldOpacity:So,updateAllChange:Au}=ft;function Co(i,t){const{e,f:s}=i.__localMatrix;i.x+=t.e-e,i.y+=t.f-s}function wn(i,t){return i.__layout.update(),i.parent?E.tempToInnerOf(t,i.parent.__world):t}const zs={worldBounds(i){return i.__world},localBoxBounds(i){return i.__.eraser||i.__.visible===0?null:i.__local||i.__layout},localStrokeBounds(i){return i.__.eraser||i.__.visible===0?null:i.__layout.localStrokeBounds},localRenderBounds(i){return i.__.eraser||i.__.visible===0?null:i.__layout.localRenderBounds},maskLocalBoxBounds(i){return i.__.mask?i.__localBoxBounds:null},maskLocalStrokeBounds(i){return i.__.mask?i.__layout.localStrokeBounds:null},maskLocalRenderBounds(i){return i.__.mask?i.__layout.localRenderBounds:null},excludeRenderBounds(i,t){return!!(t.bounds&&!t.bounds.hit(i.__world,t.matrix)||t.hideBounds&&t.hideBounds.includes(i.__world,t.matrix))}},{updateBounds:Eo}=te,Ki={sort(i,t){return i.__.zIndex===t.__.zIndex?i.__tempNumber-t.__tempNumber:i.__.zIndex-t.__.zIndex},pushAllChildBranch(i,t){if(i.__tempNumber=1,i.__.__childBranchNumber){const{children:e}=i;for(let s=0,n=e.length;s<n;s++)i=e[s],i.isBranch&&(i.__tempNumber=1,t.add(i),Du(i,t))}},pushAllParent(i,t){const{keys:e}=t;if(e)for(;i.parent&&e[i.parent.innerId]===void 0;)t.add(i.parent),i=i.parent;else for(;i.parent;)t.add(i.parent),i=i.parent},pushAllBranchStack(i,t){let e=t.length;const{children:s}=i;for(let n=0,r=s.length;n<r;n++)s[n].isBranch&&t.push(s[n]);for(let n=e,r=t.length;n<r;n++)To(t[n],t)},updateBounds(i,t){const e=[i];To(i,e),Iu(e,t)},updateBoundsByBranchStack(i,t){let e,s;for(let n=i.length-1;n>-1;n--){e=i[n],s=e.children;for(let r=0,o=s.length;r<o;r++)Eo(s[r]);t&&t===e||Eo(e)}}},{pushAllChildBranch:Du,pushAllBranchStack:To,updateBoundsByBranchStack:Iu}=Ki,He={run(i){if(i&&i.length){const t=i.length;for(let e=0;e<t;e++)i[e]();i.length===t?i.length=0:i.splice(0,t)}}},{getRelativeWorld:Po}=te,{toOuterOf:_s,getPoints:Wu,copy:$u}=S,xn="_localContentBounds",vn="_worldContentBounds",bn="_worldBoxBounds",Rn="_worldStrokeBounds";class Fu{get contentBounds(){return this._contentBounds||this.boxBounds}set contentBounds(t){this._contentBounds=t}get strokeBounds(){return this._strokeBounds||this.boxBounds}get renderBounds(){return this._renderBounds||this.boxBounds}get localContentBounds(){return _s(this.contentBounds,this.leaf.__localMatrix,this[xn]||(this[xn]={})),this[xn]}get localStrokeBounds(){return this._localStrokeBounds||this}get localRenderBounds(){return this._localRenderBounds||this}get worldContentBounds(){return _s(this.contentBounds,this.leaf.__world,this[vn]||(this[vn]={})),this[vn]}get worldBoxBounds(){return _s(this.boxBounds,this.leaf.__world,this[bn]||(this[bn]={})),this[bn]}get worldStrokeBounds(){return _s(this.strokeBounds,this.leaf.__world,this[Rn]||(this[Rn]={})),this[Rn]}get a(){return 1}get b(){return 0}get c(){return 0}get d(){return 1}get e(){return this.leaf.__.x}get f(){return this.leaf.__.y}get x(){return this.e+this.boxBounds.x}get y(){return this.f+this.boxBounds.y}get width(){return this.boxBounds.width}get height(){return this.boxBounds.height}constructor(t){this.leaf=t,this.boxBounds={x:0,y:0,width:0,height:0},this.leaf.__local&&(this._localRenderBounds=this._localStrokeBounds=this.leaf.__local),this.boxChange(),this.matrixChange()}createLocal(){const t=this.leaf.__local={a:1,b:0,c:0,d:1,e:0,f:0,x:0,y:0,width:0,height:0};this._localStrokeBounds||(this._localStrokeBounds=t),this._localRenderBounds||(this._localRenderBounds=t)}update(){const{leafer:t}=this.leaf;if(t)t.ready?t.watcher.changed&&t.layouter.layout():t.start();else{let e=this.leaf;for(;e.parent&&!e.parent.leafer;)e=e.parent;b.layout(e)}}getTransform(t="world"){this.update();const{leaf:e}=this;switch(t){case"world":return e.__world;case"local":return e.__localMatrix;case"inner":return P.defaultMatrix;case"page":t=e.zoomLayer;default:return Po(e,t)}}getBounds(t,e="world"){switch(this.update(),e){case"world":return this.getWorldBounds(t);case"local":return this.getLocalBounds(t);case"inner":return this.getInnerBounds(t);case"page":e=this.leaf.zoomLayer;default:return new Z(this.getInnerBounds(t)).toOuterOf(this.getTransform(e))}}getInnerBounds(t="box"){switch(t){case"render":return this.renderBounds;case"content":if(this.contentBounds)return this.contentBounds;case"box":return this.boxBounds;case"stroke":return this.strokeBounds}}getLocalBounds(t="box"){switch(t){case"render":return this.localRenderBounds;case"stroke":return this.localStrokeBounds;case"content":if(this.contentBounds)return this.localContentBounds;case"box":return this.leaf.__localBoxBounds}}getWorldBounds(t="box"){switch(t){case"render":return this.leaf.__world;case"stroke":return this.worldStrokeBounds;case"content":if(this.contentBounds)return this.worldContentBounds;case"box":return this.worldBoxBounds}}getLayoutBounds(t,e="world",s){const{leaf:n}=this;let r,o,a=this.getInnerBounds(t);switch(e){case"world":r=n.getWorldPoint(a),o=n.__world;break;case"local":r=n.getLocalPointByInner(a),o=n.__localMatrix;break;case"inner":r=a,o=P.defaultMatrix;break;case"page":e=n.zoomLayer;default:r=n.getWorldPoint(a,e),o=Po(n,e,!0)}const h=P.getLayout(o);if($u(h,a),E.copy(h,r),s){const{scaleX:l,scaleY:c}=h,p=Math.abs(l),_=Math.abs(c);(p!==1||_!==1)&&(h.scaleX/=p,h.scaleY/=_,h.width*=p,h.height*=_)}return h}getLayoutPoints(t,e="world"){const{leaf:s}=this,n=Wu(this.getInnerBounds(t));let r;switch(e){case"world":r=null;break;case"local":r=s.parent;break;case"inner":break;case"page":e=s.zoomLayer;default:r=e}return r!==void 0&&n.forEach(o=>s.innerToWorld(o,null,!1,r)),n}shrinkContent(){const{x:t,y:e,width:s,height:n}=this.boxBounds;this._contentBounds={x:t,y:e,width:s,height:n}}spreadStroke(){const{x:t,y:e,width:s,height:n}=this.strokeBounds;this._strokeBounds={x:t,y:e,width:s,height:n},this._localStrokeBounds={x:t,y:e,width:s,height:n},this.renderSpread||this.spreadRenderCancel()}spreadRender(){const{x:t,y:e,width:s,height:n}=this.renderBounds;this._renderBounds={x:t,y:e,width:s,height:n},this._localRenderBounds={x:t,y:e,width:s,height:n}}shrinkContentCancel(){this._contentBounds=void 0}spreadStrokeCancel(){const t=this.renderBounds===this.strokeBounds;this._strokeBounds=this.boxBounds,this._localStrokeBounds=this.leaf.__localBoxBounds,t&&this.spreadRenderCancel()}spreadRenderCancel(){this._renderBounds=this._strokeBounds,this._localRenderBounds=this._localStrokeBounds}boxChange(){this.boxChanged=!0,this.localBoxChanged||this.localBoxChange(),this.hitCanvasChanged=!0}localBoxChange(){this.localBoxChanged=!0,this.boundsChanged=!0}strokeChange(){this.strokeChanged=!0,this.strokeSpread||(this.strokeSpread=1),this.boundsChanged=!0,this.hitCanvasChanged=!0}renderChange(){this.renderChanged=!0,this.renderSpread||(this.renderSpread=1),this.boundsChanged=!0}scaleChange(){this.scaleChanged=!0,this._scaleOrRotationChange()}rotationChange(){this.rotationChanged=!0,this.affectRotation=!0,this._scaleOrRotationChange()}_scaleOrRotationChange(){this.affectScaleOrRotation=!0,this.matrixChange(),this.leaf.__local||this.createLocal()}matrixChange(){this.matrixChanged=!0,this.localBoxChanged||this.localBoxChange()}surfaceChange(){this.surfaceChanged=!0}opacityChange(){this.opacityChanged=!0,this.surfaceChanged||this.surfaceChange()}childrenSortChange(){this.childrenSortChanged||(this.childrenSortChanged=!0,this.leaf.forceUpdate("surface"))}destroy(){}}const Oo={},zu={on(i,t,e){let s,n;e&&(e==="once"?n=!0:typeof e=="boolean"?s=e:(s=e.capture,n=e.once));let r;const o=kn(this,s,!0),a=typeof i=="string"?i.split(" "):i,h=n?{listener:t,once:n}:{listener:t};a.forEach(l=>{l&&(r=o[l],r?r.findIndex(c=>c.listener===t)===-1&&r.push(h):o[l]=[h])})},off(i,t,e){if(i){const s=typeof i=="string"?i.split(" "):i;if(t){let n;e&&(n=typeof e=="boolean"?e:e==="once"?!1:e.capture);let r,o;const a=kn(this,n);s.forEach(h=>{h&&(r=a[h],r&&(o=r.findIndex(l=>l.listener===t),o>-1&&r.splice(o,1),r.length||delete a[h]))})}else{const{__bubbleMap:n,__captureMap:r}=this;s.forEach(o=>{n&&delete n[o],r&&delete r[o]})}}else this.__bubbleMap=this.__captureMap=void 0},on_(i,t,e,s){return e&&(t=t.bind(e)),this.on(i,t,s),{type:i,current:this,listener:t,options:s}},off_(i){if(!i)return;const t=i instanceof Array?i:[i];t.forEach(e=>e.current.off(e.type,e.listener,e.options)),t.length=0},once(i,t,e){this.on(i,t,{once:!0,capture:e})},emit(i,t,e){!t&&fi.has(i)&&(t=fi.get(i,{type:i,target:this,current:this}));const n=kn(this,e)[i];if(n){let r;for(let o=0,a=n.length;o<a&&(r=n[o],r.listener(t),r.once&&(this.off(i,r.listener,e),o--,a--),!(t&&t.isStopNow));o++);}this.syncEventer&&this.syncEventer.emitEvent(t,e)},emitEvent(i,t){i.current=this,this.emit(i.type,i,t)},hasEvent(i,t){if(this.syncEventer&&this.syncEventer.hasEvent(i,t))return!0;const{__bubbleMap:e,__captureMap:s}=this,n=e&&e[i],r=s&&s[i];return!!(t===void 0?n||r:t?r:n)}};function kn(i,t,e){if(t){const{__captureMap:s}=i;return s||(e?i.__captureMap={}:Oo)}else{const{__bubbleMap:s}=i;return s||(e?i.__bubbleMap={}:Oo)}}class ee{constructor(t,e){this.bubbles=!1,this.type=t,e&&(this.target=e)}stopDefault(){this.isStopDefault=!0,this.origin&&b.event.stopDefault(this.origin)}stopNow(){this.isStopNow=!0,this.isStop=!0,this.origin&&b.event.stopNow(this.origin)}stop(){this.isStop=!0,this.origin&&b.event.stop(this.origin)}}class kt extends ee{constructor(t,e,s){super(t,e),this.parent=s,this.child=e}}kt.ADD="child.add";kt.REMOVE="child.remove";kt.DESTROY="child.destroy";class de extends ee{constructor(t,e,s,n,r){super(t,e),this.attrName=s,this.oldValue=n,this.newValue=r}}de.CHANGE="property.change";de.LEAFER_CHANGE="property.leafer_change";class Oe extends ee{constructor(t,e){super(t),Object.assign(this,e)}}Oe.LOAD="image.load";Oe.LOADED="image.loaded";Oe.ERROR="image.error";class qe extends ee{get bigger(){if(!this.old)return!0;const{width:t,height:e}=this.old;return this.width>=t&&this.height>=e}get smaller(){return!this.bigger}get samePixelRatio(){return this.old?this.pixelRatio===this.old.pixelRatio:!0}constructor(t,e){typeof t=="object"?(super(qe.RESIZE),Object.assign(this,t)):super(t),this.old=e}}qe.RESIZE="resize";class Be extends ee{constructor(t,e){super(t),this.data=e}}Be.REQUEST="watch.request";Be.DATA="watch.data";class H extends ee{constructor(t,e,s){super(t),e&&(this.data=e,this.times=s)}}H.CHECK_UPDATE="layout.check_update";H.REQUEST="layout.request";H.START="layout.start";H.BEFORE="layout.before";H.LAYOUT="layout";H.AFTER="layout.after";H.AGAIN="layout.again";H.END="layout.end";class uh extends ee{}uh.FRAME="animate.frame";class G extends ee{constructor(t,e,s,n){super(t),e&&(this.times=e),s&&(this.renderBounds=s,this.renderOptions=n)}}G.REQUEST="render.request";G.START="render.start";G.BEFORE="render.before";G.RENDER="render";G.AFTER="render.after";G.AGAIN="render.again";G.END="render.end";G.NEXT="render.next";class tt extends ee{}tt.START="leafer.start";tt.BEFORE_READY="leafer.before_ready";tt.READY="leafer.ready";tt.AFTER_READY="leafer.after_ready";tt.VIEW_READY="leafer.view_ready";tt.VIEW_COMPLETED="leafer.view_completed";tt.STOP="leafer.stop";tt.RESTART="leafer.restart";tt.END="leafer.end";const{isFinite:Hu}=Number,Nu=F.get("setAttr"),ju={__setAttr(i,t,e){if(this.leafer&&this.leafer.created){const s=this.__.__getInput(i);if(e&&!Hu(t)&&t!==void 0&&(Nu.warn(this.innerName,i,t),t=void 0),typeof t=="object"||s!==t){this.__[i]=t,this.__proxyData&&this.setProxyAttr(i,t);const{CHANGE:n}=de,r=new de(n,this,i,s,t);return this.isLeafer?this.emitEvent(new de(de.LEAFER_CHANGE,this,i,s,t)):this.hasEvent(n)&&this.emitEvent(r),this.leafer.emitEvent(r),!0}else return!1}else return this.__[i]=t,this.__proxyData&&this.setProxyAttr(i,t),!0},__getAttr(i){return this.__proxyData?this.getProxyAttr(i):this.__.__get(i)}},{setLayout:Gu,multiplyParent:Uu,translateInner:Yu,defaultWorld:Vu}=P,{toPoint:Xu,tempPoint:Bn}=yi,Ku={__updateWorldMatrix(){Uu(this.__local||this.__layout,this.parent?this.parent.__world:Vu,this.__world,!!this.__layout.affectScaleOrRotation,this.__,this.parent&&this.parent.__)},__updateLocalMatrix(){if(this.__local){const i=this.__layout,t=this.__local,e=this.__;i.affectScaleOrRotation&&(i.scaleChanged||i.rotationChanged)&&(Gu(t,e,null,null,i.affectRotation),i.scaleChanged=i.rotationChanged=!1),t.e=e.x+e.offsetX,t.f=e.y+e.offsetY,(e.around||e.origin)&&(Xu(e.around||e.origin,i.boxBounds,Bn),Yu(t,-Bn.x,-Bn.y,!e.around))}this.__layout.matrixChanged=!1}},{updateMatrix:qu,updateAllMatrix:Lo}=te,{updateBounds:Mo}=Ki,{toOuterOf:ps,copyAndSpread:Ao,copy:Zu}=S,{toBounds:Qu}=br,Ju={__updateWorldBounds(){ps(this.__layout.renderBounds,this.__world,this.__world),this.__layout.resized&&(this.__onUpdateSize(),this.__layout.resized=!1)},__updateLocalBounds(){const i=this.__layout;i.boxChanged&&(this.__.__pathInputed||this.__updatePath(),this.__updateRenderPath(),this.__updateBoxBounds(),i.resized=!0),i.localBoxChanged&&(this.__local&&this.__updateLocalBoxBounds(),i.localBoxChanged=!1,i.strokeSpread&&(i.strokeChanged=!0),i.renderSpread&&(i.renderChanged=!0),this.parent&&this.parent.__layout.boxChange()),i.boxChanged=!1,i.strokeChanged&&(i.strokeSpread=this.__updateStrokeSpread(),i.strokeSpread?(i.strokeBounds===i.boxBounds&&i.spreadStroke(),this.__updateStrokeBounds(),this.__updateLocalStrokeBounds()):i.spreadStrokeCancel(),i.strokeChanged=!1,(i.renderSpread||i.strokeSpread!==i.strokeBoxSpread)&&(i.renderChanged=!0),this.parent&&this.parent.__layout.strokeChange(),i.resized=!0),i.renderChanged&&(i.renderSpread=this.__updateRenderSpread(),i.renderSpread?((i.renderBounds===i.boxBounds||i.renderBounds===i.strokeBounds)&&i.spreadRender(),this.__updateRenderBounds(),this.__updateLocalRenderBounds()):i.spreadRenderCancel(),i.renderChanged=!1,this.parent&&this.parent.__layout.renderChange()),i.boundsChanged=!1},__updateLocalBoxBounds(){this.__hasAutoLayout&&this.__updateAutoLayout(),ps(this.__layout.boxBounds,this.__local,this.__local)},__updateLocalStrokeBounds(){ps(this.__layout.strokeBounds,this.__localMatrix,this.__layout.localStrokeBounds)},__updateLocalRenderBounds(){ps(this.__layout.renderBounds,this.__localMatrix,this.__layout.localRenderBounds)},__updateBoxBounds(){const i=this.__layout.boxBounds,t=this.__;t.__pathInputed?Qu(t.__pathForRender,i):(i.x=0,i.y=0,i.width=t.width,i.height=t.height)},__updateAutoLayout(){this.__layout.matrixChanged=!0,this.isBranch?(this.leafer&&this.leafer.ready&&this.leafer.layouter.addExtra(this),this.__.flow?(this.__layout.boxChanged&&this.__updateFlowLayout(),Lo(this),Mo(this,this),this.__.__autoSide&&this.__updateBoxBounds()):(Lo(this),Mo(this,this))):qu(this)},__updateNaturalSize(){const{__:i,__layout:t}=this;i.__naturalWidth=t.boxBounds.width,i.__naturalHeight=t.boxBounds.height},__updateStrokeBounds(){const i=this.__layout;Ao(i.strokeBounds,i.boxBounds,i.strokeBoxSpread)},__updateRenderBounds(){const i=this.__layout;i.renderSpread>0?Ao(i.renderBounds,i.boxBounds,i.renderSpread):Zu(i.renderBounds,i.strokeBounds)}},td={__render(i,t){if(this.__worldOpacity)if(i.setWorld(this.__nowWorld=this.__getNowWorld(t)),i.opacity=this.__.opacity,this.__.__single){if(this.__.eraser==="path")return this.__renderEraser(i,t);const e=i.getSameCanvas(!0,!0);this.__draw(e,t),this.__worldFlipped?i.copyWorldByReset(e,this.__nowWorld,null,this.__.__blendMode,!0):i.copyWorldToInner(e,this.__nowWorld,this.__layout.renderBounds,this.__.__blendMode),e.recycle(this.__nowWorld)}else this.__draw(i,t)},__clip(i,t){this.__worldOpacity&&(i.setWorld(this.__nowWorld=this.__getNowWorld(t)),this.__drawRenderPath(i),this.__.windingRule?i.clip(this.__.windingRule):i.clip())},__updateWorldOpacity(){this.__worldOpacity=this.__.visible?this.parent?this.parent.__worldOpacity*this.__.opacity:this.__.opacity:0,this.__layout.opacityChanged&&(this.__layout.opacityChanged=!1)}},{excludeRenderBounds:Do}=zs,ed={__updateChange(){const{__layout:i}=this;i.childrenSortChanged&&(this.__updateSortChildren(),i.childrenSortChanged=!1),this.__.__checkSingle()},__render(i,t){if(this.__worldOpacity)if(this.__.__single){if(this.__.eraser==="path")return this.__renderEraser(i,t);const e=i.getSameCanvas(!1,!0);this.__renderBranch(e,t);const s=this.__getNowWorld(t);i.opacity=this.__.opacity,i.copyWorldByReset(e,s,s,this.__.__blendMode,!0),e.recycle(s)}else this.__renderBranch(i,t)},__renderBranch(i,t){if(this.__hasMask)this.__renderMask(i,t);else{const{children:e}=this;for(let s=0,n=e.length;s<n;s++)Do(e[s],t)||e[s].__render(i,t)}},__clip(i,t){if(this.__worldOpacity){const{children:e}=this;for(let s=0,n=e.length;s<n;s++)Do(e[s],t)||e[s].__clip(i,t)}}},{LEAF:id,create:sd}=_e,{toInnerPoint:nd,toOuterPoint:rd,multiplyParent:od}=P,{toOuterOf:Io}=S,{copy:Wo}=E,{moveLocal:ad,zoomOfLocal:hd,rotateOfLocal:ld,skewOfLocal:cd,moveWorld:ud,zoomOfWorld:dd,rotateOfWorld:fd,skewOfWorld:_d,transform:$o,transformWorld:pd,setTransform:gd,getFlipTransform:yd,getLocalOrigin:Sn,getRelativeWorld:md,drop:wd}=te;let Ue=class{get tag(){return this.__tag}set tag(t){}get __tag(){return"Leaf"}get innerName(){return this.__.name||this.tag+this.innerId}get __DataProcessor(){return Ka}get __LayoutProcessor(){return Fu}get isLeafer(){return!1}get isBranch(){return!1}get isBranchLeaf(){return!1}get __localMatrix(){return this.__local||this.__layout}get __localBoxBounds(){return this.__local||this.__layout}get worldTransform(){return this.__layout.getTransform("world")}get localTransform(){return this.__layout.getTransform("local")}get boxBounds(){return this.getBounds("box","inner")}get renderBounds(){return this.getBounds("render","inner")}get worldBoxBounds(){return this.getBounds("box")}get worldStrokeBounds(){return this.getBounds("stroke")}get worldRenderBounds(){return this.getBounds("render")}get worldOpacity(){return this.__layout.update(),this.__worldOpacity}get __worldFlipped(){return this.__world.scaleX<0||this.__world.scaleY<0}get __onlyHitMask(){return this.__hasMask&&!this.__.hitChildren}get __ignoreHitWorld(){return(this.__hasMask||this.__hasEraser)&&this.__.hitChildren}get __inLazyBounds(){const{leafer:t}=this;return t&&t.created&&t.lazyBounds.hit(this.__world)}get pathInputed(){return this.__.__pathInputed}set event(t){let e;for(let s in t)e=t[s],e instanceof Array?this.on(s,e[0],e[1]):this.on(s,e)}constructor(t){this.innerId=sd(id),this.reset(t)}reset(t){this.__world={a:1,b:0,c:0,d:1,e:0,f:0,x:0,y:0,width:0,height:0,scaleX:1,scaleY:1},t!==null&&(this.__local={a:1,b:0,c:0,d:1,e:0,f:0,x:0,y:0,width:0,height:0}),this.__worldOpacity=1,this.__=new this.__DataProcessor(this),this.__layout=new this.__LayoutProcessor(this),this.__level&&this.resetCustom(),t&&(t.__&&(t=t.toJSON()),t.children?this.set(t):Object.assign(this,t))}resetCustom(){this.__hasMask=this.__hasEraser=null,this.forceUpdate()}waitParent(t,e){e&&(t=t.bind(e)),this.parent?t():this.__parentWait?this.__parentWait.push(t):this.__parentWait=[t]}waitLeafer(t,e){e&&(t=t.bind(e)),this.leafer?t():this.__leaferWait?this.__leaferWait.push(t):this.__leaferWait=[t]}nextRender(t,e,s){this.leafer?this.leafer.nextRender(t,e,s):this.waitLeafer(()=>this.leafer.nextRender(t,e,s))}removeNextRender(t){this.nextRender(t,null,"off")}__bindLeafer(t){if(this.isLeafer&&t!==null&&(t=this),this.leafer&&!t&&this.leafer.leafs--,this.leafer=t,t&&(t.leafs++,this.__level=this.parent?this.parent.__level+1:1,this.__leaferWait&&He.run(this.__leaferWait)),this.isBranch){const{children:e}=this;for(let s=0,n=e.length;s<n;s++)e[s].__bindLeafer(t)}}set(t){}get(t){}setAttr(t,e){this[t]=e}getAttr(t){return this[t]}getComputedAttr(t){return this.__[t]}toJSON(t){return t&&this.__layout.update(),this.__.__getInputData(null,t)}toString(t){return JSON.stringify(this.toJSON(t))}toSVG(){}__SVG(t){}toHTML(){}__setAttr(t,e){return!0}__getAttr(t){}setProxyAttr(t,e){}getProxyAttr(t){}find(t,e){}findTag(t){}findOne(t,e){}findId(t){}focus(t){}updateLayout(){this.__layout.update()}forceUpdate(t){t===void 0?t="width":t==="surface"&&(t="blendMode");const e=this.__.__getInput(t);this.__[t]=e===void 0?null:void 0,this[t]=e}forceRender(t){this.forceUpdate("surface")}__updateWorldMatrix(){}__updateLocalMatrix(){}__updateWorldBounds(){}__updateLocalBounds(){}__updateLocalBoxBounds(){}__updateLocalStrokeBounds(){}__updateLocalRenderBounds(){}__updateBoxBounds(){}__updateContentBounds(){}__updateStrokeBounds(){}__updateRenderBounds(){}__updateAutoLayout(){}__updateFlowLayout(){}__updateNaturalSize(){}__updateStrokeSpread(){return 0}__updateRenderSpread(){return 0}__onUpdateSize(){}__updateEraser(t){this.__hasEraser=t?!0:this.children.some(e=>e.__.eraser)}__renderEraser(t,e){t.save(),this.__clip(t,e);const{renderBounds:s}=this.__layout;t.clearRect(s.x,s.y,s.width,s.height),t.restore()}__updateMask(t){this.__hasMask=t?!0:this.children.some(e=>e.__.mask)}__renderMask(t,e){}__getNowWorld(t){if(t.matrix){this.__cameraWorld||(this.__cameraWorld={});const e=this.__cameraWorld;return od(this.__world,t.matrix,e,void 0,this.__world),Io(this.__layout.renderBounds,e,e),e}else return this.__world}getTransform(t){return this.__layout.getTransform(t||"local")}getBounds(t,e){return this.__layout.getBounds(t,e)}getLayoutBounds(t,e,s){return this.__layout.getLayoutBounds(t,e,s)}getLayoutPoints(t,e){return this.__layout.getLayoutPoints(t,e)}getWorldBounds(t,e,s){const n=e?md(this,e):this.worldTransform,r=s?t:{};return Io(t,n,r),r}worldToLocal(t,e,s,n){this.parent?this.parent.worldToInner(t,e,s,n):e&&Wo(e,t)}localToWorld(t,e,s,n){this.parent?this.parent.innerToWorld(t,e,s,n):e&&Wo(e,t)}worldToInner(t,e,s,n){n&&(n.innerToWorld(t,e,s),t=e||t),nd(this.worldTransform,t,e,s)}innerToWorld(t,e,s,n){rd(this.worldTransform,t,e,s),n&&n.worldToInner(e||t,null,s)}getInnerPoint(t,e,s,n){const r=n?t:{};return this.worldToInner(t,r,s,e),r}getInnerPointByLocal(t,e,s,n){return this.getInnerPoint(t,this.parent,s,n)}getLocalPoint(t,e,s,n){const r=n?t:{};return this.worldToLocal(t,r,s,e),r}getLocalPointByInner(t,e,s,n){return this.getWorldPoint(t,this.parent,s,n)}getWorldPoint(t,e,s,n){const r=n?t:{};return this.innerToWorld(t,r,s,e),r}getWorldPointByLocal(t,e,s,n){const r=n?t:{};return this.localToWorld(t,r,s,e),r}getPagePoint(t,e,s,n){return(this.leafer?this.leafer.zoomLayer:this).getInnerPoint(t,e,s,n)}getWorldPointByPage(t,e,s,n){return(this.leafer?this.leafer.zoomLayer:this).getWorldPoint(t,e,s,n)}setTransform(t,e){gd(this,t,e)}transform(t,e){$o(this,t,e)}move(t,e){ad(this,t,e)}scaleOf(t,e,s,n){hd(this,Sn(this,t),e,s,n)}rotateOf(t,e){ld(this,Sn(this,t),e)}skewOf(t,e,s,n){cd(this,Sn(this,t),e,s,n)}transformWorld(t,e){pd(this,t,e)}moveWorld(t,e){ud(this,t,e)}scaleOfWorld(t,e,s,n){dd(this,t,e,s,n)}rotateOfWorld(t,e){fd(this,t,e)}skewOfWorld(t,e,s,n){_d(this,t,e,s,n)}flip(t){$o(this,yd(this,t))}scaleResize(t,e=t,s){this.scaleX*=t,this.scaleY*=e}__scaleResize(t,e){}resizeWidth(t){}resizeHeight(t){}__hitWorld(t){return!0}__hit(t){return!0}__hitFill(t){return!0}__hitStroke(t,e){return!0}__hitPixel(t){return!0}__drawHitPath(t){}__updateHitCanvas(){}__render(t,e){}__drawFast(t,e){}__draw(t,e){}__clip(t,e){}__renderShape(t,e,s,n){}__updateWorldOpacity(){}__updateChange(){}__drawPath(t){}__drawRenderPath(t){}__updatePath(){}__updateRenderPath(){}__updateSortChildren(){}add(t,e){}remove(t,e){this.parent&&this.parent.remove(this,e)}dropTo(t,e,s){wd(this,t,e,s)}on(t,e,s){}off(t,e,s){}on_(t,e,s,n){}off_(t){}once(t,e,s){}emit(t,e,s){}emitEvent(t,e){}hasEvent(t,e){return!1}static changeAttr(t,e,s){s?this.addAttr(t,e,s):lh(this.prototype,t,e)}static addAttr(t,e,s){s||(s=L),s(e)(this.prototype,t)}destroy(){if(!this.destroyed){const{parent:t}=this;t&&this.remove(),this.children&&this.removeAll(!0),this.hasEvent(kt.DESTROY)&&this.emitEvent(new kt(kt.DESTROY,this,t)),this.__.destroy(),this.__layout.destroy(),this.__captureMap=this.__bubbleMap=this.__parentWait=this.__leaferWait=null,this.destroyed=!0}}};Ue=k([$t(ju),$t(Ku),$t(Ju),$t(zu),$t(td)],Ue);const{setListWithFn:Cn}=S,{sort:xd}=Ki,{localBoxBounds:vd,localStrokeBounds:bd,localRenderBounds:Rd,maskLocalBoxBounds:kd,maskLocalStrokeBounds:Bd,maskLocalRenderBounds:Sd}=zs;let nr=class extends Ue{__updateStrokeSpread(){const{children:t}=this;for(let e=0,s=t.length;e<s;e++)if(t[e].__layout.strokeSpread)return 1;return 0}__updateRenderSpread(){const{children:t}=this;for(let e=0,s=t.length;e<s;e++)if(t[e].__layout.renderSpread)return 1;return 0}__updateBoxBounds(){Cn(this.__layout.boxBounds,this.children,this.__hasMask?kd:vd)}__updateStrokeBounds(){Cn(this.__layout.strokeBounds,this.children,this.__hasMask?Bd:bd)}__updateRenderBounds(){Cn(this.__layout.renderBounds,this.children,this.__hasMask?Sd:Rd)}__updateSortChildren(){let t;const{children:e}=this;if(e.length>1){for(let s=0,n=e.length;s<n;s++)e[s].__tempNumber=s,e[s].__.zIndex&&(t=!0);e.sort(xd),this.__layout.affectChildrenSort=t}}add(t,e){t!==this&&(t.parent&&t.parent.remove(t),t.parent=this,e===void 0?this.children.push(t):this.children.splice(e,0,t),t.isBranch&&(this.__.__childBranchNumber=(this.__.__childBranchNumber||0)+1),t.__layout.boxChanged||t.__layout.boxChange(),t.__layout.matrixChanged||t.__layout.matrixChange(),t.__parentWait&&He.run(t.__parentWait),this.leafer&&(t.__bindLeafer(this.leafer),this.leafer.created&&this.__emitChildEvent(kt.ADD,t)),this.__layout.affectChildrenSort&&this.__layout.childrenSortChange())}addMany(...t){t.forEach(e=>this.add(e))}remove(t,e){if(t){const s=this.children.indexOf(t);s>-1&&(this.children.splice(s,1),t.isBranch&&(this.__.__childBranchNumber=(this.__.__childBranchNumber||1)-1),this.__preRemove(),this.__realRemoveChild(t),e&&t.destroy())}else t===void 0&&super.remove(null,e)}removeAll(t){const{children:e}=this;e.length&&(this.children=[],this.__preRemove(),this.__.__childBranchNumber=0,e.forEach(s=>{this.__realRemoveChild(s),t&&s.destroy()}))}clear(){this.removeAll(!0)}__preRemove(){this.__hasMask&&this.__updateMask(),this.__hasEraser&&this.__updateEraser(),this.__layout.boxChange(),this.__layout.affectChildrenSort&&this.__layout.childrenSortChange()}__realRemoveChild(t){t.parent=null,this.leafer&&(t.__bindLeafer(null),this.leafer.created&&(this.__emitChildEvent(kt.REMOVE,t),this.leafer.hitCanvasManager&&this.leafer.hitCanvasManager.clear()))}__emitChildEvent(t,e){const s=new kt(t,e,this);e.hasEvent(t)&&e.emitEvent(s),this.hasEvent(t)&&!this.isLeafer&&this.emitEvent(s),this.leafer.emitEvent(s)}};nr=k([$t(ed)],nr);class it{get length(){return this.list.length}constructor(t){this.reset(),t&&(t instanceof Array?this.addList(t):this.add(t))}has(t){return t&&this.keys[t.innerId]!==void 0}indexAt(t){return this.list[t]}indexOf(t){const e=this.keys[t.innerId];return e===void 0?-1:e}add(t){const{list:e,keys:s}=this;s[t.innerId]===void 0&&(e.push(t),s[t.innerId]=e.length-1)}addAt(t,e=0){const{keys:s}=this;if(s[t.innerId]===void 0){const{list:n}=this;for(let r=e,o=n.length;r<o;r++)s[n[r].innerId]++;e===0?n.unshift(t):(e>n.length&&(e=n.length),n.splice(e,0,t)),s[t.innerId]=e}}addList(t){for(let e=0;e<t.length;e++)this.add(t[e])}remove(t){const{list:e}=this;let s;for(let n=0,r=e.length;n<r;n++)s!==void 0?this.keys[e[n].innerId]=n-1:e[n].innerId===t.innerId&&(s=n,delete this.keys[t.innerId]);s!==void 0&&e.splice(s,1)}sort(t){const{list:e}=this;t?e.sort((s,n)=>n.__level-s.__level):e.sort((s,n)=>s.__level-n.__level)}forEach(t){this.list.forEach(t)}clone(){const t=new it;return t.list=[...this.list],t.keys=Object.assign({},this.keys),t}update(){this.keys={};const{list:t,keys:e}=this;for(let s=0,n=t.length;s<n;s++)e[t[s].innerId]=s}reset(){this.list=[],this.keys={}}destroy(){this.reset()}}class Cd{get length(){return this._length}constructor(t){this._length=0,this.reset(),t&&(t instanceof Array?this.addList(t):this.add(t))}has(t){return this.keys[t.innerId]!==void 0}without(t){return this.keys[t.innerId]===void 0}sort(t){const{levels:e}=this;t?e.sort((s,n)=>n-s):e.sort((s,n)=>s-n)}addList(t){t.forEach(e=>{this.add(e)})}add(t){const{keys:e,levelMap:s}=this;e[t.innerId]||(e[t.innerId]=1,s[t.__level]?s[t.__level].push(t):(s[t.__level]=[t],this.levels.push(t.__level)),this._length++)}forEach(t){let e;this.levels.forEach(s=>{e=this.levelMap[s];for(let n=0,r=e.length;n<r;n++)t(e[n])})}reset(){this.levelMap={},this.keys={},this.levels=[],this._length=0}destroy(){this.levelMap=null}}function d(i,t,e,s){var n=arguments.length,r=n<3?t:s===null?s=Object.getOwnPropertyDescriptor(t,e):s,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(i,t,e,s);else for(var a=i.length-1;a>=0;a--)(o=i[a])&&(r=(n<3?o(r):n>3?o(t,e,r):o(t,e))||r);return n>3&&r&&Object.defineProperty(t,e,r),r}const dh={},Fi={},fh={},rt={},Ye={},Ss={},rr={},li={},ut={};function _h(i){return Q(i,t=>({set(e){this.__setAttr(t,e),this.waitLeafer(()=>{ut.setStyle&&ut.setStyle(this,t+"Style",e)})}}))}function ph(i){return Q(i,t=>({set(e){if(this.__setAttr(t,e)){const s=this.__;s.__useArrow=s.startArrow!=="none"||s.endArrow!=="none",ah(this)}}}))}function qi(i){return Q(i,t=>({set(e){this.__setAttr(t,e),e&&(this.__.__useEffect=!0),this.__layout.renderChanged||this.__layout.renderChange()}}))}function Zi(i){return Q(i,t=>({set(e){this.__setAttr(t,e),this.__layout.boxChanged||this.__layout.boxChange(),this.__updateSize()}}))}function Ed(){return(i,t)=>{const e="_"+t;mi(i,t,{set(s){this.isLeafer&&(this[e]=s)},get(){return this.isApp?this.tree.zoomLayer:this.isLeafer?this[e]||this:this.leafer&&this.leafer.zoomLayer}})}}const{parse:Td}=Ge,Fo={},zo=F.get("UIData");class ge extends Ka{get __strokeWidth(){const{strokeWidth:t,strokeWidthFixed:e}=this;if(e){const s=this.__leaf;let{scaleX:n}=s.__nowWorld||s.__world;return n<0&&(n=-n),n>1?t/n:t}else return t}get __autoWidth(){return!this._width}get __autoHeight(){return!this._height}get __autoSide(){return!this._width||!this._height}get __autoSize(){return!this._width&&!this._height}setVisible(t){this.__leaf.leafer&&(this.__leaf.leafer.watcher.hasVisible=!0),this._visible=t}setWidth(t){t<0?(this._width=-t,this.__leaf.scaleX*=-1,zo.warn("width < 0, instead -scaleX ",this)):this._width=t}setHeight(t){t<0?(this._height=-t,this.__leaf.scaleY*=-1,zo.warn("height < 0, instead -scaleY",this)):this._height=t}setFill(t){this.__naturalWidth&&this.__removeNaturalSize(),typeof t=="string"||!t?(this.__isFills&&(this.__removeInput("fill"),Ye.recycleImage("fill",this),this.__isFills=!1,this.__pixelFill&&(this.__pixelFill=!1)),this._fill=t):typeof t=="object"&&(this.__setInput("fill",t),this.__leaf.__layout.boxChanged||this.__leaf.__layout.boxChange(),this.__isFills=!0,this._fill||(this._fill=Fo))}setStroke(t){typeof t=="string"||!t?(this.__isStrokes&&(this.__removeInput("stroke"),Ye.recycleImage("stroke",this),this.__isStrokes=!1,this.__pixelStroke&&(this.__pixelStroke=!1)),this._stroke=t):typeof t=="object"&&(this.__setInput("stroke",t),this.__leaf.__layout.boxChanged||this.__leaf.__layout.boxChange(),this.__isStrokes=!0,this._stroke||(this._stroke=Fo))}setPath(t){typeof t=="string"?(this.__setInput("path",t),this._path=Td(t)):(this.__input&&this.__removeInput("path"),this._path=t)}setShadow(t){this.__setInput("shadow",t),t instanceof Array?(t.some(e=>e.visible===!1)&&(t=t.filter(e=>e.visible!==!1)),this._shadow=t.length?t:null):t?this._shadow=t.visible===!1?null:[t]:this._shadow=null}setInnerShadow(t){this.__setInput("innerShadow",t),t instanceof Array?(t.some(e=>e.visible===!1)&&(t=t.filter(e=>e.visible!==!1)),this._innerShadow=t.length?t:null):t?this._innerShadow=t.visible===!1?null:[t]:this._innerShadow=null}__computePaint(){const{fill:t,stroke:e}=this.__input;t&&rt.compute("fill",this.__leaf),e&&rt.compute("stroke",this.__leaf),this.__needComputePaint=!1}}const Ho={number(i,t){return typeof i=="object"?i.type==="percent"?i.value*t:i.value:i}};class Hs extends ge{}class kr extends Hs{get __boxStroke(){return!this.__pathInputed}}class Pd extends Hs{}class Od extends kr{}class Ld extends ge{}class Br extends ge{get __boxStroke(){return!this.__pathInputed}}class Md extends ge{get __boxStroke(){return!this.__pathInputed}}class Ad extends ge{}class Dd extends ge{}class Id extends ge{}class Wd extends Hs{}const $d={thin:100,"extra-light":200,light:300,normal:400,medium:500,"semi-bold":600,bold:700,"extra-bold":800,black:900};class Fd extends ge{get __useNaturalRatio(){return!1}setFontWeight(t){typeof t=="string"?(this.__setInput("fontWeight",t),this._fontWeight=$d[t]||400):(this.__input&&this.__removeInput("fontWeight"),this._fontWeight=t)}}class zd extends Br{setUrl(t){this.__setImageFill(t),this._url=t}__setImageFill(t){this.__leaf.image&&(this.__leaf.image=null),this.fill=t?{type:"image",mode:"strench",url:t}:void 0}__getData(){const t=super.__getData();return delete t.fill,t}__getInputData(){const t=super.__getInputData();return delete t.fill,t}}class Hd extends Br{}const Nd={__updateStrokeSpread(){let i=0,t=0;const e=this.__,{strokeAlign:s,strokeWidth:n}=e;if((e.stroke||e.hitStroke==="all")&&n&&s!=="inside"&&(t=i=s==="center"?n/2:n,!e.__boxStroke)){const r=e.__isLinePath?0:10*i,o=e.strokeCap==="none"?0:n;i+=Math.max(r,o)}return e.__useArrow&&(i+=n*5),this.__layout.strokeBoxSpread=t,i},__updateRenderSpread(){let i=0;const{shadow:t,innerShadow:e,blur:s,backgroundBlur:n}=this.__;t&&t.forEach(o=>{i=Math.max(i,Math.max(Math.abs(o.y),Math.abs(o.x))+(o.spread>0?o.spread:0)+o.blur*1.5)}),s&&(i=Math.max(i,s));let r=i=Math.ceil(i);return e&&e.forEach(o=>{r=Math.max(r,Math.max(Math.abs(o.y),Math.abs(o.x))+(o.spread<0?-o.spread:0)+o.blur*1.5)}),n&&(r=Math.max(r,n)),this.__layout.renderShapeSpread=r,i+(this.__layout.strokeSpread||0)}},jd={__updateChange(){const i=this.__;if(i.__useEffect){const{shadow:e,innerShadow:s,blur:n,backgroundBlur:r}=this.__;i.__useEffect=!!(e||s||n||r)}i.__checkSingle(),i.__isFills||i.__isStrokes||i.cornerRadius||i.__useEffect?i.__complex=!0:i.__complex&&(i.__complex=!1)},__drawFast(i,t){No(this,i,t)},__draw(i,t){const e=this.__;if(e.__complex){e.__needComputePaint&&e.__computePaint();const{fill:s,stroke:n,__drawAfterFill:r}=e;if(this.__drawRenderPath(i),e.__useEffect){const o=rt.shape(this,i,t);this.__nowWorld=this.__getNowWorld(t);const{shadow:a,innerShadow:h}=e;a&&rr.shadow(this,i,o),s&&(e.__isFills?rt.fills(s,this,i):rt.fill(s,this,i)),r&&this.__drawAfterFill(i,t),h&&rr.innerShadow(this,i,o),n&&(e.__isStrokes?rt.strokes(n,this,i):rt.stroke(n,this,i)),o.worldCanvas&&o.worldCanvas.recycle(),o.canvas.recycle()}else s&&(e.__isFills?rt.fills(s,this,i):rt.fill(s,this,i)),r&&this.__drawAfterFill(i,t),n&&(e.__isStrokes?rt.strokes(n,this,i):rt.stroke(n,this,i))}else e.__pathInputed?No(this,i,t):this.__drawFast(i,t)},__renderShape(i,t,e,s){if(this.__worldOpacity){i.setWorld(this.__nowWorld=this.__getNowWorld(t));const{fill:n,stroke:r}=this.__;this.__drawRenderPath(i),n&&!e&&(this.__.__pixelFill?rt.fills(n,this,i):rt.fill("#000000",this,i)),this.__.__isCanvas&&this.__drawAfterFill(i,t),r&&!s&&(this.__.__pixelStroke?rt.strokes(r,this,i):rt.stroke("#000000",this,i))}}};function No(i,t,e){const{fill:s,stroke:n,__drawAfterFill:r}=i.__;i.__drawRenderPath(t),s&&rt.fill(s,i,t),r&&i.__drawAfterFill(t,e),n&&rt.stroke(n,i,t)}const Gd={__drawFast(i,t){let{width:e,height:s,fill:n,stroke:r,__drawAfterFill:o}=this.__;if(n&&(i.fillStyle=n,i.fillRect(0,0,e,s)),o&&this.__drawAfterFill(i,t),r){const{strokeAlign:a,__strokeWidth:h}=this.__;if(!h)return;i.setStroke(r,h,this.__);const l=h/2;switch(a){case"center":i.strokeRect(0,0,e,s);break;case"inside":e-=h,s-=h,e<0||s<0?(i.save(),this.__clip(i,t),i.strokeRect(l,l,e,s),i.restore()):i.strokeRect(l,l,e,s);break;case"outside":i.strokeRect(-l,-l,e+h,s+h);break}}}};var or;let y=or=class extends Ue{get app(){return this.leafer&&this.leafer.app}get isFrame(){return!1}set scale(t){typeof t=="number"?this.scaleX=this.scaleY=t:(this.scaleX=t.x,this.scaleY=t.y)}get scale(){const{scaleX:t,scaleY:e}=this;return t!==e?{x:t,y:e}:t}get pen(){const{path:t}=this.__;return Ci.set(this.path=t||[]),t||this.__drawPathByBox(Ci),Ci}get editConfig(){}get editOuter(){return this.__.__isLinePath?"LineEditTool":"EditTool"}get editInner(){return"PathEditor"}constructor(t){super(t)}reset(t){}set(t){Object.assign(this,t)}get(t){return typeof t=="string"?this.__.__getInput(t):this.__.__getInputData(t)}createProxyData(){}find(t,e){}findTag(t){return this.find({tag:t})}findOne(t,e){}findId(t){return this.findOne({id:t})}getPath(t,e){this.__layout.update();let s=e?this.__.__pathForRender:this.__.path;return s||(Ci.set(s=[]),this.__drawPathByBox(Ci)),t?Ge.toCanvasData(s,!0):s}getPathString(t,e){return Ge.stringify(this.getPath(t,e))}load(){this.__.__computePaint()}__onUpdateSize(){if(this.__.__input){const t=this.__;t.lazy&&!this.__inLazyBounds&&!li.running?t.__needComputePaint=!0:t.__computePaint()}}__updateRenderPath(){if(this.__.path){const t=this.__;t.__pathForRender=t.cornerRadius?au.smooth(t.path,t.cornerRadius,t.cornerSmoothing):t.path,t.__useArrow&&fh.addArrows(this,!t.cornerRadius)}}__drawRenderPath(t){t.beginPath(),this.__drawPathByData(t,this.__.__pathForRender)}__drawPath(t){t.beginPath(),this.__drawPathByData(t,this.__.path)}__drawPathByData(t,e){e?Hc.drawPathByData(t,e):this.__drawPathByBox(t)}__drawPathByBox(t){const{x:e,y:s,width:n,height:r}=this.__layout.boxBounds;if(this.__.cornerRadius){const{cornerRadius:o}=this.__;t.roundRect(e,s,n,r,typeof o=="number"?[o]:o)}else t.rect(e,s,n,r)}export(t,e){return li.export(this,t,e)}clone(){return or.one(this.toJSON())}static one(t,e,s,n,r){return Is.get(t.tag||this.prototype.__tag,t,e,s,n,r)}static registerUI(){ct()(this)}static registerData(t){lt(t)(this.prototype)}static setEditConfig(t){}static setEditOuter(t){}static setEditInner(t){}destroy(){this.fill=this.stroke=null,super.destroy()}};d([lt(ge)],y.prototype,"__",void 0);d([Ed()],y.prototype,"zoomLayer",void 0);d([dt("")],y.prototype,"id",void 0);d([dt("")],y.prototype,"name",void 0);d([dt("")],y.prototype,"className",void 0);d([Xi("pass-through")],y.prototype,"blendMode",void 0);d([wu(1)],y.prototype,"opacity",void 0);d([xu(!0)],y.prototype,"visible",void 0);d([_h(!1)],y.prototype,"selected",void 0);d([_h(!1)],y.prototype,"disabled",void 0);d([Xi(!1)],y.prototype,"locked",void 0);d([vu(0)],y.prototype,"zIndex",void 0);d([bu(!1)],y.prototype,"mask",void 0);d([Ru(!1)],y.prototype,"eraser",void 0);d([wi(0,!0)],y.prototype,"x",void 0);d([wi(0,!0)],y.prototype,"y",void 0);d([L(100,!0)],y.prototype,"width",void 0);d([L(100,!0)],y.prototype,"height",void 0);d([oh(1,!0)],y.prototype,"scaleX",void 0);d([oh(1,!0)],y.prototype,"scaleY",void 0);d([Rr(0,!0)],y.prototype,"rotation",void 0);d([Rr(0,!0)],y.prototype,"skewX",void 0);d([Rr(0,!0)],y.prototype,"skewY",void 0);d([wi(0,!0)],y.prototype,"offsetX",void 0);d([wi(0,!0)],y.prototype,"offsetY",void 0);d([wi(0,!0)],y.prototype,"scrollX",void 0);d([wi(0,!0)],y.prototype,"scrollY",void 0);d([Ws()],y.prototype,"origin",void 0);d([Ws()],y.prototype,"around",void 0);d([dt(!1)],y.prototype,"lazy",void 0);d([yu(1)],y.prototype,"pixelRatio",void 0);d([mu()],y.prototype,"path",void 0);d([gt()],y.prototype,"windingRule",void 0);d([gt(!0)],y.prototype,"closed",void 0);d([Ws(!1)],y.prototype,"flow",void 0);d([L(0)],y.prototype,"padding",void 0);d([L(0)],y.prototype,"gap",void 0);d([L("top-left")],y.prototype,"flowAlign",void 0);d([L(!1)],y.prototype,"flowWrap",void 0);d([L("box")],y.prototype,"itemBox",void 0);d([L(!0)],y.prototype,"inFlow",void 0);d([L()],y.prototype,"autoWidth",void 0);d([L()],y.prototype,"autoHeight",void 0);d([L()],y.prototype,"lockRatio",void 0);d([L()],y.prototype,"autoBox",void 0);d([L()],y.prototype,"widthRange",void 0);d([L()],y.prototype,"heightRange",void 0);d([dt(!1)],y.prototype,"draggable",void 0);d([dt()],y.prototype,"dragBounds",void 0);d([dt(!1)],y.prototype,"editable",void 0);d([Ke(!0)],y.prototype,"hittable",void 0);d([Ke("path")],y.prototype,"hitFill",void 0);d([Jt("path")],y.prototype,"hitStroke",void 0);d([Ke(!1)],y.prototype,"hitBox",void 0);d([Ke(!0)],y.prototype,"hitChildren",void 0);d([Ke(!0)],y.prototype,"hitSelf",void 0);d([Ke()],y.prototype,"hitRadius",void 0);d([ku("")],y.prototype,"cursor",void 0);d([Xi()],y.prototype,"fill",void 0);d([Jt()],y.prototype,"stroke",void 0);d([Jt("inside")],y.prototype,"strokeAlign",void 0);d([Jt(1)],y.prototype,"strokeWidth",void 0);d([Jt(!1)],y.prototype,"strokeWidthFixed",void 0);d([Jt("none")],y.prototype,"strokeCap",void 0);d([Jt("miter")],y.prototype,"strokeJoin",void 0);d([Jt()],y.prototype,"dashPattern",void 0);d([Jt()],y.prototype,"dashOffset",void 0);d([Jt(10)],y.prototype,"miterLimit",void 0);d([ph("none")],y.prototype,"startArrow",void 0);d([ph("none")],y.prototype,"endArrow",void 0);d([gt(0)],y.prototype,"cornerRadius",void 0);d([gt()],y.prototype,"cornerSmoothing",void 0);d([qi()],y.prototype,"shadow",void 0);d([qi()],y.prototype,"innerShadow",void 0);d([qi()],y.prototype,"blur",void 0);d([qi()],y.prototype,"backgroundBlur",void 0);d([qi()],y.prototype,"grayscale",void 0);d([dt()],y.prototype,"normalStyle",void 0);d([dt()],y.prototype,"hoverStyle",void 0);d([dt()],y.prototype,"pressStyle",void 0);d([dt()],y.prototype,"focusStyle",void 0);d([dt()],y.prototype,"selectedStyle",void 0);d([dt()],y.prototype,"disabledStyle",void 0);d([dt({})],y.prototype,"data",void 0);d([jt(Ue.prototype.reset)],y.prototype,"reset",null);y=or=d([$t(Nd),$t(jd),Fs()],y);let Zt=class extends y{get __tag(){return"Group"}get isBranch(){return!0}constructor(t){super(t)}reset(t){this.__setBranch(),super.reset(t)}__setBranch(){this.children||(this.children=[])}set(t){if(t.children){const{children:e}=t;delete t.children,this.children?this.clear():this.__setBranch(),super.set(t);let s;e.forEach(n=>{s=n.__?n:Is.get(n.tag,n),this.add(s)}),t.children=e}else super.set(t)}toJSON(t){const e=super.toJSON(t);return e.children=this.children.map(s=>s.toJSON(t)),e}pick(t,e){}addAt(t,e){this.add(t,e)}addAfter(t,e){this.add(t,this.children.indexOf(e)+1)}addBefore(t,e){this.add(t,this.children.indexOf(e))}add(t,e){}addMany(...t){}remove(t,e){}removeAll(t){}clear(){}};d([lt(Hs)],Zt.prototype,"__",void 0);Zt=d([$t(nr),ct()],Zt);var Cs;const gs=F.get("Leafer");let Ee=Cs=class extends Zt{get __tag(){return"Leafer"}get isApp(){return!1}get app(){return this.parent||this}get isLeafer(){return!0}get imageReady(){return this.viewReady&&xt.isComplete}get layoutLocked(){return!this.layouter.running}get FPS(){return this.renderer?this.renderer.FPS:60}get cursorPoint(){return this.interaction&&this.interaction.hoverData||{x:this.width/2,y:this.height/2}}get clientBounds(){return this.canvas&&this.canvas.getClientBounds()}constructor(t,e){super(e),this.config={type:"design",start:!0,hittable:!0,smooth:!0,lazySpeard:100,zoom:{min:.01,max:256},move:{holdSpaceKey:!0,holdMiddleKey:!0,autoDistance:2}},this.leafs=0,this.__eventIds=[],this.__controllers=[],this.__readyWait=[],this.__viewReadyWait=[],this.__viewCompletedWait=[],this.__nextRenderWait=[],this.userConfig=t,t&&(t.view||t.width)&&this.init(t),Cs.list.add(this)}init(t,e){if(this.canvas)return;this.__setLeafer(this),t&&at.assign(this.config,t);let s;const{config:n}=this;this.initType(n.type);const r=this.canvas=nt.canvas(n);this.__controllers.push(this.renderer=nt.renderer(this,r,n),this.watcher=nt.watcher(this,n),this.layouter=nt.layouter(this,n)),this.isApp&&this.__setApp(),this.__checkAutoLayout(n,e),this.view=r.view,e?(this.__bindApp(e),s=e.running):(this.selector=nt.selector(this),this.interaction=nt.interaction(this,r,this.selector,n),this.interaction&&(this.__controllers.unshift(this.interaction),this.hitCanvasManager=nt.hitCanvasManager()),this.canvasManager=new Xa,s=n.start),this.hittable=n.hittable,this.fill=n.fill,this.canvasManager.add(r),this.__listenEvents(),s&&(this.__startTimer=setTimeout(this.start.bind(this))),He.run(this.__initWait),this.onInit()}onInit(){}initType(t){}set(t){this.waitInit(()=>{super.set(t)})}start(){clearTimeout(this.__startTimer),!this.running&&this.canvas&&(this.ready?this.emitLeafer(tt.RESTART):this.emitLeafer(tt.START),this.__controllers.forEach(t=>t.start()),this.isApp||this.renderer.render(),this.running=!0)}stop(){clearTimeout(this.__startTimer),this.running&&this.canvas&&(this.__controllers.forEach(t=>t.stop()),this.running=!1,this.emitLeafer(tt.STOP))}unlockLayout(){this.layouter.start(),this.updateLayout()}lockLayout(){this.updateLayout(),this.layouter.stop()}resize(t){const e=at.copyAttrs({},t,ue);Object.keys(e).forEach(s=>this[s]=e[s])}forceRender(t){this.renderer.addBlock(t?new Z(t):this.canvas.bounds),this.viewReady&&this.renderer.update()}updateCursor(t){const e=this.interaction;e&&(t?e.setCursor(t):e.updateCursor())}updateLazyBounds(){this.lazyBounds=this.canvas.bounds.clone().spread(this.config.lazySpeard)}__doResize(t){const{canvas:e}=this;if(!e||e.isSameSize(t))return;const s=at.copyAttrs({},this.canvas,ue);e.resize(t),this.updateLazyBounds(),this.__onResize(new qe(t,s))}__onResize(t){this.emitEvent(t),at.copyAttrs(this.__,t,ue),(!t.width||!t.height)&&gs.warn("w = 0 or h = 0"),setTimeout(()=>{this.canvasManager&&this.canvasManager.clearRecycled()},0)}__setApp(){}__bindApp(t){this.selector=t.selector,this.interaction=t.interaction,this.canvasManager=t.canvasManager,this.hitCanvasManager=t.hitCanvasManager}__setLeafer(t){this.leafer=t,this.__level=1}__checkAutoLayout(t,e){e||((!t.width||!t.height)&&(this.autoLayout=new hl(t)),this.canvas.startAutoLayout(this.autoLayout,this.__onResize.bind(this)))}__setAttr(t,e){return this.canvas&&(ue.includes(t)?(e||gs.warn(t+" is 0"),this.__changeCanvasSize(t,e)):t==="fill"?this.__changeFill(e):t==="hittable"?this.parent||(this.canvas.hittable=e):t==="zIndex"&&(this.canvas.zIndex=e,setTimeout(()=>this.parent&&this.parent.__updateSortChildren()))),super.__setAttr(t,e)}__getAttr(t){return this.canvas&&ue.includes(t)?this.canvas[t]:super.__getAttr(t)}__changeCanvasSize(t,e){const s=at.copyAttrs({},this.canvas,ue);s[t]=this.config[t]=e,e&&this.canvas.stopAutoLayout(),this.__doResize(s)}__changeFill(t){this.config.fill=t,this.canvas.allowBackgroundColor?this.canvas.backgroundColor=t:this.forceRender()}__onCreated(){this.created=!0}__onReady(){this.ready||(this.ready=!0,this.emitLeafer(tt.BEFORE_READY),this.emitLeafer(tt.READY),this.emitLeafer(tt.AFTER_READY),He.run(this.__readyWait))}__onViewReady(){this.viewReady||(this.viewReady=!0,this.emitLeafer(tt.VIEW_READY),He.run(this.__viewReadyWait))}__onNextRender(){if(this.viewReady){He.run(this.__nextRenderWait);const{imageReady:t}=this;t&&!this.viewCompleted&&this.__checkViewCompleted(),t||(this.viewCompleted=!1)}}__checkViewCompleted(t=!0){this.nextRender(()=>{this.imageReady&&(t&&this.emitLeafer(tt.VIEW_COMPLETED),He.run(this.__viewCompletedWait),this.viewCompleted=!0)})}__onWatchData(){this.watcher.childrenChanged&&this.interaction&&this.nextRender(()=>this.interaction.updateCursor())}waitInit(t,e){e&&(t=t.bind(e)),this.__initWait||(this.__initWait=[]),this.canvas?t():this.__initWait.push(t)}waitReady(t,e){e&&(t=t.bind(e)),this.ready?t():this.__readyWait.push(t)}waitViewReady(t,e){e&&(t=t.bind(e)),this.viewReady?t():this.__viewReadyWait.push(t)}waitViewCompleted(t,e){e&&(t=t.bind(e)),this.__viewCompletedWait.push(t),this.viewCompleted?this.__checkViewCompleted(!1):this.running||this.start()}nextRender(t,e,s){e&&(t=t.bind(e));const n=this.__nextRenderWait;if(s){for(let r=0;r<n.length;r++)if(n[r]===t){n.splice(r,1);break}}else n.push(t)}zoom(t,e,s){return gs.error("need @leafer-in/view")}getValidMove(t,e){return{x:t,y:e}}getValidScale(t){return t}getWorldPointByClient(t,e){return this.interaction&&this.interaction.getLocal(t,e)}__checkUpdateLayout(){this.__layout.update()}emitLeafer(t){this.emitEvent(new tt(t,this))}__listenEvents(){const t=Ft.start("FirstCreate "+this.innerName);this.once(tt.START,()=>Ft.end(t)),this.once(H.START,()=>this.updateLazyBounds()),this.once(H.END,()=>this.__onReady()),this.once(G.START,()=>this.__onCreated()),this.once(G.END,()=>this.__onViewReady()),this.__eventIds.push(this.on_(Be.DATA,this.__onWatchData,this),this.on_(G.NEXT,this.__onNextRender,this),this.on_(H.CHECK_UPDATE,this.__checkUpdateLayout,this))}__removeListenEvents(){this.off_(this.__eventIds),this.__eventIds.length=0}destroy(t){const e=()=>{if(!this.destroyed){Cs.list.remove(this);try{this.stop(),this.emitEvent(new tt(tt.END,this)),this.__removeListenEvents(),this.__controllers.forEach(s=>{this.parent&&s===this.interaction||s.destroy()}),this.__controllers.length=0,this.parent||(this.selector&&this.selector.destroy(),this.hitCanvasManager&&this.hitCanvasManager.destroy(),this.canvasManager.destroy()),this.canvas.destroy(),this.config.view=this.view=null,this.userConfig&&(this.userConfig.view=null),super.destroy(),setTimeout(()=>{xt.clearRecycled()},100)}catch(s){gs.error(s)}}};t?e():setTimeout(e)}};Ee.list=new it;d([lt(Pd)],Ee.prototype,"__",void 0);d([L()],Ee.prototype,"pixelRatio",void 0);Ee=Cs=d([ct()],Ee);let Ve=class extends y{get __tag(){return"Rect"}constructor(t){super(t)}};d([lt(Br)],Ve.prototype,"__",void 0);Ve=d([$t(Gd),Fs(),ct()],Ve);const Ze=Ve.prototype,Ud=Zt.prototype,En={},{copy:Yd,add:Vd,includes:Xd}=S;let ot=class extends Zt{get __tag(){return"Box"}get isBranchLeaf(){return!0}constructor(t){super(t),this.__layout.renderChanged||this.__layout.renderChange()}__updateStrokeSpread(){return 0}__updateRectRenderSpread(){return 0}__updateRenderSpread(){return this.__updateRectRenderSpread()||-1}__updateRectBoxBounds(){}__updateBoxBounds(){const t=this.__;if(this.children.length){if(t.__autoSide){if(this.leafer&&this.leafer.ready&&this.leafer.layouter.addExtra(this),super.__updateBoxBounds(),!t.__autoSize){const e=this.__layout.boxBounds;t.__autoWidth||(e.height+=e.y,e.width=t.width,e.x=e.y=0),t.__autoHeight||(e.width+=e.x,e.height=t.height,e.y=e.x=0)}}else this.__updateRectBoxBounds();t.flow&&this.__updateContentBounds()}else this.__updateRectBoxBounds()}__updateStrokeBounds(){}__updateRenderBounds(){let t;const{renderBounds:e}=this.__layout;this.children.length?(super.__updateRenderBounds(),Yd(En,e),this.__updateRectRenderBounds(),t=!Xd(e,En)||void 0):this.__updateRectRenderBounds(),this.isOverflow!==t&&(this.isOverflow=t),t&&!(this.__.__drawAfterFill=this.__.overflow==="hide")&&Vd(e,En)}__updateRectRenderBounds(){}__updateRectChange(){}__updateChange(){super.__updateChange(),this.__updateRectChange()}__renderRect(t,e){}__renderGroup(t,e){}__render(t,e){this.__.__drawAfterFill?this.__renderRect(t,e):(this.__renderRect(t,e),this.children.length&&this.__renderGroup(t,e))}__drawAfterFill(t,e){const{length:s}=this.children;this.isOverflow?(t.save(),t.clip(),s&&this.__renderGroup(t,e),t.restore()):s&&this.__renderGroup(t,e),this.__.stroke&&s&&(t.setWorld(this.__nowWorld),this.__drawRenderPath(t))}};d([lt(kr)],ot.prototype,"__",void 0);d([dt(!1)],ot.prototype,"resizeChildren",void 0);d([hh("show")],ot.prototype,"overflow",void 0);d([jt(Ze.__updateStrokeSpread)],ot.prototype,"__updateStrokeSpread",null);d([jt(Ze.__updateRenderSpread)],ot.prototype,"__updateRectRenderSpread",null);d([jt(Ze.__updateBoxBounds)],ot.prototype,"__updateRectBoxBounds",null);d([jt(Ze.__updateStrokeBounds)],ot.prototype,"__updateStrokeBounds",null);d([jt(Ze.__updateRenderBounds)],ot.prototype,"__updateRectRenderBounds",null);d([jt(Ze.__updateChange)],ot.prototype,"__updateRectChange",null);d([jt(Ze.__render)],ot.prototype,"__renderRect",null);d([jt(Ud.__render)],ot.prototype,"__renderGroup",null);ot=d([Fs(),ct()],ot);let zi=class extends ot{get __tag(){return"Frame"}get isFrame(){return!0}constructor(t){super(t)}};d([lt(Od)],zi.prototype,"__",void 0);d([Xi("#FFFFFF")],zi.prototype,"fill",void 0);d([hh("hide")],zi.prototype,"overflow",void 0);zi=d([ct()],zi);const{moveTo:jo,closePath:Go,ellipse:ni}=Xe;let _i=class extends y{get __tag(){return"Ellipse"}constructor(t){super(t)}__updatePath(){const{width:t,height:e,innerRadius:s,startAngle:n,endAngle:r}=this.__,o=t/2,a=e/2,h=this.__.path=[];s?(n||r?(s<1&&ni(h,o,a,o*s,a*s,0,n,r,!1),ni(h,o,a,o,a,0,r,n,!0),s<1&&Go(h)):(s<1&&(ni(h,o,a,o*s,a*s),jo(h,t,a)),ni(h,o,a,o,a,0,360,0,!0)),b.ellipseToCurve&&(this.__.path=this.getPath(!0))):n||r?(jo(h,o,a),ni(h,o,a,o,a,0,n,r,!1),Go(h)):ni(h,o,a,o,a)}};d([lt(Md)],_i.prototype,"__",void 0);d([gt(0)],_i.prototype,"innerRadius",void 0);d([gt(0)],_i.prototype,"startAngle",void 0);d([gt(0)],_i.prototype,"endAngle",void 0);_i=d([ct()],_i);const{moveTo:Kd,lineTo:qd,drawPoints:Uo}=Xe,{rotate:Zd,getAngle:Qd,getDistance:Jd,defaultPoint:Yo}=E,{toBounds:tf}=br;let Qt=class extends y{get __tag(){return"Line"}get toPoint(){const{width:t,rotation:e}=this.__,s=Ua();return t&&(s.x=t),e&&Zd(s,e),s}set toPoint(t){this.width=Jd(Yo,t),this.rotation=Qd(Yo,t),this.height&&(this.height=0)}constructor(t){super(t)}__updatePath(){const t=this.__,e=t.path=[];t.points?Uo(e,t.points,!1,t.closed):(Kd(e,0,0),qd(e,this.width,0))}__updateRenderPath(){const t=this.__;!this.pathInputed&&t.points&&t.curve?(Uo(t.__pathForRender=[],t.points,t.curve,t.closed),t.__useArrow&&fh.addArrows(this,!1)):super.__updateRenderPath()}__updateBoxBounds(){this.points?tf(this.__.__pathForRender,this.__layout.boxBounds):super.__updateBoxBounds()}};d([lt(Ld)],Qt.prototype,"__",void 0);d([$s("center")],Qt.prototype,"strokeAlign",void 0);d([L(0)],Qt.prototype,"height",void 0);d([gt()],Qt.prototype,"points",void 0);d([gt(0)],Qt.prototype,"curve",void 0);d([gt(!1)],Qt.prototype,"closed",void 0);Qt=d([ct()],Qt);const{sin:ef,cos:sf,PI:Vo}=Math,{moveTo:nf,lineTo:rf,closePath:of,drawPoints:af}=Xe,gh=Qt.prototype;let pe=class extends y{get __tag(){return"Polygon"}constructor(t){super(t)}__updatePath(){const t=this.__.path=[];if(this.__.points)af(t,this.__.points,!1,!0);else{const{width:e,height:s,sides:n}=this.__,r=e/2,o=s/2;nf(t,r,0);for(let a=1;a<n;a++)rf(t,r+r*ef(a*2*Vo/n),o-o*sf(a*2*Vo/n))}of(t)}__updateRenderPath(){}__updateBoxBounds(){}};d([lt(Ad)],pe.prototype,"__",void 0);d([gt(3)],pe.prototype,"sides",void 0);d([gt()],pe.prototype,"points",void 0);d([gt(0)],pe.prototype,"curve",void 0);d([jt(gh.__updateRenderPath)],pe.prototype,"__updateRenderPath",null);d([jt(gh.__updateBoxBounds)],pe.prototype,"__updateBoxBounds",null);pe=d([Fs(),ct()],pe);const{sin:hf,cos:lf,PI:Xo}=Math,{moveTo:cf,lineTo:uf,closePath:df}=Xe;let Hi=class extends y{get __tag(){return"Star"}constructor(t){super(t)}__updatePath(){const{width:t,height:e,corners:s,innerRadius:n}=this.__,r=t/2,o=e/2,a=this.__.path=[];cf(a,r,0);for(let h=1;h<s*2;h++)uf(a,r+(h%2===0?r:r*n)*hf(h*Xo/s),o-(h%2===0?o:o*n)*lf(h*Xo/s));df(a)}};d([lt(Dd)],Hi.prototype,"__",void 0);d([gt(5)],Hi.prototype,"corners",void 0);d([gt(.382)],Hi.prototype,"innerRadius",void 0);Hi=d([ct()],Hi);let Ps=class extends Ve{get __tag(){return"Image"}get ready(){return this.image?this.image.ready:!1}constructor(t){super(t),this.on(Oe.LOADED,e=>{e.attrName==="fill"&&e.attrValue.url===this.url&&(this.image=e.image)})}destroy(){this.image=null,super.destroy()}};d([lt(zd)],Ps.prototype,"__",void 0);d([L("")],Ps.prototype,"url",void 0);Ps=d([ct()],Ps);let Te=class extends Ve{get __tag(){return"Canvas"}constructor(t){super(t),this.canvas=nt.canvas(this.__),this.context=this.canvas.context,this.__.__isCanvas=this.__.__drawAfterFill=!0}draw(t,e,s,n){t.__layout.update();const r=new Ce(t.__world).invert(),o=new Ce;e&&o.translate(e.x,e.y),s&&(typeof s=="number"?o.scale(s):o.scale(s.x,s.y)),n&&o.rotate(n),r.multiplyParent(o),t.__render(this.canvas,{matrix:r.withScale()}),this.paint()}paint(){this.forceUpdate("fill")}__drawAfterFill(t,e){const s=this.canvas.view,{width:n,height:r}=this;this.__.cornerRadius||this.pathInputed?(t.save(),t.clip(),t.drawImage(this.canvas.view,0,0,s.width,s.height,0,0,n,r),t.restore()):t.drawImage(this.canvas.view,0,0,s.width,s.height,0,0,n,r)}__updateSize(){const{canvas:t}=this;if(t){const{smooth:e}=this.__;t.smooth!==e&&(t.smooth=e),t.resize(this.__)}}destroy(){this.canvas&&(this.canvas.destroy(),this.canvas=this.context=null),super.destroy()}};d([lt(Hd)],Te.prototype,"__",void 0);d([Zi(100)],Te.prototype,"width",void 0);d([Zi(100)],Te.prototype,"height",void 0);d([Zi(b.devicePixelRatio)],Te.prototype,"pixelRatio",void 0);d([Zi(!0)],Te.prototype,"smooth",void 0);d([Zi()],Te.prototype,"contextSettings",void 0);Te=d([ct()],Te);const{copyAndSpread:ff,includes:_f,isSame:pf,spread:gf,setList:yf}=S;let N=class extends y{get __tag(){return"Text"}get editInner(){return"TextEditor"}get textDrawData(){return this.__layout.update(),this.__.__textDrawData}constructor(t){super(t)}__drawHitPath(t){const{__lineHeight:e,__baseLine:s,__textDrawData:n}=this.__;t.beginPath(),this.__.__letterSpacing<0?this.__drawPathByData(t):n.rows.forEach(r=>t.rect(r.x,r.y-s,r.width,e))}__drawPathByData(t,e){const{x:s,y:n,width:r,height:o}=this.__layout.boxBounds;t.rect(s,n,r,o)}__drawRenderPath(t){t.font=this.__.__font}__updateTextDrawData(){const t=this.__;t.__textDrawData=dh.getDrawData(t.text,this.__)}__updateBoxBounds(){const t=this.__,e=this.__layout,{lineHeight:s,letterSpacing:n,fontFamily:r,fontSize:o,fontWeight:a,italic:h,textCase:l,textOverflow:c,padding:p}=t,_=t.__autoWidth,u=t.__autoHeight;t.__lineHeight=Ho.number(s,o),t.__letterSpacing=Ho.number(n,o),t.__padding=p?At.fourNumber(p):void 0,t.__baseLine=t.__lineHeight-(t.__lineHeight-o*.7)/2,t.__font=`${h?"italic ":""}${l==="small-caps"?"small-caps ":""}${a!=="normal"?a+" ":""}${o}px ${r}`,t.__clipText=c!=="show"&&!t.__autoSize,this.__updateTextDrawData();const{bounds:f}=t.__textDrawData,g=e.boxBounds;if(t.__lineHeight<o&&gf(f,o/2),_||u){if(g.x=_?f.x:0,g.y=u?f.y:0,g.width=_?f.width:t.width,g.height=u?f.height:t.height,p){const[w,m,v,R]=t.__padding;_&&(g.x-=R,g.width+=m+R),u&&(g.y-=w,g.height+=v+w)}this.__updateNaturalSize()}else super.__updateBoxBounds();h&&(g.width+=o*.16);const x=_f(g,f)?g:f;pf(x,e.contentBounds)?t.__textBoxBounds=x:(e.contentBounds=x,e.renderChanged=!0,yf(t.__textBoxBounds={},[g,f]))}__updateRenderSpread(){let t=super.__updateRenderSpread();return t||(t=this.__layout.boxBounds===this.__layout.contentBounds?0:1),t}__updateRenderBounds(){ff(this.__layout.renderBounds,this.__.__textBoxBounds,this.__layout.renderSpread)}};d([lt(Fd)],N.prototype,"__",void 0);d([L(0)],N.prototype,"width",void 0);d([L(0)],N.prototype,"height",void 0);d([dt(!1)],N.prototype,"resizeFontSize",void 0);d([Xi("#000000")],N.prototype,"fill",void 0);d([$s("outside")],N.prototype,"strokeAlign",void 0);d([Ke("all")],N.prototype,"hitFill",void 0);d([L("")],N.prototype,"text",void 0);d([L("L")],N.prototype,"fontFamily",void 0);d([L(12)],N.prototype,"fontSize",void 0);d([L("normal")],N.prototype,"fontWeight",void 0);d([L(!1)],N.prototype,"italic",void 0);d([L("none")],N.prototype,"textCase",void 0);d([L("none")],N.prototype,"textDecoration",void 0);d([L(0)],N.prototype,"letterSpacing",void 0);d([L({type:"percent",value:1.5})],N.prototype,"lineHeight",void 0);d([L(0)],N.prototype,"paraIndent",void 0);d([L(0)],N.prototype,"paraSpacing",void 0);d([L("left")],N.prototype,"textAlign",void 0);d([L("top")],N.prototype,"verticalAlign",void 0);d([L("normal")],N.prototype,"textWrap",void 0);d([L("show")],N.prototype,"textOverflow",void 0);N=d([ct()],N);let pi=class extends y{get __tag(){return"Path"}constructor(t){super(t),this.__.__pathInputed=2}};d([lt(Id)],pi.prototype,"__",void 0);d([$s("center")],pi.prototype,"strokeAlign",void 0);pi=d([ct()],pi);let Os=class extends Zt{get __tag(){return"Pen"}constructor(t){super(t)}setStyle(t){const e=this.pathElement=new pi(t);return this.pathStyle=t,this.__path=e.path||(e.path=[]),this.add(e),this}beginPath(){return this.__path.length=0,this.paint(),this}moveTo(t,e){return this}lineTo(t,e){return this}bezierCurveTo(t,e,s,n,r,o){return this}quadraticCurveTo(t,e,s,n){return this}closePath(){return this}rect(t,e,s,n){return this}roundRect(t,e,s,n,r){return this}ellipse(t,e,s,n,r,o,a,h){return this}arc(t,e,s,n,r,o){return this}arcTo(t,e,s,n,r){return this}drawEllipse(t,e,s,n,r,o,a,h){return this}drawArc(t,e,s,n,r,o){return this}drawPoints(t,e,s){return this}clearPath(){return this}paint(){this.pathElement.forceUpdate("path")}};d([lt(Wd)],Os.prototype,"__",void 0);d([mf()],Os.prototype,"path",void 0);Os=d([$t(vr,["set","beginPath","path"]),ct()],Os);function mf(){return(i,t)=>{mi(i,t,{get(){return this.__path}})}}function ye(i,t,e,s){var n=arguments.length,r=n<3?t:s===null?s=Object.getOwnPropertyDescriptor(t,e):s,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(i,t,e,s);else for(var a=i.length-1;a>=0;a--)(o=i[a])&&(r=(n<3?o(r):n>3?o(t,e,r):o(t,e))||r);return n>3&&r&&Object.defineProperty(t,e,r),r}let Ko=class extends Ee{get __tag(){return"App"}get isApp(){return!0}constructor(t,e){super(t,e)}init(t,e){if(super.init(t,e),t){const{ground:s,tree:n,sky:r,editor:o}=t;s&&(this.ground=this.addLeafer(s)),(n||o)&&(this.tree=this.addLeafer(n)),(r||o)&&(this.sky=this.addLeafer(r||{type:"draw",usePartRender:!1})),o&&(this.editor=nt.editor(o),this.sky.add(this.editor))}}__setApp(){const{canvas:t}=this,{realCanvas:e,view:s}=this.config;e||s===this.canvas.view||!t.parentView?this.realCanvas=!0:t.unrealCanvas(),this.leafer=this,this.watcher.disable(),this.layouter.disable(),this.__eventIds.push(this.on_(de.CHANGE,this.__onPropertyChange,this))}start(){super.start(),this.children.forEach(t=>t.start())}stop(){this.children.forEach(t=>t.stop()),super.stop()}unlockLayout(){super.unlockLayout(),this.children.forEach(t=>t.unlockLayout())}lockLayout(){super.lockLayout(),this.children.forEach(t=>t.lockLayout())}forceRender(t){this.children.forEach(e=>e.forceRender(t))}addLeafer(t){const e=new Ee(t);return this.add(e),e}add(t,e){if(!t.view){if(this.realCanvas&&!this.canvas.bounds){setTimeout(()=>this.add(t,e),10);return}t.init(this.__getChildConfig(t.userConfig),this)}super.add(t,e),e!==void 0&&(t.canvas.childIndex=e),this.__listenChildEvents(t)}__onPropertyChange(){F.showHitView&&this.children.forEach(t=>t.forceUpdate("surface"))}__onCreated(){this.created=this.children.every(t=>t.created)}__onReady(){this.children.every(t=>t.ready)&&super.__onReady()}__onViewReady(){this.children.every(t=>t.viewReady)&&super.__onViewReady()}__onChildRenderEnd(t){this.renderer.addBlock(t.renderBounds),this.viewReady&&this.renderer.update()}__render(t,e){if(t.context){if(e.matrix){const{a:s,b:n,c:r,d:o,e:a,f:h}=e.matrix;t.setTransform(s,n,r,o,a,h)}this.children.forEach(s=>t.copyWorld(s.canvas))}}__onResize(t){this.children.forEach(e=>e.resize(t)),super.__onResize(t)}__checkUpdateLayout(){this.children.forEach(t=>t.__layout.update())}__getChildConfig(t){let e=Object.assign({},this.config);return e.hittable=e.realCanvas=void 0,t&&at.assign(e,t),this.autoLayout&&at.copyAttrs(e,this,ue),e.view=this.realCanvas?void 0:this.view,e.fill=void 0,e}__listenChildEvents(t){t.once(H.END,()=>this.__onReady()),t.once(G.START,()=>this.__onCreated()),t.once(G.END,()=>this.__onViewReady()),this.realCanvas&&this.__eventIds.push(t.on_(G.END,this.__onChildRenderEnd,this))}};Ko=ye([ct()],Ko);const ys={},Ii={isHoldSpaceKey(){return Ii.isHold("Space")},isHold(i){return ys[i]},setDownCode(i){ys[i]||(ys[i]=!0)},setUpCode(i){ys[i]=!1}},Wt={LEFT:1,RIGHT:2,MIDDLE:4,defaultLeft(i){i.buttons||(i.buttons=1)},left(i){return i.buttons===1},right(i){return i.buttons===2},middle(i){return i.buttons===4}};class Ns extends ee{get spaceKey(){return Ii.isHoldSpaceKey()}get left(){return Wt.left(this)}get right(){return Wt.right(this)}get middle(){return Wt.middle(this)}constructor(t){super(t.type),this.bubbles=!0,Object.assign(this,t)}getPage(){return this.current.getPagePoint(this)}getInner(t){return t||(t=this.current),t.getInnerPoint(this)}getLocal(t){return t||(t=this.current),t.getLocalPoint(this)}static changeName(t,e){fi.changeName(t,e)}}let C=class extends Ns{};C.POINTER="pointer";C.BEFORE_DOWN="pointer.before_down";C.BEFORE_MOVE="pointer.before_move";C.BEFORE_UP="pointer.before_up";C.DOWN="pointer.down";C.MOVE="pointer.move";C.UP="pointer.up";C.OVER="pointer.over";C.OUT="pointer.out";C.ENTER="pointer.enter";C.LEAVE="pointer.leave";C.TAP="tap";C.DOUBLE_TAP="double_tap";C.CLICK="click";C.DOUBLE_CLICK="double_click";C.LONG_PRESS="long_press";C.LONG_TAP="long_tap";C.MENU="pointer.menu";C.MENU_TAP="pointer.menu_tap";C=ye([Pe()],C);const Ei={};let W=class extends C{static setList(t){this.list=t instanceof it?t:new it(t)}static setData(t){this.data=t}static getValidMove(t,e,s){const{draggable:n,dragBounds:r,x:o,y:a}=t,h=t.getLocalPoint(s,null,!0);return h.x+=e.x-o,h.y+=e.y-a,r&&this.getMoveInDragBounds(t.__local,r==="parent"?t.parent.boxBounds:r,h,!0),n==="x"&&(h.y=0),n==="y"&&(h.x=0),h}static getMoveInDragBounds(t,e,s,n){const r=t.x+s.x,o=t.y+s.y,a=r+t.width,h=o+t.height,l=e.x+e.width,c=e.y+e.height;return n||(s=Object.assign({},s)),S.includes(t,e)?(r>e.x?s.x+=e.x-r:a<l&&(s.x+=l-a),o>e.y?s.y+=e.y-o:h<c&&(s.y+=c-h)):(r<e.x?s.x+=e.x-r:a>l&&(s.x+=l-a),o<e.y?s.y+=e.y-o:h>c&&(s.y+=c-h)),s}getPageMove(t){return this.assignMove(t),this.current.getPagePoint(Ei,null,!0)}getInnerMove(t,e){return t||(t=this.current),this.assignMove(e),t.getInnerPoint(Ei,null,!0)}getLocalMove(t,e){return t||(t=this.current),this.assignMove(e),t.getLocalPoint(Ei,null,!0)}getPageTotal(){return this.getPageMove(!0)}getInnerTotal(t){return this.getInnerMove(t,!0)}getLocalTotal(t){return this.getLocalMove(t,!0)}getPageBounds(){const t=this.getPageTotal(),e=this.getPage(),s={};return S.set(s,e.x-t.x,e.y-t.y,t.x,t.y),S.unsign(s),s}assignMove(t){Ei.x=t?this.totalX:this.moveX,Ei.y=t?this.totalY:this.moveY}};W.BEFORE_DRAG="drag.before_drag";W.START="drag.start";W.DRAG="drag";W.END="drag.end";W.OVER="drag.over";W.OUT="drag.out";W.ENTER="drag.enter";W.LEAVE="drag.leave";W=ye([Pe()],W);let Ni=class extends C{static setList(t){W.setList(t)}static setData(t){W.setData(t)}};Ni.DROP="drop";Ni=ye([Pe()],Ni);let pt=class extends W{};pt.BEFORE_MOVE="move.before_move";pt.START="move.start";pt.MOVE="move";pt.END="move.end";pt=ye([Pe()],pt);let qt=class extends Ns{};qt.BEFORE_ROTATE="rotate.before_rotate";qt.START="rotate.start";qt.ROTATE="rotate";qt.END="rotate.end";qt=ye([Pe()],qt);let zt=class extends W{};zt.SWIPE="swipe";zt.LEFT="swipe.left";zt.RIGHT="swipe.right";zt.UP="swipe.up";zt.DOWN="swipe.down";zt=ye([Pe()],zt);let Ht=class extends Ns{};Ht.BEFORE_ZOOM="zoom.before_zoom";Ht.START="zoom.start";Ht.ZOOM="zoom";Ht.END="zoom.end";Ht=ye([Pe()],Ht);let Se=class extends Ns{};Se.DOWN="key.down";Se.HOLD="key.hold";Se.UP="key.up";Se=ye([Pe()],Se);function yh(i){i.isApp||i.__eventIds.push(i.on_(pt.BEFORE_MOVE,t=>{i.zoomLayer.move(i.getValidMove(t.moveX,t.moveY))}),i.on_(Ht.BEFORE_ZOOM,t=>{const{zoomLayer:e}=i,s=i.getValidScale(t.scale);s!==1&&(E.scaleOf(e,t,s),e.scale=e.__.scaleX*s)}))}function wf(i){yh(i),i.config.move.scroll="limit",i.config.zoom.min=1}const qo=F.get("LeaferTypeCreator"),mh={list:{},register(i,t){Tn[i]?qo.repeat(i):Tn[i]=t},run(i,t){const e=Tn[i];e?e(t):qo.error("no",i)}},{list:Tn,register:js}=mh;js("draw",()=>{});js("custom",()=>{});js("design",yh);js("document",wf);const Sr=Ee.prototype;Sr.initType=function(i){mh.run(i,this)};Sr.getValidMove=function(i,t){const{scroll:e,disabled:s}=this.app.config.move;if(e&&(Math.abs(i)>Math.abs(t)?t=0:i=0,e==="limit")){const{x:n,y:r,width:o,height:a}=new Z(this.__world).addPoint(this.zoomLayer),h=n+o-this.width,l=r+a-this.height;n>=0&&h<=0?i=0:i>0?n+i>0&&(i=-n):i<0&&h+i<0&&(i=-h),r>=0&&l<=0?t=0:t>0?r+t>0&&(t=-r):t<0&&l+t<0&&(t=-l)}return{x:s?0:i,y:s?0:t}};Sr.getValidScale=function(i){const{scaleX:t}=this.zoomLayer.__,{min:e,max:s,disabled:n}=this.app.config.zoom,r=Math.abs(t*i);return r<e?i=e/t:r>s&&(i=s/t),n?1:i};class xf{get transforming(){return!!(this.moveData||this.zoomData||this.rotateData)}constructor(t){this.interaction=t}move(t){const{interaction:e}=this;if(t.moveType||(t.moveType="move"),!this.moveData){const{path:s}=e.selector.getByPoint(t,e.hitRadius);t.path=s,this.moveData=Object.assign(Object.assign({},t),{moveX:0,moveY:0}),e.cancelHover(),e.emit(pt.START,this.moveData)}t.path=this.moveData.path,e.emit(pt.BEFORE_MOVE,t),e.emit(pt.MOVE,t),this.transformEndWait()}zoom(t){const{interaction:e}=this;if(!this.zoomData){const{path:s}=e.selector.getByPoint(t,e.hitRadius);t.path=s,this.zoomData=Object.assign(Object.assign({},t),{scale:1}),e.cancelHover(),e.emit(Ht.START,this.zoomData)}t.path=this.zoomData.path,e.emit(Ht.BEFORE_ZOOM,t),e.emit(Ht.ZOOM,t),this.transformEndWait()}rotate(t){const{interaction:e}=this;if(!this.rotateData){const{path:s}=e.selector.getByPoint(t,e.hitRadius);t.path=s,this.rotateData=Object.assign(Object.assign({},t),{rotation:0}),e.cancelHover(),e.emit(qt.START,this.rotateData)}t.path=this.rotateData.path,e.emit(qt.BEFORE_ROTATE,t),e.emit(qt.ROTATE,t),this.transformEndWait()}transformEndWait(){clearTimeout(this.transformTimer),this.transformTimer=setTimeout(()=>{this.transformEnd()},this.interaction.config.pointer.transformTime)}transformEnd(){this.moveEnd(),this.zoomEnd(),this.rotateEnd()}moveEnd(){this.moveData&&(this.interaction.emit(pt.END,this.moveData),this.moveData=null)}zoomEnd(){this.zoomData&&(this.interaction.emit(Ht.END,this.zoomData),this.zoomData=null)}rotateEnd(){this.rotateData&&(this.interaction.emit(qt.END,this.rotateData),this.rotateData=null)}destroy(){this.zoomData=this.moveData=this.rotateData=null}}const Nt={getMoveEventData(i,t,e){return Object.assign(Object.assign({},e),{x:i.x,y:i.y,moveX:t.x,moveY:t.y})},getRotateEventData(i,t,e){return Object.assign(Object.assign({},e),{x:i.x,y:i.y,rotation:t})},getZoomEventData(i,t,e){return Object.assign(Object.assign({},e),{x:i.x,y:i.y,scale:t})},getDragEventData(i,t,e){return Object.assign(Object.assign({},e),{x:e.x,y:e.y,moveX:e.x-t.x,moveY:e.y-t.y,totalX:e.x-i.x,totalY:e.y-i.y})},getDropEventData(i,t,e){return Object.assign(Object.assign({},i),{list:t,data:e})},getSwipeDirection(i){return i<-45&&i>-135?zt.UP:i>45&&i<135?zt.DOWN:i<=45&&i>=-45?zt.RIGHT:zt.LEFT},getSwipeEventData(i,t,e){return Object.assign(Object.assign({},e),{moveX:t.moveX,moveY:t.moveY,totalX:e.x-i.x,totalY:e.y-i.y,type:vf.getSwipeDirection(E.getAngle(i,e))})},getBase(i){const t=i.button===1?4:i.button;return{altKey:i.altKey,ctrlKey:i.ctrlKey,shiftKey:i.shiftKey,metaKey:i.metaKey,buttons:i.buttons===void 0?1:i.buttons===0?t:i.buttons,origin:i}},pathHasEventType(i,t){const{list:e}=i;for(let s=0,n=e.length;s<n;s++)if(e[s].hasEvent(t))return!0;return!1},filterPathByEventType(i,t){const e=new it,{list:s}=i;for(let n=0,r=s.length;n<r;n++)s[n].hasEvent(t)&&e.add(s[n]);return e}},vf=Nt,Zo=new it,{getDragEventData:Pn,getDropEventData:bf,getSwipeEventData:Rf}=Nt;class kf{constructor(t){this.interaction=t}setDragData(t){this.animateWait&&this.dragEndReal(),this.downData=this.interaction.downData,this.dragData=Pn(t,t,t),this.canAnimate=this.canDragOut=!0}getList(){const{proxy:t}=this.interaction.selector;return this.dragging&&(!t||!t.list.length)&&(W.list||this.dragableList)||Zo}checkDrag(t,e){const{interaction:s}=this;if(this.moving&&t.buttons<1){this.canAnimate=!1,s.pointerCancel();return}!this.moving&&e&&(this.moving=s.canMove(this.downData)||s.isHoldRightKey||s.isMobileDragEmpty)&&(this.dragData.moveType="drag",s.emit(pt.START,this.dragData)),this.moving||this.dragStart(t,e),this.drag(t)}dragStart(t,e){this.dragging||(this.dragging=e&&Wt.left(t),this.dragging&&(this.interaction.emit(W.START,this.dragData),this.getDragableList(this.dragData.path),this.setDragStartPoints(this.realDragableList=this.getList())))}setDragStartPoints(t){this.dragStartPoints={},t.forEach(e=>this.dragStartPoints[e.innerId]={x:e.x,y:e.y})}getDragableList(t){let e;for(let s=0,n=t.length;s<n;s++)if(e=t.list[s],(e.__.draggable||e.__.editable)&&e.__.hitSelf&&!e.__.locked){this.dragableList=new it(e);break}}drag(t){const{interaction:e,dragData:s,downData:n}=this,{path:r,throughPath:o}=n;this.dragData=Pn(n,s,t),o&&(this.dragData.throughPath=o),this.dragData.path=r,this.moving?(this.dragData.moveType="drag",e.emit(pt.BEFORE_MOVE,this.dragData),e.emit(pt.MOVE,this.dragData)):this.dragging&&(this.dragReal(),e.emit(W.BEFORE_DRAG,this.dragData),e.emit(W.DRAG,this.dragData))}dragReal(){const{running:t}=this.interaction,e=this.realDragableList;if(e.length&&t){const{totalX:s,totalY:n}=this.dragData;e.forEach(r=>r.draggable&&r.move(W.getValidMove(r,this.dragStartPoints[r.innerId],{x:s,y:n})))}}dragOverOrOut(t){const{interaction:e}=this,{dragOverPath:s}=this,{path:n}=t;this.dragOverPath=n,s?n.indexAt(0)!==s.indexAt(0)&&(e.emit(W.OUT,t,s),e.emit(W.OVER,t,n)):e.emit(W.OVER,t,n)}dragEnterOrLeave(t){const{interaction:e}=this,{dragEnterPath:s}=this,{path:n}=t;e.emit(W.LEAVE,t,s,n),e.emit(W.ENTER,t,n,s),this.dragEnterPath=n}dragEnd(t,e){if(!this.dragging&&!this.moving)return;const{moveX:s,moveY:n}=this.dragData;this.interaction.config.move.dragAnimate&&this.canAnimate&&this.moving&&(Math.abs(s)>1||Math.abs(n)>1)?(t=Object.assign({},t),e=(e||(t.pointerType==="touch"?2:1))*.9,E.move(t,s*e,n*e),this.drag(t),this.animate(()=>{this.dragEnd(t,1)})):this.dragEndReal(t)}dragEndReal(t){const{interaction:e,downData:s,dragData:n}=this;t||(t=n);const{path:r,throughPath:o}=s,a=Pn(s,t,t);if(o&&(a.throughPath=o),a.path=r,this.moving&&(this.moving=!1,a.moveType="drag",e.emit(pt.END,a)),this.dragging){const h=this.getList();this.dragging=!1,e.emit(W.END,a),this.swipe(t,s,n,a),this.drop(t,h,this.dragEnterPath)}this.autoMoveCancel(),this.dragReset(),this.animate(null,"off")}animate(t,e){const s=t||this.animateWait;s&&this.interaction.target.nextRender(s,null,e),this.animateWait=t}swipe(t,e,s,n){const{interaction:r}=this;if(E.getDistance(e,t)>r.config.pointer.swipeDistance){const o=Rf(e,s,n);this.interaction.emit(o.type,o)}}drop(t,e,s){const n=bf(t,e,W.data);n.path=s,this.interaction.emit(Ni.DROP,n),this.interaction.emit(W.LEAVE,t,s)}dragReset(){W.list=W.data=this.dragableList=this.dragData=this.downData=this.dragOverPath=this.dragEnterPath=null}checkDragOut(t){const{interaction:e}=this;this.autoMoveCancel(),this.dragging&&!e.shrinkCanvasBounds.hitPoint(t)&&this.autoMoveOnDragOut(t)}autoMoveOnDragOut(t){const{interaction:e,downData:s,canDragOut:n}=this,{autoDistance:r,dragOut:o}=e.config.move;if(!o||!n||!r)return;const a=e.shrinkCanvasBounds,{x:h,y:l}=a,c=S.maxX(a),p=S.maxY(a),_=t.x<h?r:c<t.x?-r:0,u=t.y<l?r:p<t.y?-r:0;let f=0,g=0;this.autoMoveTimer=setInterval(()=>{f+=_,g+=u,E.move(s,_,u),E.move(this.dragData,_,u),e.move(Object.assign(Object.assign({},t),{moveX:_,moveY:u,totalX:f,totalY:g,moveType:"drag"})),e.pointerMoveReal(t)},10)}autoMoveCancel(){this.autoMoveTimer&&(clearInterval(this.autoMoveTimer),this.autoMoveTimer=0)}destroy(){this.dragReset()}}const Bf=F.get("emit");function Sf(i,t,e,s){if(!e&&!t.path)return;let n;t.type=i,e?t=Object.assign(Object.assign({},t),{path:e}):e=t.path,t.target=e.indexAt(0);try{for(let r=e.length-1;r>-1;r--){if(n=e.list[r],ar(n,i,t,!0,s))return;n.isApp&&Qo(n,i,t,!0,s)}for(let r=0,o=e.length;r<o;r++)if(n=e.list[r],n.isApp&&Qo(n,i,t,!1,s),ar(n,i,t,!1,s))return}catch(r){Bf.error(r)}}const Cf=["move","zoom","rotate","key"];function Qo(i,t,e,s,n){if(Cf.some(r=>t.startsWith(r))&&i.__.hitChildren&&!wh(i,n)){let r;for(let o=0,a=i.children.length;o<a;o++)r=i.children[o],!e.path.has(r)&&r.__.hittable&&ar(r,t,e,s,n)}}function ar(i,t,e,s,n){if(i.destroyed)return!1;if(i.__.hitSelf&&!wh(i,n)&&(ut.updateEventStyle&&ut.updateEventStyle(i,t),i.hasEvent(t,s))){e.phase=s?1:i===e.target?2:3;const r=fi.get(t,e);if(i.emitEvent(r,s),r.isStop)return!0}return!1}function wh(i,t){return t&&t.has(i)}const Ef={getData(i){const t=i[0],e=i[1],s=E.getCenter(t.from,e.from),n=E.getCenter(t.to,e.to),r={x:n.x-s.x,y:n.y-s.y},o=E.getDistance(t.from,e.from),h=E.getDistance(t.to,e.to)/o,l=E.getRotation(t.from,e.from,t.to,e.to);return{move:r,scale:h,angle:l,center:n}}},Tf={wheel:{zoomSpeed:.5,moveSpeed:.5,rotateSpeed:.5,delta:{x:80/4,y:8},preventDefault:!0},pointer:{hitRadius:5,tapTime:120,longPressTime:800,transformTime:500,hover:!0,dragHover:!0,dragDistance:2,swipeDistance:20,preventDefaultMenu:!0},cursor:!0,keyEvent:!0},{pathHasEventType:On,getMoveEventData:Pf,getZoomEventData:Of,getRotateEventData:Lf}=Nt;class Mf{get dragging(){return this.dragger.dragging}get transforming(){return this.transformer.transforming}get moveMode(){return this.config.move.drag||this.isHoldSpaceKey||this.isHoldMiddleKey||this.isHoldRightKey&&this.dragger.moving||this.isDragEmpty}get canHover(){return this.config.pointer.hover&&!this.config.mobile}get isDragEmpty(){return this.config.move.dragEmpty&&this.isRootPath(this.hoverData)&&(!this.downData||this.isRootPath(this.downData))}get isMobileDragEmpty(){return this.config.move.dragEmpty&&!this.canHover&&this.downData&&this.isTreePath(this.downData)}get isHoldMiddleKey(){return this.config.move.holdMiddleKey&&this.downData&&Wt.middle(this.downData)}get isHoldRightKey(){return this.config.move.holdRightKey&&this.downData&&Wt.right(this.downData)}get isHoldSpaceKey(){return this.config.move.holdSpaceKey&&Ii.isHoldSpaceKey()}get hitRadius(){return this.config.pointer.hitRadius}constructor(t,e,s,n){this.config=Tf,this.tapCount=0,this.downKeyMap={},this.target=t,this.canvas=e,this.selector=s,this.defaultPath=new it(t),this.transformer=new xf(this),this.dragger=new kf(this),n&&(this.config=at.default(n,this.config)),this.__listenEvents()}start(){this.running=!0}stop(){this.running=!1}receive(t){}pointerDown(t,e){t||(t=this.hoverData),t&&(Wt.defaultLeft(t),this.updateDownData(t),this.checkPath(t,e),this.downTime=Date.now(),this.emit(C.BEFORE_DOWN,t),this.emit(C.DOWN,t),Wt.left(t)&&(this.tapWait(),this.longPressWait(t)),this.waitMenuTap=Wt.right(t),this.dragger.setDragData(t),this.isHoldRightKey||this.updateCursor(t))}pointerMove(t){if(t||(t=this.hoverData),!t)return;const{downData:e}=this;e&&Wt.defaultLeft(t),(this.canvas.bounds.hitPoint(t)||e)&&(this.pointerMoveReal(t),e&&this.dragger.checkDragOut(t))}pointerMoveReal(t){const{dragHover:e,dragDistance:s}=this.config.pointer;if(this.emit(C.BEFORE_MOVE,t,this.defaultPath),this.downData){const n=E.getDistance(this.downData,t)>s;n&&(this.waitTap&&this.pointerWaitCancel(),this.waitMenuTap=!1),this.dragger.checkDrag(t,n)}this.dragger.moving||(this.updateHoverData(t),this.checkPath(t),this.emit(C.MOVE,t),this.dragging&&!e||this.pointerHover(t),this.dragger.dragging&&(this.dragger.dragOverOrOut(t),this.dragger.dragEnterOrLeave(t))),this.updateCursor(this.downData||t)}pointerUp(t){const{downData:e}=this;if(t||(t=e),!e)return;Wt.defaultLeft(t),t.multiTouch=e.multiTouch,this.findPath(t);const s=Object.assign(Object.assign({},t),{path:t.path.clone()});t.path.addList(e.path.list),this.checkPath(t),this.downData=null,this.emit(C.BEFORE_UP,t),this.emit(C.UP,t),this.touchLeave(t),t.isCancel||(this.tap(t),this.menuTap(t)),this.dragger.dragEnd(t),this.updateCursor(s)}pointerCancel(){const t=Object.assign({},this.dragger.dragData);t.isCancel=!0,this.pointerUp(t)}multiTouch(t,e){const{move:s,angle:n,scale:r,center:o}=Ef.getData(e);this.rotate(Lf(o,n,t)),this.zoom(Of(o,r,t)),this.move(Pf(o,s,t))}menu(t){this.findPath(t),this.emit(C.MENU,t)}menuTap(t){this.waitMenuTap&&this.emit(C.MENU_TAP,t)}move(t){this.transformer.move(t)}zoom(t){this.transformer.zoom(t)}rotate(t){this.transformer.rotate(t)}transformEnd(){this.transformer.transformEnd()}keyDown(t){if(!this.config.keyEvent)return;const{code:e}=t;this.downKeyMap[e]||(this.downKeyMap[e]=!0,Ii.setDownCode(e),this.emit(Se.HOLD,t,this.defaultPath),this.moveMode&&(this.cancelHover(),this.updateCursor())),this.emit(Se.DOWN,t,this.defaultPath)}keyUp(t){if(!this.config.keyEvent)return;const{code:e}=t;this.downKeyMap[e]=!1,Ii.setUpCode(e),this.emit(Se.UP,t,this.defaultPath),this.cursor==="grab"&&this.updateCursor()}pointerHover(t){this.canHover&&(this.pointerOverOrOut(t),this.pointerEnterOrLeave(t))}pointerOverOrOut(t){const{path:e}=t,{overPath:s}=this;this.overPath=e,s?e.indexAt(0)!==s.indexAt(0)&&(this.emit(C.OUT,t,s),this.emit(C.OVER,t,e)):this.emit(C.OVER,t,e)}pointerEnterOrLeave(t){let{path:e}=t;this.downData&&!this.moveMode&&(e=e.clone(),this.downData.path.forEach(n=>e.add(n)));const{enterPath:s}=this;this.enterPath=e,this.emit(C.LEAVE,t,s,e),this.emit(C.ENTER,t,e,s)}touchLeave(t){t.pointerType==="touch"&&this.enterPath&&(this.emit(C.LEAVE,t),this.dragger.dragging&&this.emit(Ni.LEAVE,t))}tap(t){const{pointer:e}=this.config,s=this.longTap(t);if(!e.tapMore&&s||!this.waitTap)return;e.tapMore&&this.emitTap(t);const n=Date.now()-this.downTime,r=[C.DOUBLE_TAP,C.DOUBLE_CLICK].some(o=>On(t.path,o));n<e.tapTime+50&&r?(this.tapCount++,this.tapCount===2?(this.tapWaitCancel(),this.emitDoubleTap(t)):(clearTimeout(this.tapTimer),this.tapTimer=setTimeout(()=>{e.tapMore||(this.tapWaitCancel(),this.emitTap(t))},e.tapTime))):e.tapMore||(this.tapWaitCancel(),this.emitTap(t))}findPath(t,e){const{hitRadius:s,through:n}=this.config.pointer,{bottomList:r}=this,o=this.selector.getByPoint(t,s,Object.assign({bottomList:r,name:t.type},e||{through:n}));return o.throughPath&&(t.throughPath=o.throughPath),t.path=o.path,o.path}isRootPath(t){return t&&t.path.list[0].isLeafer}isTreePath(t){const e=this.target.app;return!e||!e.isApp?!1:e.editor&&!t.path.has(e.editor)&&t.path.has(e.tree)&&!t.target.syncEventer}checkPath(t,e){(e||this.canMove(t))&&(t.path=this.defaultPath)}canMove(t){return this.moveMode&&t&&t.path.list.every(e=>!e.isOutside)}isDrag(t){return this.dragger.getList().has(t)}isPress(t){return this.downData&&this.downData.path.has(t)}isHover(t){return this.enterPath&&this.enterPath.has(t)}isFocus(t){return this.focusData===t}cancelHover(){const{hoverData:t}=this;t&&(t.path=this.defaultPath,this.pointerHover(t))}updateDownData(t,e,s){const{downData:n}=this;!t&&n&&(t=n),t&&(this.findPath(t,e),s&&n&&t.path.addList(n.path.list),this.downData=t)}updateHoverData(t){t||(t=this.hoverData),t&&(this.findPath(t,{exclude:this.dragger.getList(),name:C.MOVE}),this.hoverData=t)}updateCursor(t){if(!this.config.cursor||!this.canHover)return;if(t||(this.updateHoverData(),t=this.downData||this.hoverData),this.dragger.moving)return this.setCursor("grabbing");if(this.canMove(t))return this.setCursor(this.downData?"grabbing":"grab");if(!t)return;let e,s;const{path:n}=t;for(let r=0,o=n.length;r<o&&(e=n.list[r],s=e.syncEventer?e.syncEventer.cursor:e.cursor,!s);r++);this.setCursor(s)}setCursor(t){this.cursor=t}getLocal(t,e){const s=this.canvas.getClientBounds(e);return{x:t.clientX-s.x,y:t.clientY-s.y}}emitTap(t){this.emit(C.TAP,t),this.emit(C.CLICK,t)}emitDoubleTap(t){this.emit(C.DOUBLE_TAP,t),this.emit(C.DOUBLE_CLICK,t)}pointerWaitCancel(){this.tapWaitCancel(),this.longPressWaitCancel()}tapWait(){clearTimeout(this.tapTimer),this.waitTap=!0}tapWaitCancel(){clearTimeout(this.tapTimer),this.waitTap=!1,this.tapCount=0}longPressWait(t){clearTimeout(this.longPressTimer),this.longPressTimer=setTimeout(()=>{this.longPressed=!0,this.emit(C.LONG_PRESS,t)},this.config.pointer.longPressTime)}longTap(t){let e;return this.longPressed&&(this.emit(C.LONG_TAP,t),(On(t.path,C.LONG_TAP)||On(t.path,C.LONG_PRESS))&&(e=!0)),this.longPressWaitCancel(),e}longPressWaitCancel(){clearTimeout(this.longPressTimer),this.longPressed=!1}__onResize(){this.shrinkCanvasBounds=new Z(this.canvas.bounds),this.shrinkCanvasBounds.spread(-2)}__listenEvents(){const{target:t}=this;this.__eventIds=[t.on_(qe.RESIZE,this.__onResize,this)],t.once(tt.READY,()=>this.__onResize())}__removeListenEvents(){this.target.off_(this.__eventIds),this.__eventIds.length=0}emit(t,e,s,n){this.running&&Sf(t,e,s,n)}destroy(){this.__eventIds.length&&(this.stop(),this.__removeListenEvents(),this.dragger.destroy(),this.transformer.destroy(),this.downData=this.overPath=this.enterPath=null)}}class xh{static set(t,e){this.custom[t]=e}static get(t){return this.custom[t]}}xh.custom={};class Af extends Xa{constructor(){super(...arguments),this.maxTotal=1e3,this.pathList=new it,this.pixelList=new it}getPixelType(t,e){return this.__autoClear(),this.pixelList.add(t),nt.hitCanvas(e)}getPathType(t){return this.__autoClear(),this.pathList.add(t),nt.hitCanvas()}clearImageType(){this.__clearLeafList(this.pixelList)}clearPathType(){this.__clearLeafList(this.pathList)}__clearLeafList(t){t.length&&(t.forEach(e=>{e.__hitCanvas&&(e.__hitCanvas.destroy(),e.__hitCanvas=null)}),t.reset())}__autoClear(){this.pathList.length+this.pixelList.length>this.maxTotal&&this.clear()}clear(){this.clearPathType(),this.clearImageType()}}const{toInnerRadiusPointOf:Df,copy:If,setRadius:Wf}=E,Ti={},Qi=Ue.prototype;Qi.__hitWorld=function(i){if(!this.__.hitSelf)return!1;this.__.hitRadius&&(If(Ti,i),i=Ti,Wf(i,this.__.hitRadius)),Df(i,this.__world,Ti);const{width:t,height:e}=this.__world,s=t<10&&e<10;if(this.__.hitBox||s){if(S.hitRadiusPoint(this.__layout.boxBounds,Ti))return!0;if(s)return!1}return(this.__layout.hitCanvasChanged||!this.__hitCanvas)&&(this.__updateHitCanvas(),this.__layout.boundsChanged||(this.__layout.hitCanvasChanged=!1)),this.__hit(Ti)};Qi.__hitFill=function(i){var t;return(t=this.__hitCanvas)===null||t===void 0?void 0:t.hitFill(i,this.__.windingRule)};Qi.__hitStroke=function(i,t){var e;return(e=this.__hitCanvas)===null||e===void 0?void 0:e.hitStroke(i,t)};Qi.__hitPixel=function(i){var t;return(t=this.__hitCanvas)===null||t===void 0?void 0:t.hitPixel(i,this.__layout.renderBounds,this.__hitCanvas.hitScale)};Qi.__drawHitPath=function(i){i&&this.__drawRenderPath(i)};const $f=new Ce,vh=y.prototype;vh.__updateHitCanvas=function(){const i=this.__,{hitCanvasManager:t}=this.leafer,e=(i.__pixelFill||i.__isCanvas)&&i.hitFill==="pixel",s=i.__pixelStroke&&i.hitStroke==="pixel",n=e||s;this.__hitCanvas||(this.__hitCanvas=n?t.getPixelType(this,{contextSettings:{willReadFrequently:!0}}):t.getPathType(this));const r=this.__hitCanvas;if(n){const{renderBounds:o}=this.__layout,a=b.image.hitCanvasSize,h=r.hitScale=I.set(0,0,a,a).getFitMatrix(o,.5).a,{x:l,y:c,width:p,height:_}=I.set(o).scale(h);r.resize({width:p,height:_,pixelRatio:1}),r.clear(),xt.patternLocked=!0,this.__renderShape(r,{matrix:$f.setWith(this.__world).scaleWith(1/h).invertWith().translate(-l,-c)},!e,!s),xt.patternLocked=!1,r.resetTransform(),i.__isHitPixel=!0}else i.__isHitPixel&&(i.__isHitPixel=!1);this.__drawHitPath(r),r.setStrokeOptions(i)};vh.__hit=function(i){b.name==="miniapp"&&this.__drawHitPath(this.__hitCanvas);const t=this.__;if(t.__isHitPixel&&this.__hitPixel(i))return!0;const{hitFill:e}=t,s=(t.fill||t.__isCanvas)&&(e==="path"||e==="pixel"&&!(t.__pixelFill||t.__isCanvas))||e==="all";if(s&&this.__hitFill(i))return!0;const{hitStroke:n,__strokeWidth:r}=t,o=t.stroke&&(n==="path"||n==="pixel"&&!t.__pixelStroke)||n==="all";if(!s&&!o)return!1;const a=i.radiusX*2;let h=a;if(o)switch(t.strokeAlign){case"inside":if(h+=r*2,!s&&this.__hitFill(i)&&this.__hitStroke(i,h))return!0;h=a;break;case"center":h+=r;break;case"outside":if(h+=r*2,!s){if(!this.__hitFill(i)&&this.__hitStroke(i,h))return!0;h=a}break}return h?this.__hitStroke(i,h):!1};const bh=new y,Rh=Ve.prototype;Rh.__updateHitCanvas=function(){this.stroke||this.cornerRadius||(this.fill||this.__.__isCanvas)&&this.hitFill==="pixel"||this.hitStroke==="all"?bh.__updateHitCanvas.call(this):this.__hitCanvas&&(this.__hitCanvas=null)};Rh.__hitFill=function(i){return this.__hitCanvas?bh.__hitFill.call(this,i):S.hitRadiusPoint(this.__layout.boxBounds,i)};const kh=y.prototype,Ff=Zt.prototype;kh.find=function(i,t){return this.leafer?this.leafer.selector.getBy(i,this,!1,t):[]};kh.findOne=function(i,t){return this.leafer?this.leafer.selector.getBy(i,this,!0,t):null};Ff.pick=function(i,t){return this.__layout.update(),t||(t={}),this.leafer?this.leafer.selector.getByPoint(i,t.hitRadius||0,Object.assign(Object.assign({},t),{target:this})):null};const Cr=xr.prototype;Cr.hitFill=function(i,t){return t?this.context.isPointInPath(i.x,i.y,t):this.context.isPointInPath(i.x,i.y)};Cr.hitStroke=function(i,t){return this.strokeWidth=t,this.context.isPointInStroke(i.x,i.y)};Cr.hitPixel=function(i,t,e=1){let{x:s,y:n,radiusX:r,radiusY:o}=i;t&&(s-=t.x,n-=t.y),I.set(s-r,n-o,r*2,o*2).scale(e).ceil();const{data:a}=this.context.getImageData(I.x,I.y,I.width||1,I.height||1);for(let h=0,l=a.length;h<l;h+=4)if(a[h+3]>0)return!0;return a[3]>0};const Jo=F.get("LeaferCanvas");class Bh extends xr{set zIndex(t){const{style:e}=this.view;e.zIndex=t,this.setAbsolute(this.view)}set childIndex(t){const{view:e,parentView:s}=this;if(e&&s){const n=s.children[t];n?(this.setAbsolute(n),s.insertBefore(e,n)):s.appendChild(n)}}init(){const{config:t}=this,e=t.view||t.canvas;e?this.__createViewFrom(e):this.__createView();const{style:s}=this.view;if(s.display||(s.display="block"),this.parentView=this.view.parentElement,this.parentView){const n=this.parentView.style;n.webkitUserSelect=n.userSelect="none"}b.syncDomFont&&!this.parentView&&(s.display="none",document.body.appendChild(this.view)),this.__createContext(),this.autoLayout||this.resize(t)}set backgroundColor(t){this.view.style.backgroundColor=t}get backgroundColor(){return this.view.style.backgroundColor}set hittable(t){this.view.style.pointerEvents=t?"auto":"none"}get hittable(){return this.view.style.pointerEvents!=="none"}__createView(){this.view=document.createElement("canvas")}__createViewFrom(t){let e=typeof t=="string"?document.getElementById(t):t;if(e)if(e instanceof HTMLCanvasElement)this.view=e;else{let s=e;if(e===window||e===document){const r=document.createElement("div"),{style:o}=r;o.position="absolute",o.top=o.bottom=o.left=o.right="0px",document.body.appendChild(r),s=r}this.__createView();const n=this.view;s.hasChildNodes()&&(this.setAbsolute(n),s.style.position||(s.style.position="relative")),s.appendChild(n)}else Jo.error(`no id: ${t}`),this.__createView()}setAbsolute(t){const{style:e}=t;e.position="absolute",e.top=e.left="0px"}updateViewSize(){const{width:t,height:e,pixelRatio:s}=this,{style:n}=this.view;n.width=t+"px",n.height=e+"px",this.view.width=Math.ceil(t*s),this.view.height=Math.ceil(e*s)}updateClientBounds(){this.clientBounds=this.view.getBoundingClientRect()}startAutoLayout(t,e){if(this.resizeListener=e,t){this.autoBounds=t;try{this.resizeObserver=new ResizeObserver(n=>{this.updateClientBounds();for(const r of n)this.checkAutoBounds(r.contentRect)});const s=this.parentView;s?(this.resizeObserver.observe(s),this.checkAutoBounds(s.getBoundingClientRect())):(this.checkAutoBounds(this.view),Jo.warn("no parent"))}catch{this.imitateResizeObserver()}}else window.addEventListener("resize",()=>{const s=b.devicePixelRatio;if(this.pixelRatio!==s){const{width:n,height:r}=this;this.emitResize({width:n,height:r,pixelRatio:s})}})}imitateResizeObserver(){this.autoLayout&&(this.parentView&&this.checkAutoBounds(this.parentView.getBoundingClientRect()),b.requestRender(this.imitateResizeObserver.bind(this)))}checkAutoBounds(t){const e=this.view,{x:s,y:n,width:r,height:o}=this.autoBounds.getBoundsFrom(t),a={width:r,height:o,pixelRatio:b.devicePixelRatio};if(!this.isSameSize(a)){const{style:h}=e;h.marginLeft=s+"px",h.marginTop=n+"px",this.emitResize(a)}}stopAutoLayout(){this.autoLayout=!1,this.resizeListener=null,this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null)}emitResize(t){const e={};at.copyAttrs(e,this,ue),this.resize(t),this.width!==void 0&&this.resizeListener(new qe(t,e))}unrealCanvas(){if(!this.unreal&&this.parentView){const t=this.view;t&&t.remove(),this.view=this.parentView,this.unreal=!0}}destroy(){if(this.view){if(this.stopAutoLayout(),!this.unreal){const t=this.view;t.parentElement&&t.remove()}super.destroy()}}}nh(CanvasRenderingContext2D.prototype);nh(Path2D.prototype);const{mineType:Ln,fileType:zf}=fe;Object.assign(nt,{canvas:(i,t)=>new Bh(i,t),image:i=>new _u(i)});function Hf(i,t){b.origin={createCanvas(e,s){const n=document.createElement("canvas");return n.width=e,n.height=s,n},canvasToDataURL:(e,s,n)=>e.toDataURL(Ln(s),n),canvasToBolb:(e,s,n)=>new Promise(r=>e.toBlob(r,Ln(s),n)),canvasSaveAs:(e,s,n)=>{const r=e.toDataURL(Ln(zf(s)),n);return b.origin.download(r,s)},download(e,s){return new Promise(n=>{let r=document.createElement("a");r.href=e,r.download=s,document.body.appendChild(r),r.click(),document.body.removeChild(r),n()})},loadImage(e){return new Promise((s,n)=>{const r=new Image,{crossOrigin:o}=b.image;o&&(r.setAttribute("crossOrigin",o),r.crossOrigin=o),r.onload=()=>{s(r)},r.onerror=a=>{n(a)},r.src=b.image.getRealURL(e)})}},b.event={stopDefault(e){e.preventDefault()},stopNow(e){e.stopImmediatePropagation()},stop(e){e.stopPropagation()}},b.canvas=nt.canvas(),b.conicGradientSupport=!!b.canvas.context.createConicGradient}b.name="web";b.isMobile="ontouchstart"in window;b.requestRender=function(i){window.requestAnimationFrame(i)};mi(b,"devicePixelRatio",{get(){return Math.max(1,devicePixelRatio)}});const{userAgent:ci}=navigator;ci.indexOf("Firefox")>-1?(b.conicGradientRotate90=!0,b.intWheelDeltaY=!0,b.syncDomFont=!0):ci.indexOf("Safari")>-1&&ci.indexOf("Chrome")===-1&&(b.fullImageShadow=!0);ci.indexOf("Windows")>-1?(b.os="Windows",b.intWheelDeltaY=!0):ci.indexOf("Mac")>-1?b.os="Mac":ci.indexOf("Linux")>-1&&(b.os="Linux");class Nf{get childrenChanged(){return this.hasAdd||this.hasRemove||this.hasVisible}get updatedList(){if(this.hasRemove){const t=new it;return this.__updatedList.list.forEach(e=>{e.leafer&&t.add(e)}),t}else return this.__updatedList}constructor(t,e){this.totalTimes=0,this.config={},this.__updatedList=new it,this.target=t,e&&(this.config=at.default(e,this.config)),this.__listenEvents()}start(){this.disabled||(this.running=!0)}stop(){this.running=!1}disable(){this.stop(),this.__removeListenEvents(),this.disabled=!0}update(){this.changed=!0,this.running&&this.target.emit(G.REQUEST)}__onAttrChange(t){this.__updatedList.add(t.target),this.update()}__onChildEvent(t){t.type===kt.ADD?(this.hasAdd=!0,this.__pushChild(t.child)):(this.hasRemove=!0,this.__updatedList.add(t.parent)),this.update()}__pushChild(t){this.__updatedList.add(t),t.isBranch&&this.__loopChildren(t)}__loopChildren(t){const{children:e}=t;for(let s=0,n=e.length;s<n;s++)this.__pushChild(e[s])}__onRquestData(){this.target.emitEvent(new Be(Be.DATA,{updatedList:this.updatedList})),this.__updatedList=new it,this.totalTimes++,this.changed=!1,this.hasVisible=!1,this.hasRemove=!1,this.hasAdd=!1}__listenEvents(){const{target:t}=this;this.__eventIds=[t.on_(de.CHANGE,this.__onAttrChange,this),t.on_([kt.ADD,kt.REMOVE],this.__onChildEvent,this),t.on_(Be.REQUEST,this.__onRquestData,this)]}__removeListenEvents(){this.target.off_(this.__eventIds)}destroy(){this.target&&(this.stop(),this.__removeListenEvents(),this.target=null,this.__updatedList=null)}}const{updateAllMatrix:jf,updateBounds:ta,updateAllWorldOpacity:Gf}=te,{pushAllChildBranch:Uf,pushAllParent:ea}=Ki;function Yf(i,t){let e;i.list.forEach(s=>{e=s.__layout,t.without(s)&&!e.proxyZoom&&(e.matrixChanged?(jf(s,!0),t.add(s),s.isBranch&&Uf(s,t),ea(s,t)):e.boundsChanged&&(t.add(s),s.isBranch&&(s.__tempNumber=0),ea(s,t)))})}function Vf(i){let t,e,s;i.sort(!0),i.levels.forEach(n=>{t=i.levelMap[n];for(let r=0,o=t.length;r<o;r++){if(e=t[r],e.isBranch&&e.__tempNumber){s=e.children;for(let a=0,h=s.length;a<h;a++)s[a].isBranch||ta(s[a])}ta(e)}})}function Xf(i){i.list.forEach(t=>{t.__layout.opacityChanged&&Gf(t),t.__updateChange()})}const{worldBounds:ia}=zs,Kf={x:0,y:0,width:1e5,height:1e5};class sa{constructor(t){this.updatedBounds=new Z,this.beforeBounds=new Z,this.afterBounds=new Z,t instanceof Array&&(t=new it(t)),this.updatedList=t}setBefore(){this.beforeBounds.setListWithFn(this.updatedList.list,ia)}setAfter(){const{list:t}=this.updatedList;t.some(e=>e.noBounds)?this.afterBounds.set(Kf):this.afterBounds.setListWithFn(t,ia),this.updatedBounds.setList([this.beforeBounds,this.afterBounds])}merge(t){this.updatedList.addList(t.updatedList.list),this.beforeBounds.add(t.beforeBounds),this.afterBounds.add(t.afterBounds),this.updatedBounds.add(t.updatedBounds)}destroy(){this.updatedList=null}}const{updateAllMatrix:qf,updateAllChange:Zf}=te,Mn=F.get("Layouter");class Gs{constructor(t,e){this.totalTimes=0,this.config={},this.__levelList=new Cd,this.target=t,e&&(this.config=at.default(e,this.config)),this.__listenEvents()}start(){this.disabled||(this.running=!0)}stop(){this.running=!1}disable(){this.stop(),this.__removeListenEvents(),this.disabled=!0}layout(){if(!this.running)return;const{target:t}=this;this.times=0;try{t.emit(H.START),this.layoutOnce(),t.emitEvent(new H(H.END,this.layoutedBlocks,this.times))}catch(e){Mn.error(e)}this.layoutedBlocks=null}layoutAgain(){this.layouting?this.waitAgain=!0:this.layoutOnce()}layoutOnce(){if(this.layouting)return Mn.warn("layouting");if(this.times>3)return Mn.warn("layout max times");this.times++,this.totalTimes++,this.layouting=!0,this.target.emit(Be.REQUEST),this.totalTimes>1?this.partLayout():this.fullLayout(),this.layouting=!1,this.waitAgain&&(this.waitAgain=!1,this.layoutOnce())}partLayout(){var t;if(!(!((t=this.__updatedList)===null||t===void 0)&&t.length))return;const e=Ft.start("PartLayout"),{target:s,__updatedList:n}=this,{BEFORE:r,LAYOUT:o,AFTER:a}=H,h=this.getBlocks(n);h.forEach(l=>l.setBefore()),s.emitEvent(new H(r,h,this.times)),this.extraBlock=null,n.sort(),Yf(n,this.__levelList),Vf(this.__levelList),Xf(n),this.extraBlock&&h.push(this.extraBlock),h.forEach(l=>l.setAfter()),s.emitEvent(new H(o,h,this.times)),s.emitEvent(new H(a,h,this.times)),this.addBlocks(h),this.__levelList.reset(),this.__updatedList=null,Ft.end(e)}fullLayout(){const t=Ft.start("FullLayout"),{target:e}=this,{BEFORE:s,LAYOUT:n,AFTER:r}=H,o=this.getBlocks(new it(e));e.emitEvent(new H(s,o,this.times)),Gs.fullLayout(e),o.forEach(a=>{a.setAfter()}),e.emitEvent(new H(n,o,this.times)),e.emitEvent(new H(r,o,this.times)),this.addBlocks(o),Ft.end(t)}static fullLayout(t){qf(t,!0),t.isBranch?Ki.updateBounds(t):te.updateBounds(t),Zf(t)}addExtra(t){if(!this.__updatedList.has(t)){const{updatedList:e,beforeBounds:s}=this.extraBlock||(this.extraBlock=new sa([]));e.length?s.add(t.__world):s.set(t.__world),e.add(t)}}createBlock(t){return new sa(t)}getBlocks(t){return[this.createBlock(t)]}addBlocks(t){this.layoutedBlocks?this.layoutedBlocks.push(...t):this.layoutedBlocks=t}__onReceiveWatchData(t){this.__updatedList=t.data.updatedList}__listenEvents(){const{target:t}=this;this.__eventIds=[t.on_(H.REQUEST,this.layout,this),t.on_(H.AGAIN,this.layoutAgain,this),t.on_(Be.DATA,this.__onReceiveWatchData,this)]}__removeListenEvents(){this.target.off_(this.__eventIds)}destroy(){this.target&&(this.stop(),this.__removeListenEvents(),this.target=this.config=null)}}const We=F.get("Renderer");class Qf{get needFill(){return!!(!this.canvas.allowBackgroundColor&&this.config.fill)}constructor(t,e,s){this.FPS=60,this.totalTimes=0,this.times=0,this.config={usePartRender:!0,maxFPS:60},this.target=t,this.canvas=e,s&&(this.config=at.default(s,this.config)),this.__listenEvents(),this.__requestRender()}start(){this.running=!0}stop(){this.running=!1}update(){this.changed=!0}requestLayout(){this.target.emit(H.REQUEST)}render(t){if(!(this.running&&this.canvas.view)){this.changed=!0;return}const{target:e}=this;this.times=0,this.totalBounds=new Z,We.log(e.innerName,"--->");try{this.emitRender(G.START),this.renderOnce(t),this.emitRender(G.END,this.totalBounds),xt.clearRecycled()}catch(s){this.rendering=!1,We.error(s)}We.log("-------------|")}renderAgain(){this.rendering?this.waitAgain=!0:this.renderOnce()}renderOnce(t){if(this.rendering)return We.warn("rendering");if(this.times>3)return We.warn("render max times");if(this.times++,this.totalTimes++,this.rendering=!0,this.changed=!1,this.renderBounds=new Z,this.renderOptions={},t)this.emitRender(G.BEFORE),t();else{if(this.requestLayout(),this.ignore){this.ignore=this.rendering=!1;return}this.emitRender(G.BEFORE),this.config.usePartRender&&this.totalTimes>1?this.partRender():this.fullRender()}this.emitRender(G.RENDER,this.renderBounds,this.renderOptions),this.emitRender(G.AFTER,this.renderBounds,this.renderOptions),this.updateBlocks=null,this.rendering=!1,this.waitAgain&&(this.waitAgain=!1,this.renderOnce())}partRender(){const{canvas:t,updateBlocks:e}=this;if(!e)return We.warn("PartRender: need update attr");this.mergeBlocks(),e.forEach(s=>{t.bounds.hit(s)&&!s.isEmpty()&&this.clipRender(s)})}clipRender(t){const e=Ft.start("PartRender"),{canvas:s}=this,n=t.getIntersect(s.bounds),r=t.includes(this.target.__world),o=new Z(n);s.save(),r&&!F.showRepaint?s.clear():(n.spread(10+1/this.canvas.pixelRatio).ceil(),s.clearWorld(n,!0),s.clipWorld(n,!0)),this.__render(n,r,o),s.restore(),Ft.end(e)}fullRender(){const t=Ft.start("FullRender"),{canvas:e}=this;e.save(),e.clear(),this.__render(e.bounds,!0),e.restore(),Ft.end(t)}__render(t,e,s){const n=t.includes(this.target.__world)?{includes:e}:{bounds:t,includes:e};this.needFill&&this.canvas.fillWorld(t,this.config.fill),F.showRepaint&&this.canvas.strokeWorld(t,"red"),this.target.__render(this.canvas,n),this.renderBounds=s=s||t,this.renderOptions=n,this.totalBounds.isEmpty()?this.totalBounds=s:this.totalBounds.add(s),F.showHitView&&this.renderHitView(n),F.showBoundsView&&this.renderBoundsView(n),this.canvas.updateRender(s)}renderHitView(t){}renderBoundsView(t){}addBlock(t){this.updateBlocks||(this.updateBlocks=[]),this.updateBlocks.push(t)}mergeBlocks(){const{updateBlocks:t}=this;if(t){const e=new Z;e.setList(t),t.length=0,t.push(e)}}__requestRender(){const t=Date.now();b.requestRender(()=>{this.FPS=Math.min(60,Math.ceil(1e3/(Date.now()-t))),this.running&&(this.target.emit(uh.FRAME),this.changed&&this.canvas.view&&this.render(),this.target.emit(G.NEXT)),this.target&&this.__requestRender()})}__onResize(t){if(!this.canvas.unreal){if(t.bigger||!t.samePixelRatio){const{width:e,height:s}=t.old;if(!new Z(0,0,e,s).includes(this.target.__world)||this.needFill||!t.samePixelRatio){this.addBlock(this.canvas.bounds),this.target.forceUpdate("surface");return}}this.addBlock(new Z(0,0,1,1)),this.changed=!0}}__onLayoutEnd(t){t.data&&t.data.map(e=>{let s;e.updatedList&&e.updatedList.list.some(n=>(s=!n.__world.width||!n.__world.height,s&&(n.isLeafer||We.tip(n.innerName,": empty"),s=!n.isBranch||n.isBranchLeaf),s)),this.addBlock(s?this.canvas.bounds:e.updatedBounds)})}emitRender(t,e,s){this.target.emitEvent(new G(t,this.times,e,s))}__listenEvents(){const{target:t}=this;this.__eventIds=[t.on_(G.REQUEST,this.update,this),t.on_(H.END,this.__onLayoutEnd,this),t.on_(G.AGAIN,this.renderAgain,this),t.on_(qe.RESIZE,this.__onResize,this)]}__removeListenEvents(){this.target.off_(this.__eventIds)}destroy(){this.target&&(this.stop(),this.__removeListenEvents(),this.target=this.canvas=this.config=null)}}const{hitRadiusPoint:Jf}=S;class t_{constructor(t,e){this.target=t,this.selector=e}getByPoint(t,e,s){e||(e=0),s||(s={});const n=s.through||!1,r=s.ignoreHittable||!1,o=s.target||this.target;this.exclude=s.exclude||null,this.point={x:t.x,y:t.y,radiusX:e,radiusY:e},this.findList=new it(s.findList),s.findList||this.hitBranch(o);const{list:a}=this.findList,h=this.getBestMatchLeaf(a,s.bottomList,r),l=r?this.getPath(h):this.getHitablePath(h);return this.clear(),n?{path:l,target:h,throughPath:a.length?this.getThroughPath(a):l}:{path:l,target:h}}getBestMatchLeaf(t,e,s){if(t.length){let n;this.findList=new it;const{x:r,y:o}=this.point,a={x:r,y:o,radiusX:0,radiusY:0};for(let h=0,l=t.length;h<l;h++)if(n=t[h],(s||te.worldHittable(n))&&(this.hitChild(n,a),this.findList.length))return this.findList.list[0]}if(e){for(let n=0,r=e.length;n<r;n++)if(this.hitChild(e[n].target,this.point,e[n].proxy),this.findList.length)return this.findList.list[0]}return t[0]}getPath(t){const e=new it;for(;t;)e.add(t),t=t.parent;return e.add(this.target),e}getHitablePath(t){const e=this.getPath(t&&t.hittable?t:null);let s,n=new it;for(let r=e.list.length-1;r>-1&&(s=e.list[r],!(!s.__.hittable||(n.addAt(s,0),!s.__.hitChildren)));r--);return n}getThroughPath(t){const e=new it,s=[];for(let a=t.length-1;a>-1;a--)s.push(this.getPath(t[a]));let n,r,o;for(let a=0,h=s.length;a<h;a++){n=s[a],r=s[a+1];for(let l=0,c=n.length;l<c&&(o=n.list[l],!(r&&r.has(o)));l++)e.add(o)}return e}hitBranch(t){this.eachFind(t.children,t.__onlyHitMask)}eachFind(t,e){let s,n;const{point:r}=this,o=t.length;for(let a=o-1;a>-1;a--)s=t[a],!(!s.__.visible||e&&!s.__.mask)&&(n=s.__.hitRadius?!0:Jf(s.__world,r),s.isBranch?(n||s.__ignoreHitWorld)&&(this.eachFind(s.children,s.__onlyHitMask),s.isBranchLeaf&&!this.findList.length&&this.hitChild(s,r)):n&&this.hitChild(s,r))}hitChild(t,e,s){if(!(this.exclude&&this.exclude.has(t))&&t.__hitWorld(e)){const{parent:n}=t;if(n&&n.__hasMask&&!t.__.mask&&!n.children.some(r=>r.__.mask&&r.__hitWorld(e)))return;this.findList.add(s||t)}}clear(){this.point=null,this.findList=null,this.exclude=null}destroy(){this.clear()}}const{Yes:e_,NoAndSkip:i_,YesAndSkip:s_}=er,na={},ra={},oa={};class n_{constructor(t,e){this.config={},this.innerIdMap={},this.idMap={},this.methods={id:(s,n)=>s.id===n?(this.idMap[n]=s,1):0,innerId:(s,n)=>s.innerId===n?(this.innerIdMap[n]=s,1):0,className:(s,n)=>s.className===n?1:0,tag:(s,n)=>s.__tag===n?1:0,tags:(s,n)=>n[s.__tag]?1:0},this.target=t,e&&(this.config=at.default(e,this.config)),this.picker=new t_(t,this),this.__listenEvents()}getBy(t,e,s,n){switch(typeof t){case"number":const r=this.getByInnerId(t,e);return s?r:r?[r]:[];case"string":switch(t[0]){case"#":na.id=t.substring(1),t=na;break;case".":ra.className=t.substring(1),t=ra;break;default:oa.tag=t,t=oa}case"object":if(t.id!==void 0){const o=this.getById(t.id,e);return s?o:o?[o]:[]}else if(t.tag){const{tag:o}=t,a=o instanceof Array;return this.getByMethod(a?this.methods.tags:this.methods.tag,e,s,a?at.toMap(o):o)}else return this.getByMethod(this.methods.className,e,s,t.className);case"function":return this.getByMethod(t,e,s,n)}}getByPoint(t,e,s){return b.name==="node"&&this.target.emit(H.CHECK_UPDATE),this.picker.getByPoint(t,e,s)}getByInnerId(t,e){const s=this.innerIdMap[t];return s||(this.eachFind(this.toChildren(e),this.methods.innerId,null,t),this.findLeaf)}getById(t,e){const s=this.idMap[t];return s&&te.hasParent(s,e||this.target)?s:(this.eachFind(this.toChildren(e),this.methods.id,null,t),this.findLeaf)}getByClassName(t,e){return this.getByMethod(this.methods.className,e,!1,t)}getByTag(t,e){return this.getByMethod(this.methods.tag,e,!1,t)}getByMethod(t,e,s,n){const r=s?null:[];return this.eachFind(this.toChildren(e),t,r,n),r||this.findLeaf}eachFind(t,e,s,n){let r,o;for(let a=0,h=t.length;a<h;a++){if(r=t[a],o=e(r,n),o===e_||o===s_)if(s)s.push(r);else{this.findLeaf=r;return}r.isBranch&&o<i_&&this.eachFind(r.children,e,s,n)}}toChildren(t){return this.findLeaf=null,[t||this.target]}__onRemoveChild(t){const{id:e,innerId:s}=t.child;this.idMap[e]&&delete this.idMap[e],this.innerIdMap[s]&&delete this.innerIdMap[s]}__checkIdChange(t){if(t.attrName==="id"){const e=t.oldValue;this.idMap[e]&&delete this.idMap[e]}}__listenEvents(){this.__eventIds=[this.target.on_(kt.REMOVE,this.__onRemoveChild,this),this.target.on_(de.CHANGE,this.__checkIdChange,this)]}__removeListenEvents(){this.target.off_(this.__eventIds),this.__eventIds.length=0}destroy(){this.__eventIds.length&&(this.__removeListenEvents(),this.picker.destroy(),this.findLeaf=null,this.innerIdMap={},this.idMap={})}}Object.assign(nt,{watcher:(i,t)=>new Nf(i,t),layouter:(i,t)=>new Gs(i,t),renderer:(i,t,e)=>new Qf(i,t,e),selector:(i,t)=>new n_(i,t)});b.layout=Gs.fullLayout;const mt={convert(i,t){const e=Nt.getBase(i),s=Object.assign(Object.assign({},e),{x:t.x,y:t.y,width:i.width,height:i.height,pointerType:i.pointerType,pressure:i.pressure});return s.pointerType==="pen"&&(s.tangentialPressure=i.tangentialPressure,s.tiltX=i.tiltX,s.tiltY=i.tiltY,s.twist=i.twist),s},convertMouse(i,t){const e=Nt.getBase(i);return Object.assign(Object.assign({},e),{x:t.x,y:t.y,width:1,height:1,pointerType:"mouse",pressure:.5})},convertTouch(i,t){const e=mt.getTouch(i),s=Nt.getBase(i);return Object.assign(Object.assign({},s),{x:t.x,y:t.y,width:1,height:1,pointerType:"touch",multiTouch:i.touches.length>1,pressure:e.force})},getTouch(i){return i.targetTouches[0]||i.changedTouches[0]}},aa={getMove(i,t){let{moveSpeed:e}=t,{deltaX:s,deltaY:n}=i;return i.shiftKey&&!s&&(s=n,n=0),s>50&&(s=Math.max(50,s/3)),n>50&&(n=Math.max(50,n/3)),{x:-s*e*2,y:-n*e*2}},getScale(i,t){let e,s=1,{zoomMode:n,zoomSpeed:r}=t;const o=i.deltaY||i.deltaX;if(n?(e=n==="mouse"?!0:!i.deltaX&&(b.intWheelDeltaY?Math.abs(o)>17:Math.ceil(o)!==o),(i.shiftKey||i.metaKey||i.ctrlKey)&&(e=!0)):e=!i.shiftKey&&(i.metaKey||i.ctrlKey),e){r=At.within(r,0,1);const a=i.deltaY?t.delta.y:t.delta.x;s=1-o/(a*4)*r,s<.5&&(s=.5),s>=1.5&&(s=1.5)}return s}},ha={convert(i){const t=Nt.getBase(i);return Object.assign(Object.assign({},t),{code:i.code,key:i.key})}},{getMoveEventData:r_,getZoomEventData:la,getRotateEventData:o_}=Nt;class a_ extends Mf{__listenEvents(){super.__listenEvents();const t=this.view=this.canvas.view;this.viewEvents={pointerdown:this.onPointerDown,mousedown:this.onMouseDown,touchstart:this.onTouchStart,contextmenu:this.onContextMenu,wheel:this.onWheel,gesturestart:this.onGesturestart,gesturechange:this.onGesturechange,gestureend:this.onGestureend},this.windowEvents={pointermove:this.onPointerMove,pointerup:this.onPointerUp,pointercancel:this.onPointerCancel,mousemove:this.onMouseMove,mouseup:this.onMouseUp,touchmove:this.onTouchMove,touchend:this.onTouchEnd,touchcancel:this.onTouchCancel,keydown:this.onKeyDown,keyup:this.onKeyUp,scroll:this.onScroll};const{viewEvents:e,windowEvents:s}=this;for(let n in e)e[n]=e[n].bind(this),t.addEventListener(n,e[n]);for(let n in s)s[n]=s[n].bind(this),window.addEventListener(n,s[n])}__removeListenEvents(){super.__removeListenEvents();const{viewEvents:t,windowEvents:e}=this;for(let s in t)this.view.removeEventListener(s,t[s]),this.viewEvents={};for(let s in e)window.removeEventListener(s,e[s]),this.windowEvents={}}getTouches(t){const e=[];for(let s=0,n=t.length;s<n;s++)e.push(t[s]);return e}preventDefaultPointer(t){const{pointer:e}=this.config;e.preventDefault&&t.preventDefault()}preventDefaultWheel(t){const{wheel:e}=this.config;e.preventDefault&&t.preventDefault()}preventWindowPointer(t){return!this.downData&&t.target!==this.view}onKeyDown(t){this.keyDown(ha.convert(t))}onKeyUp(t){this.keyUp(ha.convert(t))}onContextMenu(t){this.config.pointer.preventDefaultMenu&&t.preventDefault(),this.menu(mt.convert(t,this.getLocal(t)))}onScroll(){this.canvas.updateClientBounds()}onPointerDown(t){this.preventDefaultPointer(t),!(this.config.pointer.touch||this.useMultiTouch)&&(this.usePointer||(this.usePointer=!0),this.pointerDown(mt.convert(t,this.getLocal(t))))}onPointerMove(t){this.config.pointer.touch||this.useMultiTouch||this.preventWindowPointer(t)||(this.usePointer||(this.usePointer=!0),this.pointerMove(mt.convert(t,this.getLocal(t,!0))))}onPointerUp(t){this.downData&&this.preventDefaultPointer(t),!(this.config.pointer.touch||this.useMultiTouch||this.preventWindowPointer(t))&&this.pointerUp(mt.convert(t,this.getLocal(t)))}onPointerCancel(){this.useMultiTouch||this.pointerCancel()}onMouseDown(t){this.preventDefaultPointer(t),!(this.useTouch||this.usePointer)&&this.pointerDown(mt.convertMouse(t,this.getLocal(t)))}onMouseMove(t){this.useTouch||this.usePointer||this.preventWindowPointer(t)||this.pointerMove(mt.convertMouse(t,this.getLocal(t,!0)))}onMouseUp(t){this.downData&&this.preventDefaultPointer(t),!(this.useTouch||this.usePointer||this.preventWindowPointer(t))&&this.pointerUp(mt.convertMouse(t,this.getLocal(t)))}onMouseCancel(){this.useTouch||this.usePointer||this.pointerCancel()}onTouchStart(t){if(t.preventDefault(),this.multiTouchStart(t),this.usePointer)return;this.touchTimer&&(window.clearTimeout(this.touchTimer),this.touchTimer=0),this.useTouch=!0;const e=mt.getTouch(t);this.pointerDown(mt.convertTouch(t,this.getLocal(e,!0)))}onTouchMove(t){if(this.multiTouchMove(t),this.usePointer||this.preventWindowPointer(t))return;const e=mt.getTouch(t);this.pointerMove(mt.convertTouch(t,this.getLocal(e)))}onTouchEnd(t){if(this.multiTouchEnd(),this.usePointer||this.preventWindowPointer(t))return;this.touchTimer&&clearTimeout(this.touchTimer),this.touchTimer=setTimeout(()=>{this.useTouch=!1},500);const e=mt.getTouch(t);this.pointerUp(mt.convertTouch(t,this.getLocal(e)))}onTouchCancel(){this.usePointer||this.pointerCancel()}multiTouchStart(t){this.useMultiTouch=t.touches.length>1,this.touches=this.useMultiTouch?this.getTouches(t.touches):void 0,this.useMultiTouch&&this.pointerCancel()}multiTouchMove(t){if(this.useMultiTouch&&t.touches.length>1){const e=this.getTouches(t.touches),s=this.getKeepTouchList(this.touches,e);s.length>1&&(this.multiTouch(Nt.getBase(t),s),this.touches=e)}}multiTouchEnd(){this.touches=null,this.useMultiTouch=!1,this.transformEnd()}getKeepTouchList(t,e){let s;const n=[];return t.forEach(r=>{s=e.find(o=>o.identifier===r.identifier),s&&n.push({from:this.getLocal(r),to:this.getLocal(s)})}),n}getLocalTouchs(t){return t.map(e=>this.getLocal(e))}onWheel(t){this.preventDefaultWheel(t);const{wheel:e}=this.config;if(e.disabled)return;const s=e.getScale?e.getScale(t,e):aa.getScale(t,e),n=this.getLocal(t),r=Nt.getBase(t);s!==1?this.zoom(la(n,s,r)):this.move(r_(n,e.getMove?e.getMove(t,e):aa.getMove(t,e),r))}onGesturestart(t){this.useMultiTouch||(this.preventDefaultWheel(t),this.lastGestureScale=1,this.lastGestureRotation=0)}onGesturechange(t){if(this.useMultiTouch)return;this.preventDefaultWheel(t);const e=this.getLocal(t),s=Nt.getBase(t),n=t.scale/this.lastGestureScale,r=t.rotation-this.lastGestureRotation;let{rotateSpeed:o}=this.config.wheel;o=At.within(o,0,1),this.zoom(la(e,n*n,s)),this.rotate(o_(e,r/Math.PI*180*(o/4+.1),s)),this.lastGestureScale=t.scale,this.lastGestureRotation=t.rotation}onGestureend(t){this.useMultiTouch||(this.preventDefaultWheel(t),this.transformEnd())}setCursor(t){super.setCursor(t);const e=[];this.eachCursor(t,e),typeof e[e.length-1]=="object"&&e.push("default"),this.canvas.view.style.cursor=e.map(s=>typeof s=="object"?`url(${s.url}) ${s.x||0} ${s.y||0}`:s).join(",")}eachCursor(t,e,s=0){if(s++,t instanceof Array)t.forEach(n=>this.eachCursor(n,e,s));else{const n=typeof t=="string"&&xh.get(t);n&&s<2?this.eachCursor(n,e,s):e.push(t)}}destroy(){this.view&&(super.destroy(),this.view=null,this.touches=null)}}function ui(i,t){let e;const{rows:s,decorationY:n,decorationHeight:r}=i.__.__textDrawData;for(let o=0,a=s.length;o<a;o++)e=s[o],e.text?t.fillText(e.text,e.x,e.y):e.data&&e.data.forEach(h=>{t.fillText(h.char,h.x,e.y)}),n&&t.fillRect(e.x,e.y+n,e.width,r)}function h_(i,t,e){e.fillStyle=i,t.__.__font?ui(t,e):t.__.windingRule?e.fill(t.__.windingRule):e.fill()}function l_(i,t,e){let s;const{windingRule:n,__font:r}=t.__;for(let o=0,a=i.length;o<a;o++)s=i[o],!(s.image&&Ye.checkImage(t,e,s,!r))&&s.style&&(e.fillStyle=s.style,s.transform?(e.save(),e.transform(s.transform),s.blendMode&&(e.blendMode=s.blendMode),r?ui(t,e):n?e.fill(n):e.fill(),e.restore()):s.blendMode?(e.saveBlendMode(s.blendMode),r?ui(t,e):n?e.fill(n):e.fill(),e.restoreBlendMode()):r?ui(t,e):n?e.fill(n):e.fill())}function Er(i,t,e){const{strokeAlign:s}=t.__,n=typeof i!="string";switch(s){case"center":e.setStroke(n?void 0:i,t.__.strokeWidth,t.__),n?Wi(i,!0,t,e):ji(t,e);break;case"inside":ca("inside",i,n,t,e);break;case"outside":ca("outside",i,n,t,e);break}}function ca(i,t,e,s,n){const{__strokeWidth:r,__font:o}=s.__,a=n.getSameCanvas(!0,!0);a.setStroke(e?void 0:t,r*2,s.__),a.font=o,e?Wi(t,!0,s,a):ji(s,a),a.blendMode=i==="outside"?"destination-out":"destination-in",ui(s,a),a.blendMode="normal",s.__worldFlipped?n.copyWorldByReset(a,s.__nowWorld):n.copyWorldToInner(a,s.__nowWorld,s.__layout.renderBounds),a.recycle(s.__nowWorld)}function ji(i,t){let e;const{rows:s,decorationY:n,decorationHeight:r}=i.__.__textDrawData;for(let o=0,a=s.length;o<a;o++)e=s[o],e.text?t.strokeText(e.text,e.x,e.y):e.data&&e.data.forEach(h=>{t.strokeText(h.char,h.x,e.y)}),n&&t.strokeRect(e.x,e.y+n,e.width,r)}function Wi(i,t,e,s){let n;for(let r=0,o=i.length;r<o;r++)n=i[r],!(n.image&&Ye.checkImage(e,s,n,!1))&&n.style&&(s.strokeStyle=n.style,n.blendMode?(s.saveBlendMode(n.blendMode),t?ji(e,s):s.stroke(),s.restoreBlendMode()):t?ji(e,s):s.stroke())}function c_(i,t,e){const s=t.__,{__strokeWidth:n,strokeAlign:r,__font:o}=s;if(n)if(o)Er(i,t,e);else switch(r){case"center":e.setStroke(i,n,s),e.stroke();break;case"inside":e.save(),e.setStroke(i,n*2,s),s.windingRule?e.clip(s.windingRule):e.clip(),e.stroke(),e.restore();break;case"outside":const a=e.getSameCanvas(!0,!0);a.setStroke(i,n*2,s),t.__drawRenderPath(a),a.stroke(),s.windingRule?a.clip(s.windingRule):a.clip(),a.clearWorld(t.__layout.renderBounds),t.__worldFlipped?e.copyWorldByReset(a,t.__nowWorld):e.copyWorldToInner(a,t.__nowWorld,t.__layout.renderBounds),a.recycle(t.__nowWorld);break}}function u_(i,t,e){const s=t.__,{__strokeWidth:n,strokeAlign:r,__font:o}=s;if(n)if(o)Er(i,t,e);else switch(r){case"center":e.setStroke(void 0,n,s),Wi(i,!1,t,e);break;case"inside":e.save(),e.setStroke(void 0,n*2,s),s.windingRule?e.clip(s.windingRule):e.clip(),Wi(i,!1,t,e),e.restore();break;case"outside":const{renderBounds:a}=t.__layout,h=e.getSameCanvas(!0,!0);t.__drawRenderPath(h),h.setStroke(void 0,n*2,s),Wi(i,!1,t,h),s.windingRule?h.clip(s.windingRule):h.clip(),h.clearWorld(a),t.__worldFlipped?e.copyWorldByReset(h,t.__nowWorld):e.copyWorldToInner(h,t.__nowWorld,a),h.recycle(t.__nowWorld);break}}const{getSpread:d_,getOuterOf:f_,getByMove:__,getIntersectData:p_}=S;function g_(i,t,e){const s=t.getSameCanvas(),n=i.__nowWorld;let r,o,a,h,{scaleX:l,scaleY:c}=n;if(l<0&&(l=-l),c<0&&(c=-c),t.bounds.includes(n))h=s,r=a=n;else{const{renderShapeSpread:p}=i.__layout,_=p_(p?d_(t.bounds,l===c?p*l:[p*c,p*l]):t.bounds,n);o=t.bounds.getFitMatrix(_);let{a:u,d:f}=o;if(o.a<1&&(h=t.getSameCanvas(),i.__renderShape(h,e),l*=u,c*=f),a=f_(n,o),r=__(a,-o.e,-o.f),e.matrix){const{matrix:g}=e;o.multiply(g),u*=g.scaleX,f*=g.scaleY}e=Object.assign(Object.assign({},e),{matrix:o.withScale(u,f)})}return i.__renderShape(s,e),{canvas:s,matrix:o,bounds:r,worldCanvas:h,shapeBounds:a,scaleX:l,scaleY:c}}let hr;function y_(i,t){const e=t.__,s=[];let n=e.__input[i],r;n instanceof Array||(n=[n]),hr=Ye.recycleImage(i,e);for(let o=0,a=n.length,h;o<a;o++)h=m_(i,n[o],t),h&&s.push(h);e["_"+i]=s.length?s:void 0,s.length&&s[0].image&&(r=s[0].image.hasOpacityPixel),i==="fill"?e.__pixelFill=r:e.__pixelStroke=r}function m_(i,t,e){if(typeof t!="object"||t.visible===!1||t.opacity===0)return;const{boxBounds:s}=e.__layout;switch(t.type){case"solid":let{type:n,blendMode:r,color:o,opacity:a}=t;return{type:n,blendMode:r,style:Fi.string(o,a)};case"image":return Ye.image(e,i,t,s,!hr||!hr[t.url]);case"linear":return Ss.linearGradient(t,s);case"radial":return Ss.radialGradient(t,s);case"angular":return Ss.conicGradient(t,s);default:return t.r!==void 0?{type:"solid",style:Fi.string(t)}:void 0}}const w_={compute:y_,fill:h_,fills:l_,fillText:ui,stroke:c_,strokes:u_,strokeText:Er,drawTextStroke:ji,shape:g_};let Pi={};const{get:Tr,rotateOfOuter:Sh,translate:ai,scaleOfOuter:x_,scale:Ch,rotate:Eh}=P;function Th(i,t,e,s,n,r,o){const a=Tr();ai(a,t.x+e,t.y+s),Ch(a,n,r),o&&Sh(a,{x:t.x+t.width/2,y:t.y+t.height/2},o),i.transform=a}function Ph(i,t,e,s,n,r,o){const a=Tr();ai(a,t.x+e,t.y+s),n&&Ch(a,n,r),o&&Eh(a,o),i.transform=a}function Oh(i,t,e,s,n,r,o,a,h,l){const c=Tr();if(h)if(l==="center")Sh(c,{x:e/2,y:s/2},h);else switch(Eh(c,h),h){case 90:ai(c,s,0);break;case 180:ai(c,e,s);break;case 270:ai(c,0,e);break}Pi.x=t.x+n,Pi.y=t.y+r,ai(c,Pi.x,Pi.y),o&&x_(c,Pi,o,a),i.transform=c}const{get:v_,translate:b_}=P,R_=new Z,An={};function Lh(i,t,e,s){const{blendMode:n}=e;n&&(i.blendMode=n),i.data=Mh(e,s,t)}function Mh(i,t,e){let{width:s,height:n}=e;i.padding&&(t=R_.set(t).shrink(i.padding));const{opacity:r,mode:o,align:a,offset:h,scale:l,size:c,rotation:p,repeat:_}=i,u=t.width===s&&t.height===n,f={mode:o},g=a!=="center"&&(p||0)%180===90,x=g?n:s,w=g?s:n;let m=0,v=0,R,T;if(!o||o==="cover"||o==="fit"){if(!u||p){const M=t.width/x,O=t.height/w;R=T=o==="fit"?Math.min(M,O):Math.max(M,O),m+=(t.width-s*R)/2,v+=(t.height-n*T)/2}}else c?(R=(typeof c=="number"?c:c.width)/s,T=(typeof c=="number"?c:c.height)/n):l&&(R=typeof l=="number"?l:l.x,T=typeof l=="number"?l:l.y);if(a){const M={x:m,y:v,width:x,height:w};R&&(M.width*=R,M.height*=T),Va.toPoint(a,M,t,An,!0),m+=An.x,v+=An.y}switch(h&&(m+=h.x,v+=h.y),o){case"strench":u||(s=t.width,n=t.height);break;case"normal":case"clip":(m||v||R||p)&&Ph(f,t,m,v,R,T,p);break;case"repeat":(!u||R||p)&&Oh(f,t,s,n,m,v,R,T,p,a),_||(f.repeat="repeat");break;case"fit":case"cover":default:R&&Th(f,t,m,v,R,T,p)}return f.transform||(t.x||t.y)&&(f.transform=v_(),b_(f.transform,t.x,t.y)),R&&o!=="strench"&&(f.scaleX=R,f.scaleY=T),f.width=s,f.height=n,r&&(f.opacity=r),_&&(f.repeat=typeof _=="string"?_==="x"?"repeat-x":"repeat-y":"repeat"),f}let Oi,k_=new Z;const{isSame:B_}=S;function S_(i,t,e,s,n){let r,o;const a=xt.get(e);return Oi&&e===Oi.paint&&B_(s,Oi.boxBounds)?r=Oi.leafPaint:(r={type:e.type,image:a},Oi=a.use>1?{leafPaint:r,paint:e,boxBounds:k_.set(s)}:null),(n||a.loading)&&(o={image:a,attrName:t,attrValue:e}),a.ready?(ua(i,t,e,a,r,s),n&&(da(i,o),fa(i,o))):a.error?n&&_a(i,o,a.error):(Dn(i,!0),n&&da(i,o),r.loadId=a.load(()=>{Dn(i,!1),i.destroyed||(ua(i,t,e,a,r,s)&&(a.hasOpacityPixel&&(i.__layout.hitCanvasChanged=!0),i.forceUpdate("surface")),fa(i,o)),r.loadId=null},h=>{Dn(i,!1),_a(i,o,h),r.loadId=null})),r}function ua(i,t,e,s,n,r){if(t==="fill"&&!i.__.__naturalWidth){const o=i.__;if(o.__naturalWidth=s.width/o.pixelRatio,o.__naturalHeight=s.height/o.pixelRatio,o.__autoSide)return i.forceUpdate("width"),i.__proxyData&&(i.setProxyAttr("width",o.width),i.setProxyAttr("height",o.height)),!1}return n.data||Lh(n,s,e,r),!0}function da(i,t){Pr(i,Oe.LOAD,t)}function fa(i,t){Pr(i,Oe.LOADED,t)}function _a(i,t,e){t.error=e,i.forceUpdate("surface"),Pr(i,Oe.ERROR,t)}function Pr(i,t,e){i.hasEvent(t)&&i.emitEvent(new Oe(t,e))}function Dn(i,t){const{leafer:e}=i;e&&e.viewReady&&(e.renderer.ignore=t)}const{get:pa,scale:ga,copy:ya}=P,{ceil:ma,abs:wa}=Math;function lr(i,t,e){let{scaleX:s,scaleY:n}=xt.patternLocked?i.__world:i.__nowWorld;const r=s+"-"+n;if(t.patternId!==r&&!i.destroyed){s=wa(s),n=wa(n);const{image:o,data:a}=t;let h,l,{width:c,height:p,scaleX:_,scaleY:u,opacity:f,transform:g,repeat:x}=a;_&&(l=pa(),ya(l,g),ga(l,1/_,1/u),s*=_,n*=u),s*=e,n*=e,c*=s,p*=n;const w=c*p;if(!x&&w>b.image.maxCacheSize)return!1;let m=b.image.maxPatternSize;if(!o.isSVG){const T=o.width*o.height;m>T&&(m=T)}w>m&&(h=Math.sqrt(w/m)),h&&(s/=h,n/=h,c/=h,p/=h),_&&(s/=_,n/=u),(g||s!==1||n!==1)&&(l||(l=pa(),g&&ya(l,g)),ga(l,1/s,1/n));const v=o.getCanvas(ma(c)||1,ma(p)||1,f),R=o.getPattern(v,x||b.origin.noRepeat||"no-repeat",l,t);return t.style=R,t.patternId=r,!0}else return!1}function Or(i,t,e,s){function n(r){return r instanceof e?r:new e(function(o){o(r)})}return new(e||(e=Promise))(function(r,o){function a(c){try{l(s.next(c))}catch(p){o(p)}}function h(c){try{l(s.throw(c))}catch(p){o(p)}}function l(c){c.done?r(c.value):n(c.value).then(a,h)}l((s=s.apply(i,[])).next())})}const{abs:xa}=Math;function C_(i,t,e,s){const{scaleX:n,scaleY:r}=xt.patternLocked?i.__world:i.__nowWorld;if(!e.data||e.patternId===n+"-"+r&&!li.running)return!1;{const{data:o}=e;if(s)if(o.repeat)s=!1;else{let{width:a,height:h}=o;a*=xa(n)*t.pixelRatio,h*=xa(r)*t.pixelRatio,o.scaleX&&(a*=o.scaleX,h*=o.scaleY),s=a*h>b.image.maxCacheSize||li.running}return s?(t.save(),t.clip(),e.blendMode&&(t.blendMode=e.blendMode),o.opacity&&(t.opacity*=o.opacity),o.transform&&t.transform(o.transform),t.drawImage(e.image.view,0,0,o.width,o.height),t.restore(),!0):(!e.style||li.running?lr(i,e,t.pixelRatio):e.patternTask||(e.patternTask=xt.patternTasker.add(()=>Or(this,void 0,void 0,function*(){e.patternTask=null,t.bounds.hit(i.__nowWorld)&&lr(i,e,t.pixelRatio),i.forceUpdate("surface")}),300)),!1)}}function E_(i,t){const e=t["_"+i];if(e instanceof Array){let s,n,r,o;for(let a=0,h=e.length;a<h;a++)s=e[a].image,o=s&&s.url,o&&(n||(n={}),n[o]=!0,xt.recycle(s),s.loading&&(r||(r=t.__input&&t.__input[i]||[],r instanceof Array||(r=[r])),s.unload(e[a].loadId,!r.some(l=>l.url===o))));return n}return null}const T_={image:S_,checkImage:C_,createPattern:lr,recycleImage:E_,createData:Lh,getPatternData:Mh,fillOrFitMode:Th,clipMode:Ph,repeatMode:Oh},{toPoint:va}=yi,In={},Wn={};function P_(i,t){let{from:e,to:s,type:n,blendMode:r,opacity:o}=i;va(e||"top",t,In),va(s||"bottom",t,Wn);const a=b.canvas.createLinearGradient(In.x,In.y,Wn.x,Wn.y);Lr(a,i.stops,o);const h={type:n,style:a};return r&&(h.blendMode=r),h}function Lr(i,t,e){let s;for(let n=0,r=t.length;n<r;n++)s=t[n],typeof s=="string"?i.addColorStop(n/(r-1),Fi.string(s,e)):i.addColorStop(s.offset,Fi.string(s.color,e))}const{getAngle:O_,getDistance:L_}=E,{get:M_,rotateOfOuter:ba,scaleOfOuter:Ra}=P,{toPoint:ka}=yi,$e={},$n={};function A_(i,t){let{from:e,to:s,type:n,opacity:r,blendMode:o,stretch:a}=i;ka(e||"center",t,$e),ka(s||"bottom",t,$n);const h=b.canvas.createRadialGradient($e.x,$e.y,0,$e.x,$e.y,L_($e,$n));Lr(h,i.stops,r);const l={type:n,style:h},c=Mr(t,$e,$n,a,!0);return c&&(l.transform=c),o&&(l.blendMode=o),l}function Mr(i,t,e,s,n){let r;const{width:o,height:a}=i;if(o!==a||s){const h=O_(t,e);r=M_(),n?(Ra(r,t,o/a*(s||1),1),ba(r,t,h+90)):(Ra(r,t,1,o/a*(s||1)),ba(r,t,h))}return r}const{getDistance:D_}=E,{toPoint:Ba}=yi,le={},Fn={};function I_(i,t){let{from:e,to:s,type:n,opacity:r,blendMode:o,stretch:a}=i;Ba(e||"center",t,le),Ba(s||"bottom",t,Fn);const h=b.conicGradientSupport?b.canvas.createConicGradient(0,le.x,le.y):b.canvas.createRadialGradient(le.x,le.y,0,le.x,le.y,D_(le,Fn));Lr(h,i.stops,r);const l={type:n,style:h},c=Mr(t,le,Fn,a||1,b.conicGradientRotate90);return c&&(l.transform=c),o&&(l.blendMode=o),l}const W_={linearGradient:P_,radialGradient:A_,conicGradient:I_,getTransform:Mr},{copy:Sa,toOffsetOutBounds:$_}=S,yt={},ms={};function F_(i,t,e){let s,n;const{__nowWorld:r,__layout:o}=i,{shadow:a}=i.__,{worldCanvas:h,bounds:l,shapeBounds:c,scaleX:p,scaleY:_}=e,u=t.getSameCanvas(),f=a.length-1;$_(l,ms),a.forEach((g,x)=>{u.setWorldShadow(ms.offsetX+g.x*p,ms.offsetY+g.y*_,g.blur*p,g.color),n=g.spread?1+g.spread*2/(o.boxBounds.width+(o.strokeBoxSpread||0)*2):0,Ah(u,ms,n,e),s=l,g.box&&(u.restore(),u.save(),h&&(u.copyWorld(u,l,r,"copy"),s=r),h?u.copyWorld(h,r,r,"destination-out"):u.copyWorld(e.canvas,c,l,"destination-out")),i.__worldFlipped?t.copyWorldByReset(u,s,r,g.blendMode):t.copyWorldToInner(u,s,o.renderBounds,g.blendMode),f&&x<f&&u.clearWorld(s,!0)}),u.recycle(s)}function Ah(i,t,e,s){const{bounds:n,shapeBounds:r}=s;if(b.fullImageShadow){if(Sa(yt,i.bounds),yt.x+=t.x-r.x,yt.y+=t.y-r.y,e){const{matrix:o}=s;yt.x-=(n.x+(o?o.e:0)+n.width/2)*(e-1),yt.y-=(n.y+(o?o.f:0)+n.height/2)*(e-1),yt.width*=e,yt.height*=e}i.copyWorld(s.canvas,i.bounds,yt)}else e&&(Sa(yt,t),yt.x-=t.width/2*(e-1),yt.y-=t.height/2*(e-1),yt.width*=e,yt.height*=e),i.copyWorld(s.canvas,r,e?yt:t)}const{toOffsetOutBounds:z_}=S,ws={};function H_(i,t,e){let s,n;const{__nowWorld:r,__layout:o}=i,{innerShadow:a}=i.__,{worldCanvas:h,bounds:l,shapeBounds:c,scaleX:p,scaleY:_}=e,u=t.getSameCanvas(),f=a.length-1;z_(l,ws),a.forEach((g,x)=>{u.save(),u.setWorldShadow(ws.offsetX+g.x*p,ws.offsetY+g.y*_,g.blur*p),n=g.spread?1-g.spread*2/(o.boxBounds.width+(o.strokeBoxSpread||0)*2):0,Ah(u,ws,n,e),u.restore(),h?(u.copyWorld(u,l,r,"copy"),u.copyWorld(h,r,r,"source-out"),s=r):(u.copyWorld(e.canvas,c,l,"source-out"),s=l),u.fillWorld(s,g.color,"source-in"),i.__worldFlipped?t.copyWorldByReset(u,s,r,g.blendMode):t.copyWorldToInner(u,s,o.renderBounds,g.blendMode),f&&x<f&&u.clearWorld(s,!0)}),u.recycle(s)}function N_(i,t,e){const{blur:s}=i.__;e.setWorldBlur(s*i.__nowWorld.a),e.copyWorldToInner(t,i.__nowWorld,i.__layout.renderBounds),e.filter="none"}function j_(i,t,e){}const G_={shadow:F_,innerShadow:H_,blur:N_,backgroundBlur:j_},{excludeRenderBounds:U_}=zs;Zt.prototype.__renderMask=function(i,t){let e,s,n,r,o;const{children:a}=this;for(let h=0,l=a.length;h<l;h++)e=a[h],!(e.__.mask&&(o&&(Ca(this,o,i,n,s,r),s=n=null),e.__.mask==="path"?(e.opacity<1?(o="opacity-path",r=e.opacity,n||(n=zn(i))):(o="path",i.save()),e.__clip(n||i,t)):(o="alpha",s||(s=zn(i)),n||(n=zn(i)),e.__render(s,t)),e.__.mask!=="clipping"))&&(U_(e,t)||e.__render(n||i,t));Ca(this,o,i,n,s,r)};function Ca(i,t,e,s,n,r){switch(t){case"alpha":Y_(i,e,s,n);break;case"opacity-path":Dh(i,e,s,r);break;case"path":e.restore()}}function zn(i){return i.getSameCanvas(!1,!0)}function Y_(i,t,e,s){const n=i.__nowWorld;e.resetTransform(),e.opacity=1,e.useMask(s,n),s.recycle(n),Dh(i,t,e,1)}function Dh(i,t,e,s){const n=i.__nowWorld;t.resetTransform(),t.opacity=s,t.copyWorld(e,n),e.recycle(n)}const V_="",X_="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789abcdefghijklmnopqrstuvwxyz",K_=""+V_,q_="",Z_="",Q_="",J_=`{[(<'"`+K_,Ih=`>)]}%!?,.:;'"`+q_,tp=Ih+"_#~&*+\\=|"+Z_,ep="- "+Q_,ip=[[19968,40959],[13312,19903],[131072,173791],[173824,177983],[177984,178207],[178208,183983],[183984,191471],[196608,201551],[201552,205743],[11904,12031],[12032,12255],[12272,12287],[12288,12351],[12736,12783],[12800,13055],[13056,13311],[63744,64255],[65072,65103],[127488,127743],[194560,195103]],sp=new RegExp(ip.map(([i,t])=>`[\\u${i.toString(16)}-\\u${t.toString(16)}]`).join("|"));function Ji(i){const t={};return i.split("").forEach(e=>t[e]=!0),t}const np=Ji(X_),rp=Ji(J_),op=Ji(Ih),ap=Ji(tp),hp=Ji(ep);var Ls;(function(i){i[i.Letter=0]="Letter",i[i.Single=1]="Single",i[i.Before=2]="Before",i[i.After=3]="After",i[i.Symbol=4]="Symbol",i[i.Break=5]="Break"})(Ls||(Ls={}));const{Letter:Ea,Single:lp,Before:cp,After:up,Symbol:dp,Break:fp}=Ls;function _p(i){return np[i]?Ea:hp[i]?fp:rp[i]?cp:op[i]?up:ap[i]?dp:sp.test(i)?lp:Ea}const pp={trimRight(i){const{words:t}=i;let e=0,s=t.length,n;for(let r=s-1;r>-1&&(n=t[r].data[0],n.char===" ");r--)e++,i.width-=n.width;e&&t.splice(s-e,e)}};function gp(i,t,e){switch(t){case"title":return e?i.toUpperCase():i;case"upper":return i.toUpperCase();case"lower":return i.toLowerCase();default:return i}}const{trimRight:yp}=pp,{Letter:Hn,Single:Li,Before:Ta,After:Nn,Symbol:mp,Break:Pa}=Ls;let $i,Vt,_t,Xt,jn,It,ce,Gi,gi,Tt,ve,Gn,Mi,hi,cr,oi=[],ur;function wp(i,t,e){cr=i,oi=i.rows,ur=i.bounds;const{__letterSpacing:s,paraIndent:n,textCase:r}=e,{canvas:o}=b,{width:a,height:h}=ur;if(a||h||s||r!=="none"){const c=e.textWrap!=="none",p=e.textWrap==="break";hi=!0,ve=null,Gi=ce=gi=_t=Xt=0,$i={data:[]},Vt={words:[]};for(let _=0,u=t.length;_<u;_++)It=t[_],It===`
`?(_t&&Fe(),Vt.paraEnd=!0,Ai(),hi=!0):(Tt=_p(It),Tt===Hn&&r!=="none"&&(It=gp(It,r,!_t)),ce=o.measureText(It).width,s&&(s<0&&(gi=ce),ce+=s),Gn=Tt===Li&&(ve===Li||ve===Hn)||ve===Li&&Tt!==Nn,Mi=(Tt===Ta||Tt===Li)&&(ve===mp||ve===Nn),jn=hi&&n?a-n:a,c&&a&&Xt+_t+ce>jn&&(p?(_t&&Fe(),Xt&&Ai()):(Mi||(Mi=Tt===Hn&&ve==Nn),(Gn||Mi||Tt===Pa||Tt===Ta||Tt===Li||_t+ce>jn)&&_t&&Fe(),Xt&&Ai())),It===" "&&hi!==!0&&Xt+_t===0||(Tt===Pa?(It===" "&&_t&&Fe(),Un(It,ce),Fe()):((Gn||Mi)&&_t&&Fe(),Un(It,ce))),ve=Tt);_t&&Fe(),Xt&&Ai(),oi.length>0&&(oi[oi.length-1].paraEnd=!0)}else t.split(`
`).forEach(c=>{cr.paraNumber++,oi.push({x:n||0,text:c,width:o.measureText(c).width,paraStart:!0})})}function Un(i,t){gi&&!Gi&&(Gi=gi),$i.data.push({char:i,width:t}),_t+=t}function Fe(){Xt+=_t,$i.width=_t,Vt.words.push($i),$i={data:[]},_t=0}function Ai(){hi&&(cr.paraNumber++,Vt.paraStart=!0,hi=!1),gi&&(Vt.startCharSize=Gi,Vt.endCharSize=gi,Gi=0),Vt.width=Xt,ur.width&&yp(Vt),oi.push(Vt),Vt={words:[]},Xt=0}const xp=0,Oa=1,La=2;function vp(i,t,e,s){const{rows:n}=i,{textAlign:r,paraIndent:o,letterSpacing:a}=t;let h,l,c,p,_;n.forEach(u=>{u.words&&(c=o&&u.paraStart?o:0,l=e&&r==="justify"&&u.words.length>1?(e-u.width-c)/(u.words.length-1):0,p=a||u.isOverflow?xp:l>.01?Oa:La,u.isOverflow&&!a&&(u.textMode=!0),p===La?(u.x+=c,bp(u)):(u.x+=c,h=u.x,u.data=[],u.words.forEach(f=>{p===Oa?(_={char:"",x:h},h=Rp(f.data,h,_),(u.isOverflow||_.char!==" ")&&u.data.push(_)):h=kp(f.data,h,u.data,u.isOverflow),!u.paraEnd&&l&&(h+=l,u.width+=l)})),u.words=null)})}function bp(i){i.text="",i.words.forEach(t=>{t.data.forEach(e=>{i.text+=e.char})})}function Rp(i,t,e){return i.forEach(s=>{e.char+=s.char,t+=s.width}),t}function kp(i,t,e,s){return i.forEach(n=>{(s||n.char!==" ")&&(n.x=t,e.push(n)),t+=n.width}),t}function Bp(i,t){const{rows:e,bounds:s}=i,{__lineHeight:n,__baseLine:r,__letterSpacing:o,__clipText:a,textAlign:h,verticalAlign:l,paraSpacing:c}=t;let{x:p,y:_,width:u,height:f}=s,g=n*e.length+(c?c*(i.paraNumber-1):0),x=r;if(a&&g>f)g=Math.max(f,n),i.overflow=e.length;else switch(l){case"middle":_+=(f-g)/2;break;case"bottom":_+=f-g}x+=_;let w,m,v;for(let R=0,T=e.length;R<T;R++){if(w=e[R],w.x=p,w.width<u||w.width>u&&!a)switch(h){case"center":w.x+=(u-w.width)/2;break;case"right":w.x+=u-w.width}w.paraStart&&c&&R>0&&(x+=c),w.y=x,x+=n,i.overflow>R&&x>g&&(w.isOverflow=!0,i.overflow=R+1),m=w.x,v=w.width,o<0&&(w.width<0?(v=-w.width+t.fontSize+o,m-=v,v+=t.fontSize):v-=o),m<s.x&&(s.x=m),v>s.width&&(s.width=v),a&&u&&u<v&&(w.isOverflow=!0,i.overflow||(i.overflow=e.length))}s.y=_,s.height=g}function Sp(i,t,e,s){if(!s)return;const{rows:n,overflow:r}=i;let{textOverflow:o}=t;if(n.splice(r),o&&o!=="show"){o==="hide"?o="":o==="ellipsis"&&(o="...");let a,h;const l=o?b.canvas.measureText(o).width:0,c=e+s-l;(t.textWrap==="none"?n:[n[r-1]]).forEach(_=>{if(_.isOverflow&&_.data){let u=_.data.length-1;for(let f=u;f>-1&&(a=_.data[f],h=a.x+a.width,!(f===u&&h<c));f--){if(h<c&&a.char!==" "){_.data.splice(f+1),_.width-=a.width;break}_.width-=a.width}_.width+=l,_.data.push({char:o,x:h}),_.textMode&&Cp(_)}})}}function Cp(i){i.text="",i.data.forEach(t=>{i.text+=t.char}),i.data=null}function Ep(i,t){const{fontSize:e}=t;switch(i.decorationHeight=e/11,t.textDecoration){case"under":i.decorationY=e*.15;break;case"delete":i.decorationY=-e*.35}}const{top:dr,right:Wh,bottom:$h,left:fr}=Jn;function Tp(i,t){typeof i!="string"&&(i=String(i));let e=0,s=0,n=t.__getInput("width")||0,r=t.__getInput("height")||0;const{textDecoration:o,__font:a,__padding:h}=t;h&&(n&&(e=h[fr],n-=h[Wh]+h[fr]),r&&(s=h[dr],r-=h[dr]+h[$h]));const l={bounds:{x:e,y:s,width:n,height:r},rows:[],paraNumber:0,font:b.canvas.font=a};return wp(l,i,t),h&&Pp(h,l,t,n,r),Bp(l,t),vp(l,t,n),l.overflow&&Sp(l,t,e,n),o!=="none"&&Ep(l,t),l}function Pp(i,t,e,s,n){if(!s)switch(e.textAlign){case"left":xs(t,"x",i[fr]);break;case"right":xs(t,"x",-i[Wh])}if(!n)switch(e.verticalAlign){case"top":xs(t,"y",i[dr]);break;case"bottom":xs(t,"y",-i[$h])}}function xs(i,t,e){const{bounds:s,rows:n}=i;s[t]+=e;for(let r=0;r<n.length;r++)n[r][t]+=e}const Op={getDrawData:Tp};function Lp(i,t){if(typeof i=="string")return i;let e=i.a===void 0?1:i.a;t&&(e*=t);const s=i.r+","+i.g+","+i.b;return e===1?"rgb("+s+")":"rgba("+s+","+e+")"}const Mp={string:Lp},{setPoint:Ap,addPoint:Dp,toBounds:Ip}=Vi;function Wp(i){const{width:t,height:e}=i.view,{data:s}=i.context.getImageData(0,0,t,e);let n,r,o,a=0;for(let l=0;l<s.length;l+=4)s[l+3]!==0&&(n=a%t,r=(a-n)/t,o?Dp(o,n,r):Ap(o={},n,r)),a++;const h=new Z;return Ip(o,h),h.scale(1/i.pixelRatio).ceil()}const $p={export(i,t,e){this.running=!0;const s=fe.fileType(t);return e=fe.getExportOptions(e),Fp(n=>new Promise(r=>{const o=c=>{n(c),r(),this.running=!1},{toURL:a}=b,{download:h}=b.origin;if(t==="json")return o({data:i.toJSON(e.json)});if(s==="json")return h(a(JSON.stringify(i.toJSON(e.json)),"text"),t),o({data:!0});if(t==="svg")return o({data:i.toSVG()});if(s==="svg")return h(a(i.toSVG(),"svg"),t),o({data:!0});const{leafer:l}=i;l?(Fh(i),l.waitViewCompleted(()=>Or(this,void 0,void 0,function*(){let c,p,_=1,u=1;const{worldTransform:f,isLeafer:g,isFrame:x}=i,{slice:w,trim:m,onCanvas:v}=e;let R=e.scale||1,T=e.pixelRatio||1;const M=e.smooth===void 0?l.config.smooth:e.smooth,O=e.contextSettings||l.config.contextSettings;i.isApp&&(R*=T,T=i.app.pixelRatio);const z=e.screenshot||i.isApp,et=g&&z&&e.fill===void 0?i.fill:e.fill,st=fe.isOpaqueImage(t)||et,K=new Ce;if(z)c=z===!0?g?l.canvas.bounds:i.worldRenderBounds:z;else{let Bt=e.relative||(g?"inner":"local");switch(_=f.scaleX,u=f.scaleY,Bt){case"inner":K.set(f);break;case"local":K.set(f).divide(i.localTransform),_/=i.scaleX,u/=i.scaleY;break;case"world":_=1,u=1;break;case"page":Bt=i.leafer;default:K.set(f).divide(i.getTransform(Bt));const ts=Bt.worldTransform;_/=_/ts.scaleX,u/=u/ts.scaleY}c=i.getBounds("render",Bt)}const{x:Dt,y:ie,width:se,height:ne}=new Z(c).scale(R);let q=nt.canvas({width:Math.round(se),height:Math.round(ne),pixelRatio:T,smooth:M,contextSettings:O});const Le={matrix:K.scale(1/R).invert().translate(-Dt,-ie).withScale(1/_*R,1/u*R)};let me;if(w&&(me=i,me.__worldOpacity=0,i=l,Le.bounds=q.bounds),q.save(),x&&et!==void 0){const Bt=i.get("fill");i.fill="",i.__render(q,Le),i.fill=Bt}else i.__render(q,Le);if(q.restore(),me&&me.__updateWorldOpacity(),m){p=Wp(q);const Bt=q,{width:ts,height:tl}=p,$r={x:0,y:0,width:ts,height:tl,pixelRatio:T};q=nt.canvas($r),q.copyWorld(Bt,p,$r)}st&&q.fillWorld(q.bounds,et||"#FFFFFF","destination-over"),v&&v(q);const vi=t==="canvas"?q:yield q.export(t,e);o({data:vi,width:q.pixelWidth,height:q.pixelHeight,renderBounds:c,trimBounds:p})}))):o({data:!1})}))}};let Yn;function Fp(i){return Yn||(Yn=new sr),new Promise(t=>{Yn.add(()=>Or(this,void 0,void 0,function*(){return yield i(t)}),{parallel:!1})})}function Fh(i){i.__.__needComputePaint&&i.__.__computePaint(),i.isBranch&&i.children.forEach(t=>Fh(t))}const Us=xr.prototype,zh=F.get("@leafer-ui/export");Us.export=function(i,t){const{quality:e,blob:s}=fe.getExportOptions(t);return i.includes(".")?this.saveAs(i,e):s?this.toBlob(i,e):this.toDataURL(i,e)};Us.toBlob=function(i,t){return new Promise(e=>{b.origin.canvasToBolb(this.view,i,t).then(s=>{e(s)}).catch(s=>{zh.error(s),e(null)})})};Us.toDataURL=function(i,t){return b.origin.canvasToDataURL(this.view,i,t)};Us.saveAs=function(i,t){return new Promise(e=>{b.origin.canvasSaveAs(this.view,i,t).then(()=>{e(!0)}).catch(s=>{zh.error(s),e(!1)})})};Object.assign(dh,Op);Object.assign(Fi,Mp);Object.assign(rt,w_);Object.assign(Ye,T_);Object.assign(Ss,W_);Object.assign(rr,G_);Object.assign(li,$p);Object.assign(nt,{interaction:(i,t,e,s)=>new a_(i,t,e,s),hitCanvas:(i,t)=>new Bh(i,t),hitCanvasManager:()=>new Af});Hf();const{M:zp,L:Hp,C:Np,Q:jp,Z:Gp,N:Up,D:Yp,X:Vp,G:Ma,F:Aa,O:Xp,P:Kp,U:qp}=Mt,Ar={scale(i,t,e){if(!i)return;let s,n=0,r=i.length;for(;n<r;)switch(s=i[n],s){case zp:Pt(i,t,e,n,1),n+=3;break;case Hp:Pt(i,t,e,n,1),n+=3;break;case Np:Pt(i,t,e,n,3),n+=7;break;case jp:Pt(i,t,e,n,2),n+=5;break;case Gp:n+=1;break;case Up:Pt(i,t,e,n,2),n+=5;break;case Yp:Pt(i,t,e,n,2),n+=9;break;case Vp:Pt(i,t,e,n,2),n+=6;break;case Ma:Pt(i,t,e,n,2),n+=9;break;case Aa:Pt(i,t,e,n,2),n+=5;break;case Xp:i[n]=Ma,i.splice(n+4,0,i[n+3],0),Pt(i,t,e,n,2),n+=9,r+=2;break;case Kp:i[n]=Aa,i.splice(n+4,0,i[n+3]),Pt(i,t,e,n,2),n+=5,r+=1;break;case qp:Pt(i,t,e,n,2),n+=6;break}},scalePoints(i,t,e,s,n){for(let r=n?s+1:0,o=n?r+n*2:i.length;r<o;r+=2)i[r]*=t,i[r+1]*=e}},{scalePoints:Pt}=Ar,Vn=P.get();function Ys(i,t,e){i.pathInputed?Vs(i,t,e):(t!==1&&(i.width*=t),e!==1&&(i.height*=e))}function Zp(i,t,e){const{width:s,height:n}=i.__localBoxBounds;t!==1?(i.fontSize*=t,i.y-=n*(t-e)/2):e!==1&&(i.fontSize*=e,i.x-=s*(e-t)/2)}function Vs(i,t,e){Ar.scale(i.__.path,t,e),i.path=i.__.path}function Hh(i,t,e){Ar.scalePoints(i.__.points,t,e),i.points=i.__.points}function _r(i,t,e){const{children:s}=i;for(let n=0;n<s.length;n++)Vn.a=t,Vn.d=e,s[n].transform(Vn,!0)}const Xs=Ue.prototype;Xs.scaleResize=function(i,t=i,e){const s=this;e||s.editConfig&&s.editConfig.editSize==="scale"?(s.scaleX*=i,s.scaleY*=t):(i<0&&(s.scaleX*=-1,i=-i),t<0&&(s.scaleY*=-1,t=-t),this.__scaleResize(i,t))};Xs.__scaleResize=function(i,t){Ys(this,i,t)};Xs.resizeWidth=function(i){const t=i/this.getBounds("box","local").width;this.scaleOf(this.__layout.boxBounds,t,this.__.lockRatio?t:1,!0)};Xs.resizeHeight=function(i){const t=i/this.getBounds("box","local").height;this.scaleOf(this.__layout.boxBounds,this.__.lockRatio?t:1,t,!0)};N.prototype.__scaleResize=function(i,t){this.__.__autoSize&&(this.__.resizeFontSize||this.editConfig&&this.editConfig.editSize==="font-size")?Zp(this,i,t):Ys(this,i,t)};pi.prototype.__scaleResize=function(i,t){Vs(this,i,t)};Qt.prototype.__scaleResize=function(i,t){this.pathInputed?Vs(this,i,t):this.points?Hh(this,i,t):this.width*=i};pe.prototype.__scaleResize=function(i,t){this.pathInputed?Vs(this,i,t):this.points?Hh(this,i,t):Ys(this,i,t)};Zt.prototype.__scaleResize=function(i,t){_r(this,i,t)};ot.prototype.__scaleResize=function(i,t){this.__.__autoSize&&this.children.length?_r(this,i,t):(Ys(this,i,t),this.__.resizeChildren&&_r(this,i,t))};function Dr(i,t,e,s){var n=arguments.length,r=n<3?t:s,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(i,t,e,s);else for(var a=i.length-1;a>=0;a--)(o=i[a])&&(r=(n<3?o(r):n>3?o(t,e,r):o(t,e))||r);return n>3&&r&&Object.defineProperty(t,e,r),r}class Qp extends kr{}let Ui=class extends ot{get __tag(){return"Flow"}constructor(t){super(t),this.__hasAutoLayout=!0}};Dr([lt(Qp)],Ui.prototype,"__",void 0);Dr([Ws("x")],Ui.prototype,"flow",void 0);Ui=Dr([ct()],Ui);const Xn={},Nh={"top-left":"from",top:"center","top-right":"to",right:"to","bottom-right":"to",bottom:"center","bottom-left":"from",left:"from",center:"center","baseline-left":"from","baseline-center":"center","baseline-right":"to"},jh={"top-left":"from",top:"from","top-right":"from",right:"center","bottom-right":"to",bottom:"to","bottom-left":"to",left:"center",center:"center","baseline-left":"to","baseline-center":"to","baseline-right":"to"};function Ks(i,t,e){Va.toPoint(e,t,i.__layout.contentBounds,Xn);const s=i.__;t.x=s.__autoWidth?0:Xn.x,t.y=s.__autoHeight?0:Xn.y}function Jp(i,t,e,s){Ks(i,t,e);const{list:n}=t;if(n.length>1&&(s||(s=Nh[e]),s!=="from")){let r;for(let o=0,a=n.length;o<a;o++)r=n[o],r.x=t.width-r.width,s==="center"&&(r.x/=2)}}const{move:tg}=E;function eg(i,t,e,s){const{list:n}=t,r=i.__.flowWrap==="reverse";let o,{x:a,y:h}=t;for(let l=0,c=n.length;l<c;l++)o=n[r?c-1-l:l],Gh(i,o,a,h,e,s),h+=o.height+t.gap}function Gh(i,t,e,s,n,r){const{children:o}=i;let a,h,{x:l,start:c}=t,p=s;l+=e;for(let _=0,u=t.count;_<u;_++)a=o[r?c-_:c+_],a.__.inFlow&&a.__.visible!==0?(h=a.__flowBounds,n!=="from"&&(p=s+(t.height-h.height)/(n==="center"?2:1)),tg(a,l-h.x,p-h.y),l+=h.width+t.gap):u++}function Ms(i,t,e){const s=e==="width"?"height":"width";i[e]=Math.max(i[e],t[e]),i[s]+=i.count?t[s]+i.gap:t[s],i.list.push(t),i.count++}const V={};function Uh(i,t){const{gap:e,flowAlign:s,flowWrap:n,__autoWidth:r,__autoHeight:o}=i.__,a=n&&(t?!r:!o);return typeof e=="object"?(V.xGap=e.x||0,V.yGap=e.y||0):V.xGap=V.yGap=e,V.isAutoXGap=typeof V.xGap=="string"&&!r,V.isAutoYGap=typeof V.yGap=="string"&&!o,V.complex=a||s!=="top-left"||i.__hasGrow||V.isAutoXGap||V.isAutoYGap,V.wrap=a,V.complex&&(V.isFitXGap=V.xGap==="fit"&&!r,V.isFitYGap=V.yGap==="fit"&&!o,typeof s=="object"?(V.contentAlign=s.content||"top-left",V.rowXAlign=s.x||"from",V.rowYAlign=s.y||"from"):(V.contentAlign=s,V.rowXAlign=Nh[s],V.rowYAlign=jh[s])),V}function As(i,t){return{x:0,y:0,width:0,height:0,gap:t,start:i,count:0,grow:0}}function Yh(){return{x:0,y:0,width:0,height:0,gap:0,count:0,list:[]}}function di(i,t,e,s){const{count:n}=i;n>1&&(e>i[t]||s)&&(i.gap=(e-i[t])/(n-1),i[t]=e)}function Vh(i,t){return t==="box"?i.__local:i.__layout.localStrokeBounds}const{within:ig}=At;function Da(i,t,e,s){let n,r,o,a=0,h=t.hasRangeSize&&[],{grow:l,start:c}=t;const p=t.width<e?(e-t.width)/l:0,{children:_}=i;p&&(t.width=e);for(let u=0,f=t.count;u<f;u++)n=_[s?c-u:c+u],n.__.inFlow&&n.__.visible!==0?(r=n.__widthGrow)&&(o=Ir(n,n.__flowBounds,p*r),o?(a+=o,l-=r):h&&(n.__.widthRange?h.unshift(n):h.push(n))):f++;a&&sg(h,a,l)}function sg(i,t,e){let s,n,r,o;i.forEach(a=>{s=a.__widthGrow,n=t/e*s,o=Ir(a,r=a.__flowBounds,r.width+n),t-=n-o,e-=s})}function Ir(i,t,e){const{widthRange:s,lockRatio:n}=i.__,r=s?ig(e,s):e,o=r/t.width;return i.scaleResize(o,n?o:1),t.width=r,e-r}const{within:ng}=At;function Ia(i,t,e,s){let n,r,o,a=0,h=t.hasRangeSize&&[],{grow:l,start:c}=t;const p=t.height<e?(e-t.height)/l:0,{children:_}=i;p&&(t.height=e);for(let u=0,f=t.count;u<f;u++)n=_[s?c-u:c+u],n.__.inFlow&&n.__.visible!==0?(r=n.__heightGrow)&&(o=Wr(n,n.__flowBounds,p*r),o?(a+=o,l-=r):h&&(n.__.heightRange?h.unshift(n):h.push(n))):f++;a&&rg(h,a,l)}function rg(i,t,e){let s,n,r,o;i.forEach(a=>{s=a.__heightGrow,n=t/e*s,o=Wr(a,r=a.__flowBounds,r.height+n),t-=n-o,e-=s})}function Wr(i,t,e){const{heightRange:s,lockRatio:n}=i.__,r=s?ng(e,s):e,o=r/t.height;return i.scaleResize(n?o:1,o),t.height=r,e-r}const{move:og}=E;function ag(i,t){const e="width",{children:s,itemBox:n}=i,r=Uh(i,!0),{complex:o,wrap:a,xGap:h,yGap:l,isAutoXGap:c,isFitXGap:p}=r;if(!s.length)return;const _=a&&Yh(),u=c?0:h;let f,g,x,w,m,{x:v,y:R,width:T,height:M}=i.__layout.contentBounds;for(let O=0,z=s.length;O<z;O++)f=s[w=t?z-1-O:O],f.__.inFlow&&f.__.visible!==0&&(g=Vh(f,n),o?(f.__flowBounds=g,m||(m=As(w,u)),a&&m.count&&m.width+g.width>T&&(m.grow?Da(i,m,T,t):c&&di(m,e,T,p),Ms(_,m,e),m=As(w,u)),x=g.width,f.__widthGrow&&(m.grow+=f.__widthGrow,x=0,f.__.widthRange&&(m.hasRangeSize=!0)),f.__heightGrow&&Wr(f,g,M),m.width+=m.count?x+u:x,m.height=Math.max(m.height,g.height),m.count++):(og(f,v-g.x,R-g.y),v+=g.width+u));if(o){const{isAutoYGap:O,isFitYGap:z,contentAlign:et,rowXAlign:st,rowYAlign:K}=r;m.count&&(m.grow?Da(i,m,T,t):c&&di(m,e,T,p),a&&Ms(_,m,e)),a?(O?di(_,"height",M,z):_.gap=l,Jp(i,_,et,st),eg(i,_,K,t)):(Ks(i,m,et),Gh(i,m,0,m.y,K,t))}}function hg(i,t,e,s){Ks(i,t,e);const{list:n}=t;if(n.length>1&&(s||(s=jh[e]),s!=="from")){let r;for(let o=0,a=n.length;o<a;o++)r=n[o],r.y=t.height-r.height,s==="center"&&(r.y/=2)}}const{move:lg}=E;function cg(i,t,e,s){const{list:n}=t,r=i.__.flowWrap==="reverse";let o,{x:a,y:h}=t;for(let l=0,c=n.length;l<c;l++)o=n[r?c-1-l:l],Xh(i,o,a,h,e,s),a+=o.width+t.gap}function Xh(i,t,e,s,n,r){const{children:o}=i;let a,h,{y:l,start:c}=t,p=e;l+=s;for(let _=0,u=t.count;_<u;_++)a=o[r?c-_:c+_],a.__.inFlow&&a.__.visible!==0?(h=a.__flowBounds,n!=="from"&&(p=e+(t.width-h.width)/(n==="center"?2:1)),lg(a,p-h.x,l-h.y),l+=h.height+t.gap):u++}const{move:ug}=E;function dg(i,t){const e="height",{children:s,itemBox:n}=i,r=Uh(i,!1),{complex:o,wrap:a,xGap:h,yGap:l,isAutoYGap:c,isFitYGap:p}=r;if(!s.length)return;const _=a&&Yh(),u=c?0:l;let f,g,x,w,m,{x:v,y:R,width:T,height:M}=i.__layout.contentBounds;for(let O=0,z=s.length;O<z;O++)f=s[w=t?z-1-O:O],f.__.inFlow&&f.__.visible!==0&&(g=Vh(f,n),o?(f.__flowBounds=g,m||(m=As(w,u)),a&&m.count&&m.height+g.height>M&&(m.grow&&Ia(i,m,M,t),c&&di(m,e,M,p),Ms(_,m,e),m=As(w,u)),x=g.height,f.__heightGrow&&(m.grow+=f.__heightGrow,x=0,f.__.heightRange&&(m.hasRangeSize=!0)),f.__widthGrow&&Ir(f,g,T),m.height+=m.count?x+u:x,m.width=Math.max(m.width,g.width),m.count++):(ug(f,v-g.x,R-g.y),R+=g.height+u));if(o){const{isAutoXGap:O,isFitXGap:z,contentAlign:et,rowXAlign:st,rowYAlign:K}=r;m.count&&(m.grow&&Ia(i,m,M,t),c&&di(m,e,M,p),a&&Ms(_,m,e)),a?(O?di(_,"width",T,z):_.gap=h,hg(i,_,et,K),cg(i,_,st,t)):(Ks(i,m,et),Xh(i,m,m.x,0,st,t))}}function Kh(i){return Q(i,t=>({set(e){const s=typeof e=="number"?e:0;t==="autoWidth"?this.__widthGrow=s:this.__heightGrow=s,s&&!(this.parent&&this.parent.__hasGrow)&&this.waitParent(()=>{this.parent.__hasGrow=!0}),this.__setAttr(t,e)&&xi(this)}}))}const{copyAndSpread:fg}=S;let Wa=ag,$a=dg;y.changeAttr("autoWidth",void 0,Kh);y.changeAttr("autoHeight",void 0,Kh);ot.prototype.__updateFlowLayout=function(){this.leafer.created=!1;const{flow:i}=this.__;switch(i){case"x":case!0:Wa(this);break;case"y":$a(this);break;case"x-reverse":Wa(this,!0);break;case"y-reverse":$a(this,!0);break}this.leafer.created=!0};ot.prototype.__updateContentBounds=function(){const{padding:i}=this.__,t=this.__layout,e=t.contentBounds===t.boxBounds;i?(e&&t.shrinkContent(),fg(t.contentBounds,t.boxBounds,i,!0)):e||t.shrinkContentCancel()};function ht(i,t){_g(i)&&(i="100%");const e=pg(i);return i=t===360?i:Math.min(t,Math.max(0,parseFloat(i))),e&&(i=parseInt(String(i*t),10)/100),Math.abs(i-t)<1e-6?1:(t===360?i=(i<0?i%t+t:i%t)/parseFloat(String(t)):i=i%t/parseFloat(String(t)),i)}function vs(i){return Math.min(1,Math.max(0,i))}function _g(i){return typeof i=="string"&&i.indexOf(".")!==-1&&parseFloat(i)===1}function pg(i){return typeof i=="string"&&i.indexOf("%")!==-1}function qh(i){return i=parseFloat(i),(isNaN(i)||i<0||i>1)&&(i=1),i}function bs(i){return Number(i)<=1?`${Number(i)*100}%`:i}function Ne(i){return i.length===1?"0"+i:String(i)}function gg(i,t,e){return{r:ht(i,255)*255,g:ht(t,255)*255,b:ht(e,255)*255}}function Fa(i,t,e){i=ht(i,255),t=ht(t,255),e=ht(e,255);const s=Math.max(i,t,e),n=Math.min(i,t,e);let r=0,o=0;const a=(s+n)/2;if(s===n)o=0,r=0;else{const h=s-n;switch(o=a>.5?h/(2-s-n):h/(s+n),s){case i:r=(t-e)/h+(t<e?6:0);break;case t:r=(e-i)/h+2;break;case e:r=(i-t)/h+4;break}r/=6}return{h:r,s:o,l:a}}function Kn(i,t,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?i+(t-i)*(6*e):e<1/2?t:e<2/3?i+(t-i)*(2/3-e)*6:i}function yg(i,t,e){let s,n,r;if(i=ht(i,360),t=ht(t,100),e=ht(e,100),t===0)n=e,r=e,s=e;else{const o=e<.5?e*(1+t):e+t-e*t,a=2*e-o;s=Kn(a,o,i+1/3),n=Kn(a,o,i),r=Kn(a,o,i-1/3)}return{r:s*255,g:n*255,b:r*255}}function za(i,t,e){i=ht(i,255),t=ht(t,255),e=ht(e,255);const s=Math.max(i,t,e),n=Math.min(i,t,e);let r=0;const o=s,a=s-n,h=s===0?0:a/s;if(s===n)r=0;else{switch(s){case i:r=(t-e)/a+(t<e?6:0);break;case t:r=(e-i)/a+2;break;case e:r=(i-t)/a+4;break}r/=6}return{h:r,s:h,v:o}}function mg(i,t,e){i=ht(i,360)*6,t=ht(t,100),e=ht(e,100);const s=Math.floor(i),n=i-s,r=e*(1-t),o=e*(1-n*t),a=e*(1-(1-n)*t),h=s%6,l=[e,o,r,r,a,e][h],c=[a,e,e,o,r,r][h],p=[r,r,a,e,e,o][h];return{r:l*255,g:c*255,b:p*255}}function Ha(i,t,e,s){const n=[Ne(Math.round(i).toString(16)),Ne(Math.round(t).toString(16)),Ne(Math.round(e).toString(16))];return s&&n[0].startsWith(n[0].charAt(1))&&n[1].startsWith(n[1].charAt(1))&&n[2].startsWith(n[2].charAt(1))?n[0].charAt(0)+n[1].charAt(0)+n[2].charAt(0):n.join("")}function wg(i,t,e,s,n){const r=[Ne(Math.round(i).toString(16)),Ne(Math.round(t).toString(16)),Ne(Math.round(e).toString(16)),Ne(vg(s))];return n&&r[0].startsWith(r[0].charAt(1))&&r[1].startsWith(r[1].charAt(1))&&r[2].startsWith(r[2].charAt(1))&&r[3].startsWith(r[3].charAt(1))?r[0].charAt(0)+r[1].charAt(0)+r[2].charAt(0)+r[3].charAt(0):r.join("")}function xg(i,t,e,s){const n=i/100,r=t/100,o=e/100,a=s/100,h=255*(1-n)*(1-a),l=255*(1-r)*(1-a),c=255*(1-o)*(1-a);return{r:h,g:l,b:c}}function Na(i,t,e){let s=1-i/255,n=1-t/255,r=1-e/255,o=Math.min(s,n,r);return o===1?(s=0,n=0,r=0):(s=(s-o)/(1-o)*100,n=(n-o)/(1-o)*100,r=(r-o)/(1-o)*100),o*=100,{c:Math.round(s),m:Math.round(n),y:Math.round(r),k:Math.round(o)}}function vg(i){return Math.round(parseFloat(i)*255).toString(16)}function ja(i){return Rt(i)/255}function Rt(i){return parseInt(i,16)}function bg(i){return{r:i>>16,g:(i&65280)>>8,b:i&255}}const pr={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",goldenrod:"#daa520",gold:"#ffd700",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavenderblush:"#fff0f5",lavender:"#e6e6fa",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};function Rg(i){let t={r:0,g:0,b:0},e=1,s=null,n=null,r=null,o=!1,a=!1;return typeof i=="string"&&(i=Sg(i)),typeof i=="object"&&(bt(i.r)&&bt(i.g)&&bt(i.b)?(t=gg(i.r,i.g,i.b),o=!0,a=String(i.r).substr(-1)==="%"?"prgb":"rgb"):bt(i.h)&&bt(i.s)&&bt(i.v)?(s=bs(i.s),n=bs(i.v),t=mg(i.h,s,n),o=!0,a="hsv"):bt(i.h)&&bt(i.s)&&bt(i.l)?(s=bs(i.s),r=bs(i.l),t=yg(i.h,s,r),o=!0,a="hsl"):bt(i.c)&&bt(i.m)&&bt(i.y)&&bt(i.k)&&(t=xg(i.c,i.m,i.y,i.k),o=!0,a="cmyk"),Object.prototype.hasOwnProperty.call(i,"a")&&(e=i.a)),e=qh(e),{ok:o,format:i.format||a,r:Math.min(255,Math.max(t.r,0)),g:Math.min(255,Math.max(t.g,0)),b:Math.min(255,Math.max(t.b,0)),a:e}}const kg="[-\\+]?\\d+%?",Bg="[-\\+]?\\d*\\.\\d+%?",Re="(?:"+Bg+")|(?:"+kg+")",qn="[\\s|\\(]+("+Re+")[,|\\s]+("+Re+")[,|\\s]+("+Re+")\\s*\\)?",Rs="[\\s|\\(]+("+Re+")[,|\\s]+("+Re+")[,|\\s]+("+Re+")[,|\\s]+("+Re+")\\s*\\)?",Ot={CSS_UNIT:new RegExp(Re),rgb:new RegExp("rgb"+qn),rgba:new RegExp("rgba"+Rs),hsl:new RegExp("hsl"+qn),hsla:new RegExp("hsla"+Rs),hsv:new RegExp("hsv"+qn),hsva:new RegExp("hsva"+Rs),cmyk:new RegExp("cmyk"+Rs),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/};function Sg(i){if(i=i.trim().toLowerCase(),i.length===0)return!1;let t=!1;if(pr[i])i=pr[i],t=!0;else if(i==="transparent")return{r:0,g:0,b:0,a:0,format:"name"};let e=Ot.rgb.exec(i);return e?{r:e[1],g:e[2],b:e[3]}:(e=Ot.rgba.exec(i),e?{r:e[1],g:e[2],b:e[3],a:e[4]}:(e=Ot.hsl.exec(i),e?{h:e[1],s:e[2],l:e[3]}:(e=Ot.hsla.exec(i),e?{h:e[1],s:e[2],l:e[3],a:e[4]}:(e=Ot.hsv.exec(i),e?{h:e[1],s:e[2],v:e[3]}:(e=Ot.hsva.exec(i),e?{h:e[1],s:e[2],v:e[3],a:e[4]}:(e=Ot.cmyk.exec(i),e?{c:e[1],m:e[2],y:e[3],k:e[4]}:(e=Ot.hex8.exec(i),e?{r:Rt(e[1]),g:Rt(e[2]),b:Rt(e[3]),a:ja(e[4]),format:t?"name":"hex8"}:(e=Ot.hex6.exec(i),e?{r:Rt(e[1]),g:Rt(e[2]),b:Rt(e[3]),format:t?"name":"hex"}:(e=Ot.hex4.exec(i),e?{r:Rt(e[1]+e[1]),g:Rt(e[2]+e[2]),b:Rt(e[3]+e[3]),a:ja(e[4]+e[4]),format:t?"name":"hex8"}:(e=Ot.hex3.exec(i),e?{r:Rt(e[1]+e[1]),g:Rt(e[2]+e[2]),b:Rt(e[3]+e[3]),format:t?"name":"hex"}:!1))))))))))}function bt(i){return typeof i=="number"?!Number.isNaN(i):Ot.CSS_UNIT.test(i)}class X{constructor(t="",e={}){if(t instanceof X)return t;typeof t=="number"&&(t=bg(t)),this.originalInput=t;const s=Rg(t);this.originalInput=t,this.r=s.r,this.g=s.g,this.b=s.b,this.a=s.a,this.roundA=Math.round(100*this.a)/100,this.format=e.format??s.format,this.gradientType=e.gradientType,this.r<1&&(this.r=Math.round(this.r)),this.g<1&&(this.g=Math.round(this.g)),this.b<1&&(this.b=Math.round(this.b)),this.isValid=s.ok}isDark(){return this.getBrightness()<128}isLight(){return!this.isDark()}getBrightness(){const t=this.toRgb();return(t.r*299+t.g*587+t.b*114)/1e3}getLuminance(){const t=this.toRgb();let e,s,n;const r=t.r/255,o=t.g/255,a=t.b/255;return r<=.03928?e=r/12.92:e=Math.pow((r+.055)/1.055,2.4),o<=.03928?s=o/12.92:s=Math.pow((o+.055)/1.055,2.4),a<=.03928?n=a/12.92:n=Math.pow((a+.055)/1.055,2.4),.2126*e+.7152*s+.0722*n}getAlpha(){return this.a}setAlpha(t){return this.a=qh(t),this.roundA=Math.round(100*this.a)/100,this}isMonochrome(){const{s:t}=this.toHsl();return t===0}toHsv(){const t=za(this.r,this.g,this.b);return{h:t.h*360,s:t.s,v:t.v,a:this.a}}toHsvString(){const t=za(this.r,this.g,this.b),e=Math.round(t.h*360),s=Math.round(t.s*100),n=Math.round(t.v*100);return this.a===1?`hsv(${e}, ${s}%, ${n}%)`:`hsva(${e}, ${s}%, ${n}%, ${this.roundA})`}toHsl(){const t=Fa(this.r,this.g,this.b);return{h:t.h*360,s:t.s,l:t.l,a:this.a}}toHslString(){const t=Fa(this.r,this.g,this.b),e=Math.round(t.h*360),s=Math.round(t.s*100),n=Math.round(t.l*100);return this.a===1?`hsl(${e}, ${s}%, ${n}%)`:`hsla(${e}, ${s}%, ${n}%, ${this.roundA})`}toHex(t=!1){return Ha(this.r,this.g,this.b,t)}toHexString(t=!1){return"#"+this.toHex(t)}toHex8(t=!1){return wg(this.r,this.g,this.b,this.a,t)}toHex8String(t=!1){return"#"+this.toHex8(t)}toHexShortString(t=!1){return this.a===1?this.toHexString(t):this.toHex8String(t)}toRgb(){return{r:Math.round(this.r),g:Math.round(this.g),b:Math.round(this.b),a:this.a}}toRgbString(){const t=Math.round(this.r),e=Math.round(this.g),s=Math.round(this.b);return this.a===1?`rgb(${t}, ${e}, ${s})`:`rgba(${t}, ${e}, ${s}, ${this.roundA})`}toPercentageRgb(){const t=e=>`${Math.round(ht(e,255)*100)}%`;return{r:t(this.r),g:t(this.g),b:t(this.b),a:this.a}}toPercentageRgbString(){const t=e=>Math.round(ht(e,255)*100);return this.a===1?`rgb(${t(this.r)}%, ${t(this.g)}%, ${t(this.b)}%)`:`rgba(${t(this.r)}%, ${t(this.g)}%, ${t(this.b)}%, ${this.roundA})`}toCmyk(){return{...Na(this.r,this.g,this.b)}}toCmykString(){const{c:t,m:e,y:s,k:n}=Na(this.r,this.g,this.b);return`cmyk(${t}, ${e}, ${s}, ${n})`}toName(){if(this.a===0)return"transparent";if(this.a<1)return!1;const t="#"+Ha(this.r,this.g,this.b,!1);for(const[e,s]of Object.entries(pr))if(t===s)return e;return!1}toString(t){const e=!!t;t=t??this.format;let s=!1;const n=this.a<1&&this.a>=0;return!e&&n&&(t.startsWith("hex")||t==="name")?t==="name"&&this.a===0?this.toName():this.toRgbString():(t==="rgb"&&(s=this.toRgbString()),t==="prgb"&&(s=this.toPercentageRgbString()),(t==="hex"||t==="hex6")&&(s=this.toHexString()),t==="hex3"&&(s=this.toHexString(!0)),t==="hex4"&&(s=this.toHex8String(!0)),t==="hex8"&&(s=this.toHex8String()),t==="name"&&(s=this.toName()),t==="hsl"&&(s=this.toHslString()),t==="hsv"&&(s=this.toHsvString()),t==="cmyk"&&(s=this.toCmykString()),s||this.toHexString())}toNumber(){return(Math.round(this.r)<<16)+(Math.round(this.g)<<8)+Math.round(this.b)}clone(){return new X(this.toString())}lighten(t=10){const e=this.toHsl();return e.l+=t/100,e.l=vs(e.l),new X(e)}brighten(t=10){const e=this.toRgb();return e.r=Math.max(0,Math.min(255,e.r-Math.round(255*-(t/100)))),e.g=Math.max(0,Math.min(255,e.g-Math.round(255*-(t/100)))),e.b=Math.max(0,Math.min(255,e.b-Math.round(255*-(t/100)))),new X(e)}darken(t=10){const e=this.toHsl();return e.l-=t/100,e.l=vs(e.l),new X(e)}tint(t=10){return this.mix("white",t)}shade(t=10){return this.mix("black",t)}desaturate(t=10){const e=this.toHsl();return e.s-=t/100,e.s=vs(e.s),new X(e)}saturate(t=10){const e=this.toHsl();return e.s+=t/100,e.s=vs(e.s),new X(e)}greyscale(){return this.desaturate(100)}spin(t){const e=this.toHsl(),s=(e.h+t)%360;return e.h=s<0?360+s:s,new X(e)}mix(t,e=50){const s=this.toRgb(),n=new X(t).toRgb(),r=e/100,o={r:(n.r-s.r)*r+s.r,g:(n.g-s.g)*r+s.g,b:(n.b-s.b)*r+s.b,a:(n.a-s.a)*r+s.a};return new X(o)}analogous(t=6,e=30){const s=this.toHsl(),n=360/e,r=[this];for(s.h=(s.h-(n*t>>1)+720)%360;--t;)s.h=(s.h+n)%360,r.push(new X(s));return r}complement(){const t=this.toHsl();return t.h=(t.h+180)%360,new X(t)}monochromatic(t=6){const e=this.toHsv(),{h:s}=e,{s:n}=e;let{v:r}=e;const o=[],a=1/t;for(;t--;)o.push(new X({h:s,s:n,v:r})),r=(r+a)%1;return o}splitcomplement(){const t=this.toHsl(),{h:e}=t;return[this,new X({h:(e+72)%360,s:t.s,l:t.l}),new X({h:(e+216)%360,s:t.s,l:t.l})]}onBackground(t){const e=this.toRgb(),s=new X(t).toRgb(),n=e.a+s.a*(1-e.a);return new X({r:(e.r*e.a+s.r*s.a*(1-e.a))/n,g:(e.g*e.a+s.g*s.a*(1-e.a))/n,b:(e.b*e.a+s.b*s.a*(1-e.a))/n,a:n})}triad(){return this.polyad(3)}tetrad(){return this.polyad(4)}polyad(t){const e=this.toHsl(),{h:s}=e,n=[this],r=360/t;for(let o=1;o<t;o++)n.push(new X({h:(s+o*r)%360,s:e.s,l:e.l}));return n}equals(t){const e=new X(t);return this.format==="cmyk"||e.format==="cmyk"?this.toCmykString()===e.toCmykString():this.toRgbString()===e.toRgbString()}}function Yi(i,t=20){return new X(i).mix(j.black,t).toString()}function wt(i,t=20){return new X(i).mix(j.white,t).toString()}function ks(i,t){return new X(i).toString("rgb")===new X(t).toString("rgb")}function Zh(i){return i.selected||i.disabled||ut.isFocus(i)}function gr(i){const t=i.__.normalStyle;t&&(i.set(t),i.__.normalStyle=void 0)}function be(i,t,e){let s;const n=i.__;if(e)s=!Zh(i)&&n[t];else switch(t){case"disabledStyle":s=n[t];break;case"focusStyle":s=!i.disabled&&n[t];break;case"selectedStyle":s=!i.disabled&&!ut.isFocus(i)&&n[t];break}s&&(gr(i),i.__.normalStyle=i.get(s),i.set(s))}function yr(i,t,e){e?Zh(i)||(gr(i),ut.isPress(i)&&i.pressStyle?be(i,"pressStyle",!0):ut.isHover(i)&&i.hoverStyle&&be(i,"hoverStyle",!0)):(gr(i),i.disabledStyle&&i.disabled?be(i,"disabledStyle"):i.focusStyle&&ut.isFocus(i)?be(i,"focusStyle"):i.selectedStyle&&i.selected&&be(i,"selectedStyle"))}function Cg(i,t){switch(t){case C.ENTER:be(i,"hoverStyle",!0);break;case C.LEAVE:yr(i,"hoverStyle",!0);break;case C.DOWN:be(i,"pressStyle",!0);break;case C.UP:yr(i,"pressStyle",!0);break}}ut.isHover=function(i){return i.leafer&&i.leafer.interaction.isHover(i)};ut.isPress=function(i){return i.leafer&&i.leafer.interaction.isPress(i)};ut.isFocus=function(i){return i.leafer&&i.leafer.interaction.isFocus(i)};ut.isDrag=function(i){return i.leafer&&i.leafer.interaction.isDrag(i)};ut.setStyle=function(i,t,e){e?be(i,t):yr(i)};ut.updateEventStyle=Cg;y.prototype.focus=function(i=!0){this.waitLeafer(()=>{let{focusData:t}=this.app.interaction;i?(t&&t.focus(!1),t=this):t=null,this.app.interaction.focusData=t,ut.setStyle(this,"focusStyle",i)})};function Eg(){N.changeAttr("fontFamily",Pg)}class Qh extends Ui{constructor(t,e){super(e),Eg(),this.props=this.proxyProps(t),this.render()}proxyProps(t){const{render:e}=this;return new Proxy(t,{set(s,n,r){return s[n]=r,e(),!0}})}setProps(t){Object.assign(this.props,t)}render(){}}function Tg(){}function Gt(i,t="default"){return new Proxy(i,{get(e,s){return s in e?e[s]:e[t]}})}const Pg="Inter, Helvetica Neue, Helvetica, PingFang SC, Hiragino Sans GB, Microsoft YaHei, , Arial, sans-serif",Ga=Gt({large:40,default:32,small:24}),Zn=Gt({large:14,default:14,small:12}),Qn=Gt({base:4,small:2,round:20,circle:100},"base"),j=Gt({white:"#ffffff",black:"#000000",primary:"#409eff",success:"#67c23a",warning:"#e6a23c",danger:"#f56c6c",error:"#f56c6c",info:"#909399"},"white"),ke=Gt({primary:"#303133",regular:"#606266",secondary:"#909399",placeholder:"#a8abb2",disabled:"#c0c4cc"},"primary"),Ds=Gt({default:"#dcdfe6",light:"#e4e7ed",lighter:"#ebeef5",extraLight:"#f2f6fc",dark:"#d4d7de",darker:"#cdd0d6"}),Og='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024"><path fill="currentColor" d="M512 64a32 32 0 0 1 32 32v192a32 32 0 0 1-64 0V96a32 32 0 0 1 32-32m0 640a32 32 0 0 1 32 32v192a32 32 0 1 1-64 0V736a32 32 0 0 1 32-32m448-192a32 32 0 0 1-32 32H736a32 32 0 1 1 0-64h192a32 32 0 0 1 32 32m-640 0a32 32 0 0 1-32 32H96a32 32 0 0 1 0-64h192a32 32 0 0 1 32 32M195.2 195.2a32 32 0 0 1 45.248 0L376.32 331.008a32 32 0 0 1-45.248 45.248L195.2 240.448a32 32 0 0 1 0-45.248zm452.544 452.544a32 32 0 0 1 45.248 0L828.8 783.552a32 32 0 0 1-45.248 45.248L647.744 692.992a32 32 0 0 1 0-45.248zM828.8 195.264a32 32 0 0 1 0 45.184L692.992 376.32a32 32 0 0 1-45.248-45.248l135.808-135.808a32 32 0 0 1 45.248 0m-452.544 452.48a32 32 0 0 1 0 45.248L240.448 828.8a32 32 0 0 1-45.248-45.248l135.808-135.808a32 32 0 0 1 45.248 0z"/></svg>',Lg=Gt({large:[13,20],default:[9,16],small:[6,12]}),Mg=Gt({large:8,default:6,small:4}),Ag=i=>Gt({default:{fill:i||j.white,stroke:i||Ds.default,textFill:i?j.white:ke.regular},hover:{fill:i?wt(i,30):wt(j.primary,90),stroke:i?wt(i,30):wt(j.primary,70),textFill:i?j.white:j.primary},press:{fill:i?Yi(i,20):wt(j.primary,90),stroke:i?Yi(i,20):j.primary,textFill:i?j.white:j.primary},disabled:{fill:i?wt(i,50):j.white,stroke:i?wt(i,50):Ds.light,textFill:i?j.white:ke.placeholder}}),Dg=i=>Gt({default:{fill:i?wt(i,90):j.white,stroke:i?wt(i,50):Ds.default,textFill:i||ke.regular},hover:{fill:i||j.white,stroke:i||j.primary,textFill:i?j.white:j.primary},press:{fill:i?Yi(i,20):j.white,stroke:i?Yi(i,20):j.primary,textFill:i?j.white:j.primary},disabled:{fill:i?wt(i,90):j.white,stroke:i?wt(i,80):Ds.light,textFill:i?wt(i,50):ke.placeholder}}),Ig=i=>Gt({default:{fill:"transparent",stroke:"transparent",textFill:i||ke.regular},hover:{fill:"transparent",stroke:"transparent",textFill:i?wt(i,50):ke.secondary},press:{fill:"transparent",stroke:"transparent",textFill:i?Yi(i,20):ke.primary},disabled:{fill:"transparent",stroke:"transparent",textFill:i?wt(i,50):ke.placeholder}}),Wg=i=>{const{type:t,plain:e,link:s,color:n}=i,r=n||(t?j[t]:""),o=(a,h)=>e?Dg(r)[a][h]:s?Ig(r)[a][h]:Ag(r)[a][h];return{fill:o("default","fill"),stroke:o("default","stroke"),textFill:o("default","textFill"),hoverFill:o("hover","fill"),hoverStroke:o("hover","stroke"),hoverTextFill:o("hover","textFill"),pressFill:o("press","fill"),pressStroke:o("press","stroke"),pressTextFill:o("press","textFill"),disabledFill:o("disabled","fill"),disabledStroke:o("disabled","stroke"),disabledTextFill:o("disabled","textFill")}};class _y extends Qh{constructor(t,e){super(t,e)}get __tag(){return"ElButton"}render(){const{text:t,size:e="",link:s,round:n,circle:r,loading:o,loadingIcon:a,icon:h,disabled:l,children:c=[],onClick:p=Tg}=this.props,{fill:_,stroke:u,hoverFill:f,hoverStroke:g,pressFill:x,pressStroke:w,disabledFill:m,disabledStroke:v,textFill:R,hoverTextFill:T,pressTextFill:M,disabledTextFill:O}=Wg(this.props);this.set({height:s?void 0:Ga[e],width:r?Ga[e]:void 0,fill:_,padding:s?void 0:Lg[e],stroke:ks(u,_)?void 0:u,strokeWidth:1,strokeAlign:"inside",cornerRadius:n?Qn.round:r?Qn.circle:Qn[e],cursor:"pointer",disabled:l||o,flowAlign:"center",gap:Mg[e],hoverStyle:{fill:f,stroke:ks(g,f)?void 0:g},pressStyle:{fill:x,stroke:ks(w,x)?void 0:w},disabledStyle:{fill:m,stroke:ks(v,m)?void 0:v,cursor:l?"not-allowed":void 0},children:[new Fg({icon:o?a||Og:h,color:R,size:Zn[e],loading:o}),{tag:"Text",textAlign:r?"center":void 0,text:t,fill:R,fontSize:Zn[e],fontWeight:500,lineHeight:Zn[e],disabled:l,visible:!!t||0,hoverStyle:{fill:T},pressStyle:{fill:M},disabledStyle:{fill:O}},...c]}),this.on(C.CLICK,p)}}const Jh=i=>/<svg.*?>.*?<\/svg>/.test(i),$g=(i,t)=>!Jh(i)||!t?i:/fill=".*?"/.test(i)?i.replace(/fill=".*?"/g,`fill="${t}"`):i.replace(/<svg /g,`<svg fill="${t}" `);class Fg extends Qh{constructor(t,e){super(t,e),this.timer=null}get __tag(){return"ElIcon"}render(){const{icon:t="",color:e,size:s,loading:n}=this.props;this.set({flow:!1,width:s,height:s,visible:!!t||0,children:[{tag:"Rect",fill:{type:"image",url:Jh(t)?b.toURL($g(t,e),"svg"):t,mode:"fit"},width:s,height:s}]}),this.timer&&(clearInterval(this.timer),this.timer=null),n&&(this.timer=setInterval(()=>{this.children[0].rotateOf("center",3)},16.7))}}export{_y as B,Qh as C,Ui as F,Fg as I,Ee as L,At as M,C as P,Og as a};
